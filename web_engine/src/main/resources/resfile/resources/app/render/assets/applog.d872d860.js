import"./modulepreload-polyfill.b7f2da20.js";import{bP as oe,o as v,c as r,a as h,M as ue,k as a,bL as ie,A as ve,j as T,aN as D,P as C,U as P,Z as R,W as _,X as F,Y as G,$ as j,ae as E,a0 as J,R as X,an as Z,bN as re}from"./index.f074ecef.js";/* empty css              */import{I as ce}from"./ico_pin.a6faa7a5.js";import{i as pe}from"./isUdf.1a76b9f4.js";function de(x,n){for(var o=[],w=0,c=-1;++c<x;)pe(n)?o.push(w++):oe(n)?o.push(n(c)):o.push(n);return o}const he={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},fe=h("path",{d:"M379.094 197.91c72.324 119.976 68.833 116.128 132.41 116.128h371.26v500.688H137.2V199.854h257.146m2.467-75.782H134.734c-40.483 0-73.315 32.832-73.315 73.315v619.809c0 40.482 32.832 73.316 73.315 73.316h750.499c40.487 0 73.316-32.834 73.316-73.316V311.508c0-40.487-32.828-73.32-73.316-73.32H511.504c-72.309-96.944-62.006-114.116-114.69-114.116zm0 0",fill:"currentColor"},null,-1),ge=[fe];function me(x,n){return v(),r("svg",he,[...ge])}var _e={render:me};const we={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200"},ye=h("path",{d:"M480 512v-.224a47.84 47.84 0 0 0-14.688-34.544l.016-.016-288-288-.128.128a48 48 0 1 0-64.464 71.056l251.488 251.488L109.44 766.672l.016.016a48 48 0 0 0 67.856 67.856l.016.016 288-288-.016-.016A47.84 47.84 0 0 0 480 512zm408 240H520a40 40 0 0 0-40 40v16a40 40 0 0 0 40 40h368a40 40 0 0 0 40-40v-16a40 40 0 0 0-40-40z",fill:"currentColor"},null,-1),Ie=[ye];function Te(x,n){return v(),r("svg",we,[...Ie])}var xe={render:Te};const ke={class:"fixed-btns p_fixed z_index_999 t_md flex_col"},Se={class:"log-content"},Ce=ue({__name:"AppLog",setup(x){const n=a(null),o=a([]),w=a(!1),c=a(!1),b=a(null),y=a(""),k=a(null),t=a(""),p=a(!1),f=a(!1),q=a(ie("system/getPath","logs")),H=a(!1),A=a([]),g=a(0),d=ve(()=>{if(!t.value||!f.value||!H.value)return[];const e=t.value.split(".").length,s=A.value.map(l=>l.split(".").slice(0,e).join(".")).filter(l=>l.includes(t.value)).reduce((l,I)=>l.includes(I)?l:l.concat(I),[]).sort();return s.includes(t.value)?[]:s});T("system/getAppLogs").then(({data:e})=>{o.value=e||[]}),T("system/getAppLogTipStrings").then(({data:e})=>{console.log(e),A.value=e||[]}),D("system/appLogChange",({data:e})=>{o.value.push(e),o.value.length>5e3&&o.value.shift()}),D("system/isCanInteractiveChange",({data:e})=>{H.value=e});const i=a(null),u=a([]),z="APPLOG_STORE_KEY";try{u.value=JSON.parse(localStorage.getItem(z))||[]}catch{}C(u,()=>localStorage.setItem(z,JSON.stringify(u.value)),{deep:!0});let K=null;const N=()=>{clearTimeout(K),K=setTimeout(()=>{n.value.scrollTop=n.value.scrollHeight})},L=()=>{if(n.value){const{scrollHeight:e,scrollTop:s,offsetHeight:l}=n.value;e-(l+s)<100&&N()}};C(o,()=>L(),{flush:"pre",deep:!0});const Q=()=>{w.value?T("window/unpin","appLogWindow"):T("window/pin","appLogWindow"),w.value=!w.value},ee=()=>{T("system/showItemInPath",[q.value,"main.log"])},le=()=>{L(),c.value=!c.value},O=()=>{p.value?b.value.focus():k.value.focus()};C([p,c],()=>{c.value&&setTimeout(()=>O())});const $=()=>{p.value?y.value=y.value.replace(/\s*/g,""):f.value=!0},M=e=>{if(H.value&&f.value){if(e.key==="Tab"){t.value=d.value[g.value],g.value=0;return}else if(d.value.length>0)switch(e.key){case"ArrowUp":g.value=(g.value-1+d.value.length)%d.value.length;return;case"ArrowDown":g.value=(g.value+1+d.value.length)%d.value.length;return}}e.key==="ArrowUp"&&!p.value&&(!t.value||!f.value)&&(i.value===null&&(i.value=u.value.length),i.value>0&&(i.value--,t.value=u.value[i.value]||"",setTimeout(()=>{f.value=!1,k.value.setSelectionRange(t.value.length,t.value.length)}))),e.key==="ArrowDown"&&!p.value&&(!t.value||!f.value)&&(i.value===null&&(i.value=u.value.length),i.value<u.value.length&&(i.value++,t.value=u.value[i.value]||"",setTimeout(()=>{f.value=!1,k.value.setSelectionRange(t.value.length,t.value.length)}))),e.key==="Enter"&&!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey&&(N(),i.value=null,p.value||(t.value&&t.value!==u.value[u.value.length-1]&&(u.value.push(t.value),u.value.length>20&&u.value.shift()),t.value==="clear"&&setTimeout(()=>{const s=Math.ceil(n.value.offsetHeight/17.4);o.value=[...o.value,...de(s,"")]},200)),T("app/interactive",p.value?y.value:t.value).then(({data:s})=>{p.value=s}).catch(()=>{p.value=!1}),setTimeout(()=>{f.value=!1,y.value=t.value=""}))},U="INPUT_HEIGHT_KEY",m=a(+localStorage.getItem(U)||120);C(m,()=>{localStorage.setItem(U,String(m.value))});let Y=0,B=m.value;const V=26,W=180,S=a(!1),te=a(null),ae=e=>{if(S.value){L();const s=e.clientY-Y;let l=B-s;l>W?l=W:l<V&&(l=V),m.value=l}},se=()=>{S.value=!1},ne=e=>{S.value=!0,Y=e.clientY,B=m.value};return document.addEventListener("mousemove",ae),document.addEventListener("mouseup",se),(e,s)=>(v(),r("div",{class:R(["app_log",{"show-input":c.value,resizing:S.value}])},[h("div",ke,[h("div",{class:"btn cs_pointer mb_sm",onClick:Q},[P(_(ce),{class:R(["pin ts_all_fast",{rotate_n45:w.value}])},null,8,["class"])]),h("div",{class:"btn cs_pointer mb_sm",onClick:ee},[P(_(_e),{class:"folder"})]),h("div",{class:"btn cs_pointer mb_sm",onClick:le},[P(_(xe),{class:"terminal"})])]),h("div",{class:"log-wrapper",ref_key:"logWrapper",ref:n,tabIndex:"-1",style:E({height:c.value?`calc(100vh - ${m.value}px)`:"100vh"})},[h("div",Se,[h("code",null,[(v(!0),r(F,null,G(o.value,(l,I)=>(v(),r("span",{key:l||I},j(l||`
`),1))),128))])])],4),c.value?(v(),r("div",{key:0,class:"app-input",ref_key:"inputWpRef",ref:te,style:E({height:`${m.value}px`}),onClick:O},[_(d).length>0?(v(),r("div",{key:0,class:"tips",style:E({top:`${-Math.min(_(d).length*18,200)}px`,height:`${Math.min(_(d).length*18,200)}px`})},[(v(!0),r(F,null,G(_(d),(l,I)=>(v(),r("div",{class:R(["tip",{selected:g.value===I}]),key:l},j(l),3))),128))],4)):J("",!0),h("div",{class:"drag-line p_absolute w_100",onMousedown:ne},null,32),p.value?X((v(),r("input",{key:1,ref_key:"pwdRef",ref:b,"onUpdate:modelValue":s[0]||(s[0]=l=>y.value=l),type:"password",onInput:$,onKeydown:M},null,544)),[[Z,y.value]]):X((v(),r("textarea",{key:2,ref_key:"cmdRef",ref:k,"onUpdate:modelValue":s[1]||(s[1]=l=>t.value=l),onInput:$,onKeydown:M},null,544)),[[Z,t.value]])],4)):J("",!0)],2))}});re(Ce).mount("#app");

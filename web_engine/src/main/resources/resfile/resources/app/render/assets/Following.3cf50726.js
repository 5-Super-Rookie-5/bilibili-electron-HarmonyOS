import{M as D,x as M,y as R,k as u,P as U,ao as j,n as G,g as $,o as e,c as s,a as l,Z as P,$ as x,a0 as y,X as I,Y as H,aj as k,W as T,t as N,a6 as q,a7 as W,u as z,A as O,l as X,a2 as V,ai as Y}from"./index.f074ecef.js";import{F as S,f as J,a as K,b as Q,c as tt}from"./FollowerItem.f44e7c43.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import{H as et}from"./index.194c39d1.js";import{k as at,m as ot}from"./App.c1beb0e9.js";import"./MoreFeedback.eac5fca1.js";import"./style.2070e26d.js";/* empty css                    */import"./index.14a3ec94.js";import"./ico_max_exit.f7f1ea61.js";import"./modulepreload-polyfill.b7f2da20.js";import"./isUdf.1a76b9f4.js";import"./btn_devtools.06ffa497.js";import"./ico_pin.a6faa7a5.js";/* empty css               */import"./theme-map.a3b52bba.js";import"./index.733b73c2.js";const A=c=>(q("data-v-95337676"),c=c(),W(),c),nt={class:"follow-tag"},st=A(()=>l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:`M2.09508 3.86764C2.22185 3.74087 2.42738 3.74087 2.55415 3.86764L6.22 7.53349L9.88585 3.86764\r
          C10.0126 3.74087 10.2182 3.74087 10.3449 3.86764C10.4717 3.99441 10.4717 4.19995 10.3449 4.32672\r
          L6.60256 8.06908C6.39128 8.28036 6.04872 8.28036 5.83744 8.06908L2.09508 4.32672C1.96831 4.19995\r
          1.96831 3.99441 2.09508 3.86764Z`,stroke:"#61666D","stroke-width":"1.3","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),lt=[st],rt=["textContent"],it=["textContent"],ut=A(()=>l("svg",{class:"sort-icon",width:"20",height:"20",viewBox:"0 0 20 20"},[l("path",{d:`M2.73585 7.74043L2.97391 7.49415L3.83341 6.60502V7.84167V14.1667C3.83341 14.2551 3.86853\r
            14.3399 3.93104 14.4024C3.99355 14.4649 4.07833 14.5 4.16674 14.5C4.25514 14.5 4.33993\r
            14.4649 4.40244 14.4024C4.46495 14.3399 4.50007 14.2551 4.50007 14.1667V7.84167V6.60502\r
            L5.35957 7.49416L5.59763 7.74043C5.62841 7.77061 5.6647 7.79461 5.70454 7.81111C5.74539\r
            7.82803 5.78918 7.83674 5.83341 7.83674C5.87763 7.83674 5.92142 7.82803 5.96227 7.81111\r
            C6.00313 7.79419 6.04025 7.76938 6.07152 7.73811C6.10279 7.70684 6.12759 7.66972 6.14452\r
            7.62887C6.16144 7.58801 6.17015 7.54422 6.17015 7.5C6.17015 7.45578 6.16144 7.41199 6.14452\r
            7.37113C6.12759 7.33028 6.10279 7.29316 6.07152 7.26189L4.40957 5.59994C4.37854 5.57098 4.34225\r
            5.5482 4.30265 5.53285L4.29186 5.52867L4.28128 5.52399C4.2452 5.50804 4.20619 5.49981 4.16674\r
            5.49981C4.12729 5.49981 4.08828 5.50804 4.0522 5.52399L4.04162 5.52867L4.03082 5.53285C3.99123\r
            5.54821 3.95493 5.57098 3.9239 5.59995L2.26196 7.26189C2.19881 7.32504 2.16333 7.41069 2.16333\r
            7.5C2.16333 7.58931 2.19881 7.67496 2.26196 7.73811C2.32511 7.80126 2.41076 7.83674 2.50007\r
            7.83674C2.58829 7.83674 2.67293 7.80213 2.73585 7.74043ZM17.5001 13.8333H9.16674C9.07833\r
            13.8333 8.99355 13.8685 8.93104 13.931C8.86852 13.9935 8.83341 14.0783 8.83341 14.1667C8.83341\r
            14.2551 8.86852 14.3399 8.93104 14.4024C8.99355 14.4649 9.07833 14.5 9.16674 14.5H17.5001C17.5885\r
            14.5 17.6733 14.4649 17.7358 14.4024C17.7983 14.3399 17.8334 14.2551 17.8334 14.1667C17.8334\r
            14.0783 17.7983 13.9935 17.7358 13.931C17.6733 13.8685 17.5885 13.8333 17.5001 13.8333ZM9.16674\r
            10.3333H17.5001C17.5885 10.3333 17.6733 10.2982 17.7358 10.2357C17.7983 10.1732 17.8334 10.0884\r
            17.8334 10C17.8334 9.91159 17.7983 9.82681 17.7358 9.7643C17.6733 9.70179 17.5885 9.66667 17.5001\r
            9.66667H9.16674C9.07833 9.66667 8.99355 9.70179 8.93104 9.7643C8.86852 9.82681 8.83341 9.91159\r
            8.83341 10C8.83341 10.0884 8.86852 10.1732 8.93104 10.2357C8.99355 10.2982 9.07833 10.3333 9.16674\r
            10.3333ZM9.16674 6.16667H17.5001C17.5885 6.16667 17.6733 6.13155 17.7358 6.06904C17.7983 6.00652\r
            17.8334 5.92174 17.8334 5.83333C17.8334 5.74493 17.7983 5.66014 17.7358 5.59763C17.6733 5.53512\r
            17.5885 5.5 17.5001 5.5H9.16674C9.07833 5.5 8.99355 5.53512 8.93104 5.59763C8.86852 5.66014\r
            8.83341 5.74493 8.83341 5.83333C8.83341 5.92174 8.86852 6.00652 8.93104 6.06904C8.99355 6.13155\r
            9.07833 6.16667 9.16674 6.16667Z`})],-1)),ct=["textContent"],dt={key:0,class:"row"},vt=D({__name:"FollowTag",props:{tag:{type:Object,required:!0},mid:{type:Number,default:0}},emits:["updateCount"],setup(c,{emit:w}){const d=c,{userInfo:v}=M(R()),o=u([]),C=u("initiating"),a=u({ps:20,pn:1,order_type:d.tag.tagid===0?"attention":""}),g=u(!1);let r=!1;const h=()=>{r||(g.value=!g.value)},m=u(null);U(g,async()=>{const t=m.value;if(g.value){if(!t.clientHeight)return;r=!0,t.style.height=t.clientHeight+"px",t.dataset.height=t.clientHeight+"px",setTimeout(()=>{const n=()=>{t.removeEventListener("transitionend",n),r=!1};t.addEventListener("transitionend",n),t.style.height="0"},16)}else{if(!t.dataset.height)return;r=!0;const n=()=>{t.style.removeProperty("height"),t.removeEventListener("transitionend",n),r=!1};t.addEventListener("transitionend",n),t.style.height=t.dataset.height}});const E=async()=>{try{const n=(await J({mid:v.value.mid,tagid:d.tag.tagid,ps:a.value.ps,pn:a.value.pn,order_type:a.value.order_type})).data||[],f=n.length?await K({fids:n.map(i=>i.mid).join(",")}):{};n.forEach(i=>{i.attribute=f[i.mid].attribute}),o.value=o.value.concat(n),C.value="loaded"}catch(t){console.error(t),N({content:t.message||"\u7F51\u7EDC\u9519\u8BEF"}),C.value="error"}};E().then(()=>{b()});let F=!1;const p=async t=>{t.stopPropagation(),C.value==="loaded"&&(F||(F=!0,a.value.order_type=a.value.order_type==="attention"?"":"attention",o.value=[],a.value.ps=20,a.value.pn=1,await E(),F=!1))},b=async()=>{if(!(r||g.value)&&!(!v.value.isLogin||d.mid&&v.value.mid!==d.mid)&&!(d.tag.count/a.value.ps<=a.value.pn)&&C.value==="loaded")return C.value="loading",a.value.pn+=1,E()},_=u(null),L=j(_);return U(L,()=>{L.value&&C.value==="loaded"&&!F&&b()}),G(()=>{$.on("syncFollowerTagList",({user:t,groupList:n})=>{const f=n.includes(d.tag.tagid),i=o.value.some(B=>B.mid===t.mid);f&&!i?(o.value.unshift(t),w("updateCount",d.tag.count+1)):!f&&i&&(w("updateCount",Math.max(d.tag.count-1,0)),o.value=o.value.filter(B=>B.mid!==t.mid))})}),(t,n)=>(e(),s("div",nt,[l("div",{class:"tag-header",onClick:h},[(e(),s("svg",{class:P(["fold-icon",{rotated:g.value}]),width:"12",height:"12",viewBox:"0 0 12 12"},lt,2)),l("div",{class:"tag-title",textContent:x(c.tag.name)},null,8,rt),l("div",{class:"tag-count",textContent:x(c.tag.count)},null,8,it),c.tag.tagid===0&&!g.value?(e(),s("div",{key:0,class:"follow-tag-sort",onClick:p},[ut,l("span",{textContent:x(a.value.order_type==="attention"?"\u6700\u5E38\u8BBF\u95EE":"\u6700\u8FD1\u5173\u6CE8")},null,8,ct)])):y("",!0)]),l("div",{class:"tag-content",ref_key:"contentRef",ref:m},[["loaded","loading"].includes(C.value)?(e(),s("div",dt,[(e(!0),s(I,null,H(o.value,f=>(e(),k(S,{key:f.mid,item:f,oid:c.mid,class:"col_6",onUpdate:i=>f.attribute=i,onUpdateGroup:i=>T($).emit("syncFollowerTagList",{user:f,groupList:i})},null,8,["item","oid","onUpdate","onUpdateGroup"]))),128))])):y("",!0),l("div",{ref_key:"bottomRef",ref:_,class:"bottom-load"},null,512)],512)]))}});var pt=Z(vt,[["__scopeId","data-v-95337676"]]);const _t={class:"app_following i_page_wrapper"},gt={class:"app_following--content i_page_content page_scroller"},mt={key:0,class:"p_relative follow-content"},ft={key:1,class:"not-self p_relative follow-content"},Ct={key:2,class:"total"},ht=V("\u5168\u90E8\u5171"),yt=["textContent"],wt=V("\u4E2A\u5173\u6CE8\u7528\u6237"),Ft={class:"row gutter_lg"},Lt={key:3,class:"limit-tip"},Et=D({__name:"Following",setup(c){at(".app_following--content");const{userInfo:w}=M(R()),d=z(),v=O(()=>parseInt(d.query.mid)),o=u(!1);X(()=>{a.value=[],r.value=[],h.value=NaN,m.value={state:"",message:""},o.value=w.value.isLogin&&(!v.value||v.value===w.value.mid),o.value?g():E()});const a=u([]),g=async()=>{const p=await Q({vmid:w.value.mid});a.value=p.data||[]},r=u([]),h=u(NaN),m=u({state:"",message:""}),E=async()=>{if(!v.value){N({content:"\u53C2\u6570\u9519\u8BEF"});return}try{const p=await tt({vmid:v.value,ps:30,pn:1,order:"desc"});r.value=p.list||[],h.value=p.total}catch(p){m.value.state="error",m.value.message=p.message,N({content:p.message})}},F=()=>{m.value.state};return(p,b)=>(e(),s("div",_t,[l("div",gt,[o.value?(e(),s("div",mt,[(e(!0),s(I,null,H(a.value,_=>(e(),k(pt,{key:_.tagid,tag:_,mid:T(v),onUpdateCount:L=>_.count=L},null,8,["tag","mid","onUpdateCount"]))),128))])):y("",!0),o.value?y("",!0):(e(),s("div",ft,[h.value===0&&!r.value.length?(e(),k(ot,{key:0})):y("",!0),m.value.state==="error"?(e(),k(et,{key:1,text:m.value.message||"\u6682\u65E0\u5173\u6CE8\u7528\u6237",onRefresh:F},null,8,["text"])):y("",!0),h.value?(e(),s("div",Ct,[ht,l("span",{textContent:x(T(Y)(h.value))},null,8,yt),wt])):y("",!0),l("div",Ft,[(e(!0),s(I,null,H(r.value,_=>(e(),k(S,{key:_.mid,item:_,oid:T(v),class:"col_6",onUpdate:L=>_.attribute=L},null,8,["item","oid","onUpdate"]))),128))]),!o.value&&h.value>30?(e(),s("div",Lt,"\u7CFB\u7EDF\u9650\u5236\uFF0C\u4E0D\u80FD\u67E5\u770B\u66F4\u591A\u5566~")):y("",!0)]))])]))}});var jt=Z(Et,[["__scopeId","data-v-094041c1"]]);export{jt as default};

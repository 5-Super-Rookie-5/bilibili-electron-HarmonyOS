import{x as Z,ba as Se,M as Fe,ac as Ra,k as v,A as X,P as R,Q as Me,o as r,c as f,Z as ae,W as t,a as u,U as h,a0 as Y,$ as O,dR as ra,a2 as ve,B as Ee,X as Ye,Y as ct,_ as pa,ae as ga,n as rt,w as Ta,R as xe,T as De,V as ce,g as $e,aL as _a,y as Va,ab as da,q as re,l as Ba,a1 as Ct,aj as ke,C as ha,bb as va,cz as Ea,b1 as A,aS as Oa,aa as Ua,F as Ja,b9 as Qa,aY as Kt,b7 as Na,aB as zt,p as Wa,ap as Xa,bc as Ha,ak as Za,bd as es,I as ze,be as qt,bf as ma,S as fa,bg as ts,G as Nt,i as na,u as as,bk as ss,aV as ns,bl as is,aN as ut,aH as Wt,a4 as ls,aJ as xa,aQ as Pt,bm as Da,bn as os,bE as us,a_ as cs,b as $a,aG as Ht}from"./index.f074ecef.js";import{_ as rs}from"./btn_devtools.06ffa497.js";import{h as Ka,i as ds,t as vs,K as ia,j as la,k as Ma,l as oa,a as ms,u as fs,m as ps,n as gs,o as _s,p as hs,q as ys,r as ua,s as ca,v as Fa,A as bs,w as Ss}from"./index.194c39d1.js";import{y as ws,z as ks,_ as Ps,u as Cs,J as za,v as Is,t as Ts,B as Es,q as xs,a4 as Ds}from"./index.14a3ec94.js";import{B as $s}from"./vd_restart.17cf874a.js";import{a as La,I as Ms}from"./ico_max_exit.f7f1ea61.js";import{u as jt,j as qa,P as Fs,d as Ls,c as Ya,ac as Aa,s as Yt,h as qe,o as As,e as Rs}from"./MoreFeedback.eac5fca1.js";import{_ as ya}from"./playing.8170b3ef.js";import{_ as ja}from"./plugin-vue_export-helper.21dcd24c.js";import{e as Vs,i as Bs}from"./App.c1beb0e9.js";import"./modulepreload-polyfill.b7f2da20.js";import"./isUdf.1a76b9f4.js";import"./ico_pin.a6faa7a5.js";import"./style.2070e26d.js";/* empty css               */import"./theme-map.a3b52bba.js";import"./index.733b73c2.js";const Ga=()=>{const{expandedPagedVideoIdList:_}=Z(Se());return{calculateEpHeight:i=>_.value.includes(i.bvid)&&i.pages?(console.log("calculate",i.pages,_.value,i.bvid),100+40*i.pages.length+10):100}};const Os={class:"flex_start p_relative"},Us={class:"card-left flex_shrink_0 mr_xs"},Ns={class:"item-driation"},Ws={class:"card-right flex_col_between"},Hs={class:"text1 text_ellipsis_2l w_100 mt_xs"},Ks={key:0,src:ya,alt:""},zs={class:"w_100 text3 mb_xs"},qs={key:0},Ys={key:1},js={class:"ml_md"},Gs={key:0,class:"page-list"},Js=["onClick"],Qs={class:"page-list-left"},Xs={key:0,src:ya},Zs=["textContent","title"],en={class:"page-list-duration"},tn=Fe({__name:"UgcSeasonItem",props:{item:{type:Object,default:()=>({})},y:Number,h:Number,i:Number},emits:["expand","select"],setup(_,{emit:S}){const i=_,F=Ra(),{calculateEpHeight:U}=Ga(),{activeItem:P,expandedPagedVideoIdList:C}=Z(Se()),{addExpandedPagedVideoId:$,removeExpandedPagedVideoId:j}=Se(),T=v(null),w=v(!1),b=X(()=>{var c;return((c=i.item.pages)==null?void 0:c.length)>1}),D=X(()=>U(i.item)),E=()=>{var c;if(((c=i.item.pages)==null?void 0:c.length)>1){C.value.includes(i.item.bvid)?j(i.item.bvid):$(i.item.bvid);return}S("select",i.i)},G=c=>{S("select",i.i+c)};return R(P,()=>{var c;P.value.bvid===i.item.bvid&&((c=i.item.pages)==null?void 0:c.length)>1&&$(i.item.bvid)}),jt(T,([{isIntersecting:c}])=>{w.value=c},{threshold:0}),(c,m)=>{var L,I,p,ie,K,se;const x=Me("VImg");return r(),f("div",{ref_key:"ugcSeasonItem",ref:T,style:ga({height:t(D)+"px"}),class:"season-item",onClick:E},[w.value?(r(),f("div",{key:0,class:ae(["season-item-wrap px_lg py_sm h_100",{active:_.item.bvid===t(P).bvid}])},[u("div",Os,[t(b)?(r(),f("span",{key:0,class:ae(["fold-btn",{expand:t(C).includes(_.item.bvid)}])},[h(t(qa))],2)):Y("",!0),u("div",Us,[h(x,{class:"cover-img p_cover",src:_.item.arc.pic,width:140*t(F),height:78*t(F),loading:"lazy",rule:"1c"},null,8,["src","width","height"]),u("div",Ns,O(t(ra)("(hh:)?mm:ss",(_.item.arc.duration||0)*1e3-1)),1)]),u("div",Ws,[u("h4",Hs,[_.item.bvid===t(P).bvid?(r(),f("img",Ks)):Y("",!0),ve(" "+O(_.item.title),1)]),u("p",zs,[_.item.arc.enable_vt?(r(),f("span",qs,[h(t(Fs)),ve(" "+O(_.item.arc.vt_display||t(Ee)((I=(L=_.item.arc)==null?void 0:L.stat)==null?void 0:I.vt)),1)])):(r(),f("span",Ys,[h(t(ws)),ve(" "+O(t(Ee)((ie=(p=_.item.arc)==null?void 0:p.stat)==null?void 0:ie.view)),1)])),u("span",js,[h(t(ks)),ve(" "+O(t(Ee)((se=(K=_.item.arc)==null?void 0:K.stat)==null?void 0:se.danmaku)),1)])])])]),t(b)&&t(C).includes(_.item.bvid)?(r(),f("div",Gs,[(r(!0),f(Ye,null,ct(_.item.pages,(z,le)=>(r(),f("div",{class:"page-list-item",key:z.cid,onClick:pa(de=>G(le),["stop"])},[u("div",Qs,[t(P).cid===z.cid?(r(),f("img",Xs)):Y("",!0),u("span",{class:ae(["page-list-title",{active:t(P).cid===z.cid}]),textContent:O(z.part),title:z.part},null,10,Zs)]),u("div",en,O(t(ra)("(hh:)?mm:ss",(z.duration||0)*1e3-1)),1)],8,Js))),128))])):Y("",!0)],2)):Y("",!0)],4)}}});var an=ja(tn,[["__scopeId","data-v-2efc14d2"]]);const sn={class:"card-left flex_shrink_0 mr_xs"},nn={class:"item-driation"},ln={class:"card-right flex_col"},on={class:"text1 text_ellipsis_2l w_100 mt_sm"},un={key:0,src:ya,alt:""},cn=Fe({__name:"UgcMultiIPtem",props:{item:{type:Object,default:()=>({})},src:String,y:Number,h:Number},setup(_){const S=Ra(),{activeItem:i,videoInfo:F}=Z(Se()),U=v(null),P=v(!1);return jt(U,([{isIntersecting:C}])=>{P.value=C},{threshold:0}),(C,$)=>{const j=Me("VImg");return r(),f("div",{ref_key:"ugcSeasonItem",ref:U,class:"season-item"},[P.value?(r(),f("div",{key:0,class:ae(["season-item-wrap flex_start px_lg py_sm h_100",{active:_.item.cid===t(i).cid}])},[u("div",sn,[h(j,{class:"cover-img p_cover",src:t(F).pic,width:140*t(S),height:78*t(S),loading:"lazy",rule:"1c"},null,8,["src","width","height"]),u("div",nn,O(t(ra)("(hh:)?mm:ss",(_.item.duration||0)*1e3-1)),1)]),u("div",ln,[u("h4",on,[_.item.cid===t(i).cid?(r(),f("img",un)):Y("",!0),ve(" "+O(_.item.part),1)])])],2)):Y("",!0)],512)}}});const rn=["onClick"],dn={class:"video-section-tab-title text_nowrap text_ellipsis"},vn={class:"dropdown-btn-wrapper"},mn={class:"dropdown-btn-container p_absolute r_0 t_0"},fn=["title"],pn=Fe({__name:"SelectedSeasonSectionTabs",props:{rightPanelTab:null},emits:["select"],setup(_,{emit:S}){const i=_,{videoSeason:F,isShowComment:U,activeItem:P,videoEpisodes:C}=Z(Se()),$=v(),j=v(!1),T=v(-1),w=X(()=>{var m,x;return((x=(m=F.value)==null?void 0:m.sections)==null?void 0:x.map(L=>({id:L.id,type:"",label:L.title})))||[]});let b;const D=(m,x=!0)=>{S("select",m),T.value=m.id,x&&c()},E=()=>{clearTimeout(b)},G=()=>{b=window.setTimeout(()=>{$e.emit("hidePopover")},300)},c=()=>{Ta(()=>{if(!$.value)return;const m=$.value.querySelector(".video-section-tab.active");m&&($.value.scrollLeft=m.offsetLeft)})};return rt(()=>{R(()=>w.value.map(m=>m.id).join(","),(m,x)=>{m!==x&&Ta(()=>{var I,p;j.value=((I=$.value)==null?void 0:I.scrollWidth)>((p=$.value)==null?void 0:p.clientWidth),c()})},{deep:!0,immediate:!0}),R(()=>[U.value,i.rightPanelTab],([m,x])=>{(m||x==="1")&&c()},{immediate:!0}),R(()=>[P.value.cid,C.value],([m,x])=>{m&&(x==null||x.forEach(L=>{L.cid===m&&(T.value=L.section_id,setTimeout(()=>c()))}))},{immediate:!0})}),(m,x)=>{var L;return r(),f("div",{class:"video-section-tabs-wrapper",onMouseenter:E,onMouseleave:G},[u("div",{class:ae(["video-section-tabs flex_row",{"show-dropdown":j.value}]),ref_key:"tabsDom",ref:$},[(r(!0),f(Ye,null,ct((L=t(F))==null?void 0:L.sections,I=>(r(),f("div",{class:ae(["video-section-tab",{active:T.value===I.id}]),key:I.id,onClick:p=>D(I,!1)},[u("span",dn,O(I.title),1)],10,rn))),128))],2),xe(u("div",vn,[u("div",mn,[h(Ps,{class:"btn-more",items:t(w),onSelect:D},{label:ce(({item:I})=>[u("div",{class:ae(["dropdown-menu-item",{active:T.value===I.id}]),title:I.label},O(I.label),11,fn)]),default:ce(()=>[h(t(qa),{class:"dropdown-btn rotate_90 p_absolute text3"})]),_:1},8,["items"])])],512),[[De,j.value]])],32)}}});var gn=ja(pn,[["__scopeId","data-v-48741463"]]);const _n={class:"ugc_season--season-title px_lg"},hn={class:"py_lg bb_1 bc_line_light"},yn={key:0,class:"season-tt seaon-se flex_between"},bn={class:"season-tt-left"},Sn={class:"text1 flex_start"},wn=["title"],kn={class:"left-info mt_xs"},Pn={key:0,class:"text3"},Cn={key:1,class:"play-num text3"},In={key:2,class:"abstract"},Tn=ve(" \xA0\xB7\xA0 "),En={key:0,class:"season-intro"},xn={class:"season-tt-right flex_shrink_0"},Dn=ve(" \u8BA2\u9605\u5168\u96C6 "),$n=ve("\u5DF2\u8BA2\u9605"),Mn={key:1,class:"season-tt season-mp"},Fn={class:"text1 flex_start"},Ln=["title"],An={class:"left-info mt_xs text3"},Rn={key:0},Vn={key:1,class:"play-num"},Bn={class:"ml_md"},On={class:"season-items"},Un=u("br",null,null,-1),Nn=ve("\u9876\u90E8 "),Wn=Fe({__name:"UgcSeasonPanelSeason",props:{info:{type:Object,default:()=>({})},videoItemDom:String},setup(_){const S=_,{calculateEpHeight:i}=Ga(),F=Se(),{pageType:U,videoInfo:P,videoSeason:C,videoEpisodes:$,videoPages:j,activeIndex:T,activeItem:w,isShowComment:b,rightPanelTab:D}=Z(F),E=X(()=>U.value==="ugcSeason"),{abTestInfo:G}=Z(_a()),c=v(-1),m=X(()=>{let{stat:g,id:M,enable_vt:ee}=C.value,{enable_vt:B,stat:Q}=P.value;return{id:M,view:Ee(g==null?void 0:g.view),vt:Ee(g==null?void 0:g.vt),enableVt:!!ee,viewP:Ee(Q==null?void 0:Q.view),vtP:Ee(Q==null?void 0:Q.vt),enableVtP:!!B}}),x=v(!1),{userInfo:L}=Z(Va()),I=da("tripleData"),p=da("updateTripleData"),ie=v(null);jt(ie,([{isIntersecting:g}])=>{g&&S.info.cid===w.value.cid&&re({type:"show",spm_info:"main.play-story.ugc-season.season"},{msg:JSON.stringify({isTab:G.value.is_ugc_season_tab})})});const K=v(null),se=v(0),z=X(()=>{var g,M;return((M=(g=K.value)==null?void 0:g.$el)==null?void 0:M.getClientRects()[0])||{}}),le=X(()=>S.info.cid===w.value.cid&&se.value&&se.value>200),de=()=>{var g;se.value=((g=K.value.$el)==null?void 0:g.scrollTop)||0};Ba(()=>{var g;S.info.cid===w.value.cid&&(g=K.value)!=null&&g.$el&&(K.value.$el.scrollTop=se.value)});const V=g=>{var B;let M=0;const ee=100;if(E.value)for(let Q=0;Q<$.value.length;Q++){const N=$.value[Q];if(((B=N.pages)==null?void 0:B.length)>1){if(N.pages.some(ue=>ue.cid===g))break;M+=i(N),Q+=N.pages.length-1}else{if(N.cid===g)break;M+=ee}}else M+=ee*(T.value-1);return M},q=()=>{if(S.info.cid===w.value.cid&&K.value.$el){const g=V(S.info.cid);Aa(g,{element:K.value.$el,animation:!1})}},oe=g=>{c.value=g.id;const M=$.value.find(B=>B.section_id===g.id),ee=V(M.cid);Aa(ee,{element:K.value.$el})};rt(()=>{R(()=>S.info.cid,g=>{g&&de()},{immediate:!0}),R([w,b],([g,M],[,ee])=>{const B=M!==ee;S.info.cid===g.cid&&M&&(B?setTimeout(()=>q()):q())},{immediate:!0,flush:"post"}),R(D,g=>{S.info.cid===w.value.cid&&g==="1"&&setTimeout(()=>q())})});const je=()=>{Yt({element:K.value.$el})};let me=!1;const Ge=g=>{if(!L.value.isLogin)return ha("videoSection.favCollection");me||(me=!0,va.seasonfav({platform:"web",season_id:C.value.id},!0).then(M=>{if(M.code!==0){Ea({el:g.target,msg:M.message||"\u8BA2\u9605\u5931\u8D25",cd:1e3,type:"error"});return}p==null||p(S.info.cid,"orderState",!0)}).catch(()=>{}).finally(()=>{me=!1}))},Je=g=>{me||(me=!0,va.seasonfav({platform:"web",season_id:C.value.id},!1).then(M=>{if(M.code!==0){Ea({el:g.target,msg:M.message||"\u53D6\u6D88\u8BA2\u9605\u5931\u8D25",cd:1e3,type:"error"});return}p==null||p(S.info.cid,"orderState",!1)}).catch(()=>{}).finally(()=>{me=!1}))},Le=g=>{S.info.cid===w.value.cid&&g+1!==T.value&&(A.emit("initVideoList",g+1),re({type:"click",spm_info:"main.play-story.right-panel.item"},{msg:JSON.stringify({})}))};return(g,M)=>{var Q,N,he;const ee=Me("v-button"),B=Me("Scroller");return r(),f("div",{class:"ugc_season--season h_100",ref_key:"pageRef",ref:ie},[u("div",_n,[u("div",hn,[t(U)==="ugcSeason"?(r(),f("div",yn,[u("div",bn,[u("h4",Sn,[u("span",{class:"tt-text text_ellipsis",title:t(C).title},O(t(C).title),9,wn),u("span",null,"\uFF08"+O(t(T))+"/"+O(t($).length)+"\uFF09 ",1)]),u("div",kn,[t(m).enableVt?(r(),f("span",Pn,O(t(m).vt)+"\u5206\u949F\u64AD\u653E",1)):(r(),f("span",Cn,O(t(m).view)+"\u64AD\u653E",1)),(Q=t(C))!=null&&Q.intro?(r(),f("span",In,[Tn,u("span",{class:"cs_pointer brand_pink",onMouseenter:M[0]||(M[0]=ue=>x.value=!0),onMouseleave:M[1]||(M[1]=ue=>x.value=!1)}," \u7B80\u4ECB ",32)])):Y("",!0),h(Ct,{name:"fade"},{default:ce(()=>[x.value?(r(),f("div",En,O(t(C).intro),1)):Y("",!0)]),_:1})])]),u("div",xn,[t(I).orderState?(r(),ke(ee,{key:1,size:"small",onClick:Je},{default:ce(()=>[$n]),_:1})):(r(),ke(ee,{key:0,class:"order-btn",type:"pink",size:"small",plain:"","active-pink":"",onClick:Ge},{default:ce(()=>[Dn]),_:1}))])])):(r(),f("div",Mn,[u("h4",Fn,[u("span",{class:"tt-text text_ellipsis",title:t(P).title},O(t(P).title),9,Ln),u("span",null,"\uFF08"+O(t(T))+"/"+O(t(j).length)+"\uFF09",1)]),u("div",An,[t(m).enableVtP?(r(),f("span",Rn,O(t(m).vtP)+"\u5206\u949F\u64AD\u653E",1)):(r(),f("span",Vn,O(t(m).viewP)+"\u64AD\u653E",1)),u("span",Bn,O(t(Ls)("YYYY-MM-DD",t(P).pubdate*1e3)),1)])]))])]),t(E)&&((N=t(C).sections)==null?void 0:N.length)>1?(r(),ke(gn,{key:0,rightPanelTab:t(D),onSelect:oe},null,8,["rightPanelTab"])):Y("",!0),h(B,{class:ae(["ugc_season--season-scroll page_scroller pt_sm",{"show-sections":t(E)&&((he=t(C).sections)==null?void 0:he.length)>1}]),ref_key:"seasonRef",ref:K,onScroll:de},{default:ce(()=>[u("div",On,[t(E)?(r(!0),f(Ye,{key:0},ct(t($),(ue,ne)=>(r(),f(Ye,null,[ne===0||t($)[ne-1].bvid!==ue.bvid?(r(),ke(an,{key:ue.cid,item:ue,y:t(z).y,h:t(z).height,i:ne,onSelect:Le},null,8,["item","y","h","i"])):Y("",!0)],64))),256)):(r(!0),f(Ye,{key:1},ct(t(j),(ue,ne)=>(r(),ke(cn,{key:ue.cid,item:ue,y:t(z).y,h:t(z).height,onClick:Qe=>Le(ne)},null,8,["item","y","h","onClick"]))),128)),u("p",{class:ae(["b_text text3 text_center mt_md",{visible:t(le),invisible:!t(le)}])}," \u6CA1\u6709\u66F4\u591A\u5566 ",2)]),t(le)?(r(),ke(ee,{key:0,class:"btn-to-top",title:"\u56DE\u5230\u9876\u90E8","active-shrink":"",onClick:je},{default:ce(()=>[h(t(Ya),{class:"icon-to-top"}),Un,Nn]),_:1})):Y("",!0)]),_:1},8,["class"])],512)}}});const Hn={class:"season_selected--comment-container"},Kn={class:"pc-comment-tab-header"},zn=u("span",null,"\u8BE6\u60C5",-1),qn={class:"pc-comment-tab-header"},Yn=ve(),jn=u("span",null,"\u5BF9\u8BDD\u5217\u8868",-1),Gn=u("br",null,null,-1),Jn=ve("\u9876\u90E8 "),Qn=Fe({__name:"UgcSeasonPanelComment",props:{info:{type:Object,default:()=>({})},fromSpmid:String,trackId:String,videoItemDom:String},setup(_){const S=_,i=X(()=>S.info.id),{isShowComment:F,rightPanelTab:U,activeItem:P,fromItem:C}=Z(Se()),{abTestInfo:$}=Z(_a()),{spmid:j}=Ka(),T=v(null),w=v(null),b=v(null),D=v(!1),E=v(!1),G=v(!1),c=X(()=>L.value==="list"?D.value:L.value==="detail"?E.value:G.value),{commentsInstance:m,initComment:x,currentCommentType:L,clearComment:I,changeComment:p}=Cs("player"),ie=V=>{switch(V){case"list":Yt({element:T.value});break;case"detail":Yt({element:w.value});break;case"dialog":Yt({element:b.value});break}},K=()=>{T.value&&T.value.scrollTop>=250?D.value=!0:D.value=!1},se=()=>{w.value&&w.value.scrollTop>=250?E.value=!0:E.value=!1},z=()=>{b.value&&b.value.scrollTop>=250?G.value=!0:G.value=!1},le=v(null);jt(le,([{isIntersecting:V}])=>{S.info.cid===P.value.cid&&V&&re({type:"show",spm_info:"main.play-story.ugc-season.comment"},{msg:JSON.stringify({isTab:$.value.is_ugc_season_tab})})});const de=()=>{m.value||x({oid:i.value,type:1,videoOptions:{type:"ugc",aid:i.value,trackId:S.trackId},spmInfo:{spmid:j.value,from_spmid:S.fromSpmid,from_outer_spmid:""},seekHandler:V=>{Ua({...V,p:V.p===-1?1:V.p})},previewImageHandler:(V,q)=>{$e.emit("hidePopover"),$e.emit("visitGallery",{container:".app_selected--wrapper",downloadable:!1,items:V.map(oe=>({src:oe.img_src,width:oe.img_width,height:oe.img_height,size:oe.img_size,tags:[]})),index:q})}},{container:T.value,detailContainer:w.value,dialogContainer:b.value})};return Oa.on("commentsReload",()=>{I({container:T.value,detailContainer:w.value,dialogContainer:b.value}),T.value&&de()}),rt(()=>{R([F,U],([V,q])=>{S.info.cid===P.value.cid&&(V&&q==="2"?de():$e.emit("leaveGallery"))}),R([()=>S.info.cid,P],([V,q])=>{V===q.cid?(I({container:T.value,detailContainer:w.value,dialogContainer:b.value}),F.value&&U.value==="2"&&de()):T.value&&m.value&&setTimeout(()=>I({container:T.value,detailContainer:w.value,dialogContainer:b.value}),300)})}),(V,q)=>(r(),f("div",{class:"season_selected--comment ugc-cmt",ref_key:"pageRef",ref:le},[u("div",Hn,[u("div",{class:"season_selected--comment-dom",id:"pc-comment-container",ref_key:"commentDom",ref:T,onScroll:K},null,544),t(L)==="detail"||t(L)==="dialog"?(r(),f("div",{key:0,class:"season_selected--comment-dom",id:"pc-comment-detail-container",ref_key:"commentDetailDom",ref:w,onScroll:se},[u("div",Kn,[u("span",{onClick:q[0]||(q[0]=oe=>t(p)("list")),class:"pc-comment-back-icon change-left"},[h(t(La))]),zn])],544)):Y("",!0),t(L)==="dialog"?(r(),f("div",{key:1,class:"season_selected--comment-dom",id:"pc-comment-dialog-container",ref_key:"commentDialogDom",ref:b,onScroll:z},[u("div",qn,[u("span",{onClick:q[1]||(q[1]=oe=>t(p)("detail")),class:"pc-comment-back-icon"},[h(t(La))]),Yn,jn])],544)):Y("",!0),xe(u("div",{title:"\u56DE\u5230\u9876\u90E8",class:"pc-comment-top-button",onClick:q[2]||(q[2]=oe=>ie(t(L)))},[h(t(Ya),{class:"icon-to-top"}),Gn,Jn],512),[[De,t(c)]])])],512))}});const Xn={class:"ugc_season--panel-tabs bt_1 bb_1 bc_line_light px_lg p_relative"},Zn={class:"ugc_season--panel-content"},ei=Fe({__name:"UgcSeasonPanel",props:{info:{type:Object,default:()=>({})},video:{type:Object,default:()=>({})},fromSpmid:String,trackId:String,videoItemDom:String},setup(_){const S=_,i=Se(),{rightPanelTab:F,isUgcSeason:U,activeItem:P}=Z(i),{abTestInfo:C}=Z(_a()),$=X(()=>{var b,D;return Ee((D=(b=S.video.View)==null?void 0:b.stat)==null?void 0:D.reply)}),j=()=>{A.emit("hideComment"),re({type:"click",spm_info:"main.play-story.right-panel.close"},{msg:JSON.stringify({})})},T=b=>{F.value=b},w=b=>{var E;const D=qe(b.target,".vui_tabs--nav-item");D&&((E=D.innerText)!=null&&E.includes("\u8BC4\u8BBA")?re({type:"click",spm_info:"main.play-story.ugc-season.comment-tab"},{msg:JSON.stringify({})}):re({type:"click",spm_info:"main.play-story.ugc-season.season-tab"},{msg:JSON.stringify({})}))};return rt(()=>{R([()=>S.videoItemDom,$,P,F],([b,D,E,G])=>{if(!C.value.is_ugc_season_tab&&G!=="2")return;const c=document.querySelector(`${b} .vui_tabs--nav-num`);c&&(E.id===S.info.id?c.textContent=String(D):c.textContent="")},{flush:"post"})}),(b,D)=>{const E=Me("v-tab-item"),G=Me("v-tabs");return r(),f("div",{class:ae(["ugc_season--panel h_100",{"alone-panel":!t(C).is_ugc_season_tab}])},[u("div",Xn,[h(G,{autoAdjustment:"","active-key":t(F),"slide-to-hover":!1,"active-pink":!0,"tabs-gutter":32,"slider-width":18,onClick:D[0]||(D[0]=c=>w(c)),onTabChange:T},{default:ce(()=>[t(C).is_ugc_season_tab||t(F)==="1"?(r(),ke(E,{key:"1",tab:t(U)?"\u5408\u96C6":"\u9009\u96C6"},null,8,["tab"])):Y("",!0),t(C).is_ugc_season_tab||t(F)==="2"?(r(),ke(E,{key:"2",tab:"\u8BC4\u8BBA",num:1})):Y("",!0)]),_:1},8,["active-key"]),u("span",{class:"ugc_season--panel-close p_center_y r_md",onClick:j},[h(t(Ms))])]),u("div",Zn,[xe(h(Wn,{info:_.info,videoItemDom:_.videoItemDom},null,8,["info","videoItemDom"]),[[De,t(F)==="1"]]),xe(h(Qn,{info:_.info,videoItemDom:_.videoItemDom,fromSpmid:_.fromSpmid,trackId:_.trackId},null,8,["info","videoItemDom","fromSpmid","trackId"]),[[De,t(F)==="2"]])])],2)}}});const ti=["data-cid"],ai={class:"app_selected--endpage p_center text_white text_center cs_pointer"},si=u("p",{class:"mt_sm"},"\u91CD\u64AD",-1),ni=u("span",null,"\u8BE6\u60C5\u9875",-1),ii=ve(" \xA0 "),li=u("span",null,"\u8BE6\u60C5\u9875",-1),oi=["onClick"],ui=Fe({__name:"UgcSeasonItem",props:{info:{type:Object,default:()=>({})},playingList:{type:Array,default:()=>[]},index:Number,width:Number,height:Number,activeId:Number,isOnSliding:Boolean,isWinVisiable:Boolean,isSelectedPage:Boolean},emits:["playerInited","playerEnded"],setup(_,{emit:S}){const i=_,F=v(),U=v({}),P=v({}),C=v({}),$=v(!1),j=v(!1),T=v(!1),w=v(!1),b=v(!1),D=v(!1),E=v(!1),G=X(()=>i.activeId&&i.activeId===i.info.cid),c=X(()=>G.value&&i.isSelectedPage),m=X(()=>c.value&&!i.isOnSliding),x=X(()=>`.app_selected--us .app_selected--item[data-cid="${i.info.cid}"]`),L=X(()=>`${x.value} .bpx-player-summary-wrap`),I=X(()=>i.isSelectedPage&&E.value&&w.value&&i.info.cid),p=window,ie=v(!0),K=v(!1),se=[0,1,2],z=v(!1),le=v(!1),de=da("hasActiveDialog"),{isGpuDisabled:V}=Z(Ja()),{userInfo:q}=Z(Va()),{isMainMini:oe}=Z(Qa()),je=Se(),{reportGoToDetails:me,reportToggleDetails:Ge,reportSwitchVideo:Je}=je,{pageInited:Le,seekTime:g,activeItem:M,activeVideo:ee,fromItem:B,rightPanelTab:Q,isShowComment:N,isShowMiniBtns:he,isMiniShowLike:ue,isMiniPanelHover:ne,isPlayerControlHover:Qe}=Z(je);Kt(()=>{var a,e;((a=i.info)==null?void 0:a.cid)&&i.info.cid===((e=M.value)==null?void 0:e.cid)&&(ee.value=U.value)});const{player:l,itemInfo:ye,fromSpmid:It,trackId:W,firstInfo:fe,firstPlay:Gt,restartPlay:Tt,heartbeat:Xe,reportHistory:be}=Ka();Kt(()=>{ye.value=i.info,It.value=`main.play-story.video.${B.value._location||0}.click`});const Ae=Na(),{resetToolStore:Jt,initToolStore:J,initTriple:Et,initFollowed:xt,setLike:Ze,setCoin:Dt,setFav:dt}=Ae,{cid:pe}=Z(Ae),$t=v(!1);R([()=>i.width,N],([a,e])=>{$t.value=e?a<1360:a<980},{immediate:!0}),R(()=>i.info.cid,a=>{a&&(E.value=!1,D.value=!1,w.value=!1,K.value=!1,fe.value=null,Pe(),Ft(!0),setTimeout(()=>{const e=document.querySelector(`${x.value} .video-backdrop-bg`),o=document.querySelector(`${x.value} .video-backdrop-blur`);e&&(e.style.background="#000"),o&&(o.style.background="#000")}))},{immediate:!0}),R(c,a=>{a&&pe.value!==i.info.cid&&Jt()}),R([c,I],([a,e])=>{a&&e&&J(l.value,i.info,U.value)}),R([c,P],([a,e])=>{a&&e.init&&Et(e)}),R([c,C],([a,e])=>{var o,d,H;a&&((o=e[0])==null?void 0:o.followed)&&xt((H=e[(d=i.info.owner)==null?void 0:d.mid])==null?void 0:H.followed)}),zt("updateVideoData",(a,e,o)=>{a===i.info.cid&&(U.value.View.stat[e]=o)});const vt=(a,e,o)=>{a===i.info.cid&&(P.value[e]=o)};zt("tripleData",P),zt("updateTripleData",vt);let mt=null,et=0;const Ft=async(a=!1)=>{if(!(!i.info.bvid||!a&&et>3))try{U.value=await Ha({bvid:i.info.bvid}),w.value=!0,ft(),ba(),et=0,clearTimeout(mt)}catch(e){console.error(e),et++,mt=setTimeout(()=>Ft(),1e3)}},ft=async()=>{if(!!i.info.bvid)try{const e=(await va.getVideoState(i.info.bvid)).data||{};P.value={init:!0,liked:e.like,faved:e.favorite,hasCoined:e.coin,orderState:e.season_fav}}catch(a){console.error(a)}},ba=async()=>{var a;if(!!q.value.isLogin)try{const e=(((a=U.value.View)==null?void 0:a.staff)||[]).map(o=>o.mid);e.includes(i.info.owner.mid)||e.unshift(i.info.owner.mid),C.value=await Vs(e)||{}}catch(e){console.error(e)}};Kt(()=>{i.isSelectedPage&&b.value&&i.info.cid&&!D.value&&Pe()});const Pe=async()=>{var e,o;D.value=!0;const a={element:F.value,fullWrap:document.querySelector(".app_selected--content"),aid:i.info.id,cid:i.info.cid,channelKind:7,pcSpecialMode:!0,controlsList:new Set(["noPlaybackClue","noPBP"]),featureList:new Set(["noToast","noVVReport","noVTReport"]),storageKey:"Pc-Special",autoplay:!1,enableHEVC:!0,enableAV1:!0,hideBoxShadow:!0,iid:"pc_app_selected"};c.value&&!Le.value&&(Le.value=!0,g.value&&(a.t=g.value));try{l.value.reload?(await l.value.reload(a),c.value&&l.value.play()):(p.nano||await p.loadBiliPlayer(),l.value=p.nano.createPlayer(a,{"bpx-primary-color":"#f69","bpx-fn-color":"#f69","bpx-fn-hover-color":"#f69"}),Re(),await l.value.connect(),document.fullscreenElement&&l.value.setSideScreen(p.nano.ScreenKind.Full),G.value||(o=(e=l.value).toggleFeature)==null||o.call(e,{shortcut:!0})),p.ugcSeasonPlayers[i.info.cid]=l.value,E.value=!0}catch(d){console.error(d)}},tt=()=>{var a,e;if(l.value.disconnect)try{c.value&&Xe(),(e=(a=l.value)==null?void 0:a.disconnect)==null||e.call(a),p.ugcSeasonPlayers&&(p.ugcSeasonPlayers[i.info.cid]=null,delete p.ugcSeasonPlayers[i.info.cid])}catch(o){console.error(o)}},Re=()=>{const a=p.nano;l.value.on(a.EventType.Player_Virtual_Action,Qt),l.value.on(a.EventType.Player_Play,Lt),l.value.on(a.EventType.Player_Pause,gt),l.value.on(a.EventType.Player_Ended,Ve),l.value.on(a.EventType.Player_Danmaku_Change,Xt),l.value.on(a.EventType.Player_Quality_Requested,At),l.value.on(a.EventType.Player_RateChange,Rt),l.value.on(a.EventType.Player_VolumeChange,Zt),l.value.on(a.EventType.Player_Summary_Change,at),l.value.on(a.EventType.Player_Aspect_Switch_Change,st),l.value.on(a.EventType.Player_Initialized,nt),l.value.on(a.EventType.Player_Show_EndPanel,()=>le.value=!0),l.value.on(a.EventType.Player_Hide_EndPanel,()=>le.value=!1)},Qt=({detail:a})=>{var d,H,te,ge,Ce,_e,lt;if(!a)return;const e=a.data,o=p.nano;switch(a.kind){case o.InternalKind.OpenUrl:Za(vs(a.data),"selected.JumpEvent");return;case o.InternalKind.First_Playtime:(!fe.value||fe.value.aid!==((d=a.data)==null?void 0:d.aid))&&(fe.value=a.data,Gt(),(H=B.value)!=null&&H.cid||Je("auto",0));return;case o.InternalKind.Report_Observer:{const Ie=(te=e==null?void 0:e.options)==null?void 0:te.spm_id,Ke=Ie?Ie.split(".").slice(0,-1).join("."):"",Ot="main.play-story."+Ke,Ut=(e==null?void 0:e.type)==="appear"?"show":e==null?void 0:e.type;re({type:Ut,spm_info:Ot},{msg:typeof((ge=e==null?void 0:e.options)==null?void 0:ge.msg)=="string"?(Ce=e==null?void 0:e.options)==null?void 0:Ce.msg:JSON.stringify((lt=(_e=e==null?void 0:e.options)==null?void 0:_e.msg)!=null?lt:{})});break}}if(!q.value.isLogin&&a.kind<11){ha("ugcPlayer.videoEvents"+a.kind);return}switch(a.kind){case o.InternalKind.Like:Ze(i.info.id);break;case o.InternalKind.Coin:Dt();break;case o.InternalKind.Collect:dt();break;case o.InternalKind.Triple:$e.emit("playerTriple",{type:"ugc",action:a.data.action});break;case o.InternalKind.Super_Quality_Guide:es("qnPay");break}},pt=()=>{var a,e,o,d;ie.value?(e=(a=l.value).play)==null||e.call(a):(d=(o=l.value).pause)==null||d.call(o)},Lt=()=>{var a,e,o,d;c.value?ie.value=(e=(a=l.value).isPaused)==null?void 0:e.call(a):(d=(o=l.value).pause)==null||d.call(o)},gt=()=>{var a,e;ie.value=(e=(a=l.value).isPaused)==null?void 0:e.call(a),m.value&&be()},Ve=()=>{c.value&&(de!=null&&de()?l.value.pause():S("playerEnded"))},Xt=a=>{if(T.value){const e=l.value.danmaku.isOpen();ze(ia,{isDmOpen:e,idxs:We(se)})}},At=a=>{const e=l.value.getQuality();ze(la,{qn:e,idxs:We(se)})},Rt=a=>{if(G.value){const e=l.value.getPlaybackRate();e<3&&ze(Ma,{rate:e})}},Zt=qt(()=>{const a=l.value.getVolume();ze(oa,{volume:a,idxs:We(se)})},200),at=a=>{Ge(!a.detail),z.value=a.detail},st=a=>{var d;const e=(d=l.value)==null?void 0:d.mediaElement(),o=!!(a.detail&&e);if(o){const{videoWidth:H,videoHeight:te}=e;ma({width:H,height:te})}else ma(null);re({type:"click",spm_info:"main.play-detail.player.aspect-ratio"},{msg:JSON.stringify({win_name:"main",is_set_aspect:o})})},nt=()=>{var o,d;if(V.value||K.value||!l.value.mediaElement)return;K.value=!0;const a=(d=(o=l.value).mediaElement)==null?void 0:d.call(o),e=a==null?void 0:a.parentElement;if(e){let H=e.querySelector(".video-backdrop-bg"),te=e.querySelector(".video-backdrop-blur");te||(te=document.createElement("div"),te.classList.add("video-backdrop","video-backdrop-blur"),e.prepend(te)),H||(H=document.createElement("div"),H.classList.add("video-backdrop","video-backdrop-bg"),e.prepend(H));const{videoWidth:ge,videoHeight:Ce}=a;let _e=document.createElement("canvas");_e.width=ge,_e.height=Ce,_e.getContext("2d").drawImage(a,0,0,ge,Ce),_e.toBlob(Ie=>{if(Ie){const Ke=URL.createObjectURL(Ie);H.style.backgroundImage=`url(${Ke})`,te.style.backgroundImage=`url(${Ke})`}_e=null},"image/jpeg",.6)}},Be=a=>{var e;((e=a.key)==null?void 0:e.toLowerCase())==="d"&&ht()},Oe=a=>{var e;(e=a.target)!=null&&e.classList.contains("bui-danmaku-switch-input")&&ht()};let _t=null;const ht=()=>{T.value=!0,clearTimeout(_t),_t=setTimeout(()=>T.value=!1,200)},Vt=(a,e)=>{C.value[a]&&(C.value[a].followed=e)},it=()=>{var a,e,o,d;!m.value||((e=(a=l.value).pause)==null||e.call(a),Ua({type:"ugc",bvid:i.info.bvid,cid:i.info.cid,t:((d=(o=l.value).getCurrentTime)==null?void 0:d.call(o))||0,fromSpmid:fa.selected,exitMini:!0}),me())};A.on("viewDetails",it);const yt=()=>{c.value&&(N.value=!N.value)};A.on("toggleUgcSeason",yt);const ea=()=>{$.value=!1,clearTimeout(Ue)};let Ue=null;const Ne=ts(()=>{$.value=!0,clearTimeout(Ue),Ue=setTimeout(()=>$.value=!1,1e3)},200),We=a=>a.filter(e=>se.includes(e)&&e!==i.index),He=a=>[a.includes(i.index),We(a)];let bt=null;R(c,a=>{var e,o,d,H,te,ge,Ce,_e,lt,Ie,Ke,Ot,Ut,Sa,wa,ka;if(clearTimeout(bt),a){const{isDmOpen:ta,idxs:Pa}=Nt(ia)||{};if(Bs(ta)&&Pa){const[kt,Te]=He(Pa);kt&&(ta?(e=l.value.danmaku)==null||e.open():(o=l.value.danmaku)==null||o.close()),ze(ia,Te.length?{isDmOpen:ta,idxs:Te}:null)}const{qn:ot,idxs:Ca}=Nt(la)||{};if(na(ot==null?void 0:ot.newQ)&&Ca){const[kt,Te]=He(Ca);kt&&(((H=(d=l.value).getQuality)==null?void 0:H.call(d))||{}).newQ!==ot.newQ&&((ge=(te=l.value).requestQuality)==null||ge.call(te,ot.newQ)),ze(la,Te.length?{qn:ot,idxs:Te}:null)}const{rate:aa}=Nt(Ma)||{};aa&&na(aa)&&((_e=(Ce=l.value).setPlaybackRate)==null||_e.call(Ce,aa));const{volume:sa,idxs:Ia}=Nt(oa)||{};if(na(sa)&&Ia){const[kt,Te]=He(Ia);kt&&((Ie=(lt=l.value).setVolume)==null||Ie.call(lt,sa)),ze(oa,Te.length?{volume:sa,idxs:Te}:null)}(Ot=(Ke=l.value).setDmSetting)==null||Ot.call(Ke),(Sa=(Ut=l.value).toggleFeature)==null||Sa.call(Ut,{shortcut:!1})}else(ka=(wa=l.value).toggleFeature)==null||ka.call(wa,{shortcut:!0}),$e.emit("leaveGallery")}),R([c,l],([a])=>{var e,o;a?l.value.play&&(i.isWinVisiable?(l.value.play(),fe.value&&Tt()):j.value=!0,p.ugcSeasonPlayers.activePlayer!==l.value&&(p.ugcSeasonPlayers.activePlayer=l.value),p.biliPlayer!==l.value&&(p.biliPlayer=l.value),S("playerInited")):((o=(e=l.value).pause)==null||o.call(e),Xe())});const we=()=>{!c.value||(N.value=!0)};A.on("showComment",we);const St=()=>{!c.value||(N.value=!1)};A.on("hideComment",St);const Bt=()=>{!c.value||(N.value=!N.value)};A.on("toggleRight",Bt);const wt=(a=!1)=>{!c.value||(Q.value!=="2"?(Q.value="2",N.value=!0):N.value?St():we(),a&&re({type:"click",spm_info:"main.play-story.ugc-season.comment-entrance"},{msg:JSON.stringify({})}))};A.on("toggleComment",wt),R(()=>i.isWinVisiable,a=>{var e,o;a?(c.value&&j.value&&((o=(e=l.value).play)==null||o.call(e),fe.value&&Tt(),Je("auto",0)),j.value=!1):c.value&&l.value.isPaused&&!l.value.isPaused()&&(l.value.pause(),Xe(),j.value=!0)});let s=null;const n=()=>{Qe.value=!0},y=()=>{Qe.value=!1};R(I,a=>{var e;a&&!s&&(s=(e=F.value)==null?void 0:e.querySelector(".bpx-player-control-wrap"),s&&(s.addEventListener("mouseenter",n,!1),s.addEventListener("mouseleave",y,!1)))}),R(G,a=>{var e,o;!a&&z.value&&((o=(e=F.value)==null?void 0:e.querySelector(".bpx-player-ctrl-clear"))==null||o.click())});const k=a=>{Ze(i.info.id,a)};return rt(()=>{b.value=!0,document.addEventListener("keydown",Be),document.addEventListener("mousedown",Oe)}),Wa(()=>{tt(),clearTimeout(mt),A.off("showComment",we),A.off("hideComment",St),A.off("toggleComment",wt),A.off("toggleUgcSeason",yt),document.removeEventListener("keydown",Be),document.removeEventListener("mousedown",Oe),s==null||s.removeEventListener("mouseenter",n,!1),s==null||s.removeEventListener("mouseleave",y,!1)}),(a,e)=>{const o=Me("WidgetArrow");return r(),f("div",{class:ae(["app_selected--item p_relative",{"app_selected--mini":t(oe),"app_selected--item-active":$.value,"app_selected--item-deactive":!$.value,"app_selected--item-showcmt":t(N),"app_selected--item-narrow":$t.value}]),"data-cid":_.info.cid,style:ga({height:_.height+"px"}),onMouseleave:ea,onMousemove:e[5]||(e[5]=(...d)=>t(Ne)&&t(Ne)(...d))},[u("div",{class:ae(["app_selected--player w_100 h_100",{"app_selected--shown":t(c)}]),ref_key:"selectedPlayerRef",ref:F},null,2),xe(u("div",ai,[h(t($s),{class:"icon"}),si],512),[[De,le.value]]),xe(u("div",{class:ae(["app_selected--cmtwrap bg_bg1 p_absolute r_0 t_0 b_0 h_100",{deactive:!t(G)}])},[h(ei,{info:_.info,video:U.value,fromSpmid:t(It),trackId:t(W),videoItemDom:t(x)},null,8,["info","video","fromSpmid","trackId","videoItemDom"])],2),[[De,t(N)]]),h(za,{loading:!E.value},null,8,["loading"]),u("div",{class:"app_selected--todetail flex_between u_select_none cs_pointer",onClick:it},[ni,h(o,{class:"i_icon_more"}),ii]),h(Ct,{name:"fade"},{default:ce(()=>[t(I)&&t(he)?(r(),f("div",{key:0,class:"app_selected--todetail-mini flex_between u_select_none cs_pointer",onClick:it,onMouseenter:e[0]||(e[0]=d=>ne.value=!0),onMouseleave:e[1]||(e[1]=d=>ne.value=!1)},[li,h(o,{class:"i_icon_more"})],32)):Y("",!0)]),_:1}),h(Ct,{name:"fade"},{default:ce(()=>[t(I)&&t(he)?(r(),f("div",{key:0,class:"app_selected--pause p_center",onClick:pa(pt,["stop"]),onMouseenter:e[2]||(e[2]=d=>ne.value=!0),onMouseleave:e[3]||(e[3]=d=>ne.value=!1)},[xe(h(t(Is),{class:"pause-icon"},null,512),[[De,!ie.value]]),xe(h(t(Ts),{class:"pause-icon"},null,512),[[De,ie.value]])],40,oi)):Y("",!0)]),_:1}),h(Ct,{name:"fade"},{default:ce(()=>[t(I)&&t(he)&&t(ue)?(r(),f("div",{key:0,ref:"like",class:ae(["app_selected--like-mini",{on:P.value.liked}]),onClick:e[4]||(e[4]=d=>k(d))},[h(t(Es),{class:"icon"})],2)):Y("",!0)]),_:1}),t(I)?(r(),ke(Xa,{key:0,to:t(L)},[h(ds,{ref:"selectedVideoInfoRef",from:"UgcSeason",info:_.info,video:U.value,tripleData:P.value,relations:C.value,isActive:t(c),isShowComment:t(N),onUpdateRelations:Vt},null,8,["info","video","tripleData","relations","isActive","isShowComment"])],8,["to"])):Y("",!0)],46,ti)}}});const ci=u("span",{class:"gamepad-cursor","data-tp":"selectedBtn"},null,-1),ri=["data-offset"],di={key:0,class:"load-error p_center"},vi=u("img",{class:"error-img",src:rs,alt:""},null,-1),mi=u("p",{class:"text_center mt_lg"},"\u54CE\u5440\uFF01\u597D\u50CF\u52A0\u8F7D\u5931\u8D25\u4E86>.<",-1),fi=[vi,mi],pi={class:"flex_col items_start"},gi=["onClick"],_i={key:0},hi={key:1},yi={key:2},bi={key:3},Si={key:4},wi=u("span",{class:"gamepad-cursor-player"},null,-1),Ni=Fe({__name:"UgcSeason",setup(_){const S=as(),i=v(null),F=v(null),U=v(null),P=v(null),C=v(null),$=300,j=500,T=v(!1),w=v(!1),b=v(null),D=v(0),E=v(0),G=v(ss()),c=v([]),m=v([]),x=v([]),L=v(null),I=v(0),p=v(0),ie=X(()=>-p.value*E.value),K=v([0,1,2]),se=X(()=>{const[s,n,y]=K.value;return{[s]:0,[n]:1,[y]:2}}),z=v(!1),le=Na(),{msgParent:de}=Z(le),V=X(()=>S.name==="UgcSeason"),q=ns(),{isShowGpPlayerMenu:oe}=Z(q),je=[{id:"toggleComment",text:"\u4FA7\u8FB9\u680F\uFF08\u5408\u96C6/\u8BC4\u8BBA\uFF09"},{id:"toggleDetails",text:"\u7B80\u4ECB"},{id:"toDetails",text:"\u8BE6\u60C5\u9875"},{id:"togglePlay",text:"\u6682\u505C"},{id:"toggleDm",text:"\u6253\u5F00/\u5173\u95ED \u5F39\u5E55"},{id:"playRatePlass",text:"\u500D\u901F +"},{id:"playRateMinus",text:"\u500D\u901F -"},{id:"toggleMute",text:"\u9759\u97F3"},{id:"volumePlass",text:"\u97F3\u91CF +"},{id:"volumeMinus",text:"\u97F3\u91CF -"},{id:"fullscreen",text:"\u5168\u5C4F"}];ms(".app_selected--content"),fs({spm_id:fa.ugcSeason,pageName:"UgcSeason"}),Ba(()=>{$e.emit("pageSpmIdChange",fa.ugcSeason),Oa.emit("commentsReload")});const me=Se(),{reportSwitchVideo:Ge}=me,{rightPanelTab:Je,pageInited:Le,seekTime:g,pageType:M,isUgcSeason:ee,videoInfo:B,cardInfo:Q,videoPages:N,curPage:he,curIndex:ue,allVideoList:ne,videoSeason:Qe,videoEpisodes:l,activeItem:ye,fromItem:It,isMainMini:W,isMainMouseOver:fe,isMainHeaderOver:Gt,isMiniShowLike:Tt,isMouseActive:Xe,isShowMiniBtns:be,isMiniPanelHover:Ae,isShowComment:Jt}=Z(me);ee.value=!1,ne.value=[],l.value=[],N.value=[],Je.value="1",Le.value=!1,Jt.value=!0,R([m,p],([s,n])=>{ye.value=s[n]||{}},{deep:!0}),R(ye,(s,n)=>{ma(null),J.dispatchEvent(new CustomEvent("setAspect",{detail:"unaspect"})),s&&(It.value=n)}),Kt(()=>{window.isMiniPlayer=W.value});const J=window;J.ugcSeasonPlayers={},R(m,s=>{Object.keys(J.ugcSeasonPlayers).forEach(n=>{n!=="activePlayer"&&s.every(y=>String(y.cid)!==String(n))&&delete J.ugcSeasonPlayers[n]})},{deep:!0}),J.appRequestLogin=()=>ha("videoPlayer"),J.appRequestFullScreen=s=>{is().then(()=>s())};let Et=null,xt=null,Ze=null;const Dt=()=>{clearTimeout(Et),clearTimeout(xt),clearTimeout(Ze)},dt=()=>{W.value=!0,$e.emit("leaveGallery"),ls.emit("closeMessagePanel"),we(),Dt(),Et=setTimeout(()=>{xa("window/miniMainWindow"),Ze=setTimeout(()=>{A.emit("miniUgcPlayerPin",!0)},500),Pt&&W.value&&(Da(be.value),xt=setTimeout(()=>{be.value&&vt()},1200))},50)},pe=()=>{Dt(),xa("window/unminiMainWindow")};A.on("miniSelectedPlayer",dt),A.on("unminiSelectedPlayer",pe);const $t=()=>{setTimeout(()=>{W.value?(pe(),re({type:"click",spm_info:"main.play-detail.header.mini-eixt"},{msg:JSON.stringify({win_name:"main",is_shortcut:!0})})):(dt(),re({type:"click",spm_info:"main.play-detail.header.mini-enter"},{msg:JSON.stringify({win_name:"main",is_shortcut:!0})}))})};R(W,()=>{var s,n,y;J.dispatchEvent(new CustomEvent("setAspect",{detail:"unaspect"})),(y=(n=(s=J.ugcSeasonPlayers)==null?void 0:s.activePlayer)==null?void 0:n.setState)==null||y.call(n,{[J.nano.InternalKind.DmSetting]:{noDmHover:W.value}})},{immediate:!0}),R(be,()=>{Pt&&W.value&&Da(be.value)},{immediate:!0}),R(V,s=>{!s&&W.value&&setTimeout(()=>pe())},{immediate:!0}),ut("window/mainWindowMiniChange",({data:s})=>{W.value=s,setTimeout(()=>Re())}),ut("window/mainWindowMouseLeave",()=>fe.value=!1),ut("window/playerWindowMiniChange",({data:s})=>{s&&W.value&&pe()});const Mt=v(!1),vt=()=>{os(),Mt.value=!0,fe.value=!0},mt=()=>Mt.value=!1;R([Mt,fe],([s,n])=>{Gt.value=!s&&n});let et=null;const Ft=()=>{Xe.value=!0,W.value&&!fe.value&&vt(),clearTimeout(et),et=setTimeout(()=>Xe.value=!1,1e3)},ft=s=>{if(T.value=!1,x.value=[],m.value=[],c.value=[...ne.value],s===1){p.value=0;const n=c.value.splice(0,3);m.value.push(...n)}else if(s>1){p.value=1;const n=c.value.splice(0,s+1);if(n.length===3)s===3&&x.value.push(n.shift());else if(n.length>3){let y=n.length-3;n.length===s&&y++;const k=n.splice(0,y);x.value.push(...k)}m.value.push(...n)}c.value.length||m.value.length===3?c.value.push({}):m.value.length===2&&m.value.push({}),T.value=!0};A.on("initVideoList",ft),(async()=>{const{cid:s,bvid:n,t:y}=S.query;if(!n||(g.value=y,z.value))return;z.value=!0;let k=0;try{const a=await Ha({bvid:n});B.value=a.View||{},Q.value=a.Card||{},Qe.value=B.value.ugc_season||{},l.value=[],(Qe.value.sections||[]).forEach(d=>{d.episodes.forEach(H=>{var te;((te=H.pages)==null?void 0:te.length)>1?H.pages.forEach(ge=>{l.value.push({...H,arc:{...H.arc,duration:ge.duration},cid:ge.cid})}):l.value.push(H)})});const e=l.value.findIndex(d=>B.value.aid===d.aid);ue.value=e>-1?e+1:1,N.value=B.value.pages||[];const o=N.value.findIndex(d=>d.cid===s);he.value=o>-1?o+1:1,l.value.length?(M.value="ugcSeason",ee.value=!0,k=ue.value,ne.value=l.value.map((d,H)=>(d.arc||(d.arc={}),{id:d.aid,cid:d.cid,bvid:d.bvid,duration:d.arc.duration,pubdate:d.arc.pubdate,enable_vt:d.arc.enable_vt,vt_display:d.arc.vt_display,pic:d.arc.pic,stat:d.arc.stat,title:d.title,owner:B.value.owner,_location:H}))):(M.value="multiPage",ee.value=!1,k=he.value,ne.value=N.value.map((d,H)=>({id:B.value.aid,cid:d.cid,bvid:B.value.bvid,duration:d.duration,pubdate:B.value.pubdate,enable_vt:B.value.enable_vt,vt_display:B.value.vt_display,pic:B.value.pic,stat:B.value.stat,title:B.value.title,owner:B.value.owner,_location:H}))),z.value=!1}catch{z.value=!1}ft(k)})();const Pe=qt(async(s,n)=>{if(!w.value&&!(p.value>0&&!c.value.length||ne.value.length===1)){if(w.value=!0,ye.value=m.value[p.value+1]||{},I.value=-E.value,await Ht($),Ge(s,n),w.value=!1,await Ht(),p.value>0){const y=c.value.shift();if(m.value.push(y),m.value.length>3){const k=m.value.shift();x.value.push(k)}K.value.push(K.value.shift()),L.value.append(L.value.firstElementChild)}else p.value=1;I.value=0}},j),tt=qt(async(s,n)=>{if(!w.value&&p.value!==0){if(w.value=!0,ye.value=m.value[p.value-1]||{},I.value=E.value,await Ht($),Ge(s,n),w.value=!1,await Ht(),x.value.length>0){const y=x.value.pop();m.value.unshift(y);const k=m.value.pop();c.value.unshift(k),K.value.unshift(K.value.pop()),L.value.prepend(L.value.lastElementChild)}else p.value=0;I.value=0}},j),Re=()=>{if(!!b.value&&(D.value=b.value.offsetWidth,E.value=b.value.offsetHeight,!E.value)){const s=document.querySelector(".app_container");s&&(D.value=s.offsetWidth,E.value=s.offsetHeight)}},Qt=200;let pt=!0,Lt=0,gt=0,Ve=0;const Xt=s=>{const n=Date.now();if(pt=n-Lt>Qt,Lt=n,Pt){const y=s.deltaY>0,k=gt>0,a=y!==k,e=Math.abs(s.deltaY)>Math.abs(gt);gt=s.deltaY,pt||a||e?(Ve++,Ve>100&&(Ve=100),Ve>2&&At(s.deltaY)):Ve=0}else pt&&At(s.deltaY)},At=qt(s=>{s<0?tt("roll",2):Pe("roll",1)},300,!0,!1),Rt=s=>{if(qe(s.target,".app_selected--item")){const n=qe(s.target,".bpx-player-hotkey-panel");if(!qe(s.target,".all-staff")&&!qe(s.target,".bili-dialog-m")&&!qe(s.target,".app_selected--cmtwrap")&&!qe(s.target,".video-desc-wrap.ov_overlay_y")&&!n&&Xt(s),!n)return s.stopPropagation(),!1}},Zt=()=>{document.fullscreenElement||(W.value&&pe(),setTimeout(()=>{re({type:"click",spm_info:"main.main.main-page.maximize"},{msg:JSON.stringify({is_enter:!us(),is_shortcut:!0,win_name:"main"})}),cs()}))};J.toggleWinMaximize=Zt;let at=!1,st=!1,nt=!1,Be=!1,Oe=!1;const _t=s=>{const{target:n,key:y,ctrlKey:k,shiftKey:a,altKey:e,metaKey:o}=s||{};if((n==null?void 0:n.getAttribute("contenteditable"))!=="true"&&!(["INPUT","TEXTAREA"].includes(n==null?void 0:n.tagName)&&(n==null?void 0:n.getAttribute("type"))!=="checkbox")&&!["BILI-COMMENTS","BILI-COMMENT-BOX","BILI-COMMENTS-REPLY-DETAIL","BILI-COMMENTS-REPLY-DIALOG","BILI-COMMENT-REPORT-FORM"].includes(n==null?void 0:n.tagName)&&!(k||e||o)){if(["ArrowLeft","ArrowRight"].includes(y)&&a){ua(y==="ArrowLeft",b.value);return}if(["ArrowUp","ArrowDown"].includes(y)){if(a){ca(y==="ArrowUp",b.value);return}return at||(at=!0,y==="ArrowUp"?tt("keyboard",2):Pe("keyboard",1)),s.stopPropagation(),s.preventDefault(),!1}if(!a){if(y==="Escape"){we(),A.emit("hideComment");return}if(/^[wec]$/i.test(y)&&W.value)return s.stopPropagation(),s.preventDefault(),!1;if(/^x$/i.test(y)){!W.value&&!st&&(st=!0,A.emit("toggleSelectedInfo"));return}if(/^c$/i.test(y)){!W.value&&!nt&&(nt=!0,A.emit("toggleComment"));return}if(/^v$/i.test(y)){!W.value&&!Be&&(Be=!0,St());return}if(/^s$/i.test(y)){if(document.fullscreenElement)return;if(!Oe){Oe=!0,$t();return}}}}},ht=s=>{if(["ArrowUp","ArrowDown"].includes(s.key)){at=!1;return}if(/^x$/i.test(s.key)){st=!1;return}if(/^c$/i.test(s.key)){nt=!1;return}if(/^v$/i.test(s.key)){Be=!1;return}if(/^s$/i.test(s.key)){Oe=!1;return}};ut("window/focusChange",()=>{at=st=nt=Be=Oe=!1});const Vt=()=>{var s;return(s=J.biliPlayer)==null?void 0:s.danmaku.isOpen()},it=()=>{var s;return(s=J.biliPlayer)==null?void 0:s.getMuted()},yt=()=>{var s;return(s=J.biliPlayer)==null?void 0:s.isPaused()},ea=({id:s})=>{var n,y,k,a,e;switch(["playRatePlass","playRateMinus","volumePlass","volumeMinus"].includes(s)||(oe.value=!1),s){case"toggleComment":A.emit("toggleRight"),q.flashPageCursors(200);break;case"toggleDetails":A.emit("toggleSelectedInfo");break;case"toDetails":A.emit("viewDetails");break;case"fullscreen":document.dispatchEvent(new KeyboardEvent("keydown",{key:"f",code:"KeyF",keyCode:70,bubbles:!0,cancelable:!0})),q.flashPageCursors(Pt?1e3:500);break;case"togglePlay":{yt()?(n=J.biliPlayer)==null||n.play():(y=J.biliPlayer)==null||y.pause();break}case"toggleDm":{const o=Vt();o?(k=J.biliPlayer)==null||k.danmaku.close():(a=J.biliPlayer)==null||a.danmaku.open(),Fa(o?"\u5F39\u5E55\u5DF2\u5173\u95ED":"\u5F39\u5E55\u5DF2\u6253\u5F00",b.value);break}case"playRatePlass":ua(!0);break;case"playRateMinus":ua(!1);break;case"toggleMute":{const o=it();(e=J.biliPlayer)==null||e.setMuted(!o),Fa(o?"\u5DF2\u53D6\u6D88\u9759\u97F3":"\u5DF2\u9759\u97F3",b.value);break}case"volumePlass":ca(!0);break;case"volumeMinus":ca(!1);break}};Wt.on("gpArrowUp",()=>{!V.value||tt("keyboard",2)}),Wt.on("gpArrowDown",()=>{!V.value||Pe("keyboard",1)}),Wt.on("gpToggleLike",()=>{!V.value||le.setLike(ye.value.id)}),Wt.on("gpBack",()=>{!V.value||W.value&&(document.fullscreenElement?document.dispatchEvent(new KeyboardEvent("keydown",{key:"f",code:"KeyF",keyCode:70,bubbles:!0,cancelable:!0})):pe())});let Ue=null;ut("window/fullScreenChange",({data:s})=>{clearInterval(Ue),Ue=setInterval(()=>{(s&&document.fullscreenElement||!s&&!document.fullscreenElement)&&(clearInterval(Ue),Re())})}),ut("window/visibleChange",({data:s})=>{Pt&&$a("window/isMinimized")||(G.value=s,!s&&W.value&&($a("config/getBossShortcutHide")||setTimeout(()=>pe(),200)))});const Ne={dialogFollowed:i,dialogCoinOperated:F,dialogCollection:U,dialogShare:P,dialogDynShare:C},We=Object.keys(Ne),He=()=>We.some(s=>{var n;return(n=Ne[s])==null?void 0:n.value.isShowDialog}),bt=s=>{var n;He()||(s==="dialogDynShare"?C.value.show({rid:ye.value.id,type:8}):(n=Ne[s])==null||n.value.showDialog())},we=()=>{We.forEach(s=>{var n,y;return(y=(n=Ne[s])==null?void 0:n.value)==null?void 0:y.closeDialog()})};A.on("showActionDialog",bt),A.on("closeActionDialog",we),R(ye,()=>we()),zt("hasActiveDialog",He);const St=()=>{He()?P.value.isShowDialog&&(P.value.copyShareLink(),P.value.closeDialog(),re({type:"click",spm_info:"main.play-detail.share.shortcut"},{msg:JSON.stringify({win_name:"main",is_open:!1})})):(bt("dialogShare"),re({type:"click",spm_info:"main.play-detail.share.shortcut"},{msg:JSON.stringify({win_name:"main",is_open:!0})}))},Bt=s=>{if(W.value)return s.preventDefault(),s.stopPropagation(),!1};let wt;return rt(()=>{Re(),wt=As(({width:s,height:n})=>{Tt.value=n>=290},!0),window.addEventListener("resize",Re),document.addEventListener("wheel",Rt,!0),document.addEventListener("keydown",_t,!0),document.addEventListener("keyup",ht,!0),document.addEventListener("contextmenu",Bt,!0),setTimeout(()=>de.value=b.value)}),Wa(()=>{W.value&&pe(),delete J.ugcSeasonPlayers,A.off("initVideoList",ft),A.off("miniSelectedPlayer",dt),A.off("unminiSelectedPlayer",pe),A.off("showActionDialog",bt),A.off("closeActionDialog",we),Rs(wt),clearTimeout(Ze),window.removeEventListener("resize",Re),document.removeEventListener("wheel",Rt,!0),document.removeEventListener("keydown",_t,!0),document.removeEventListener("keyup",ht,!0),document.removeEventListener("contextmenu",Bt,!0)}),(s,n)=>{const y=Me("v-button");return r(),f("div",{class:ae(["app_selected app_selected--us i_page_wrapper",{"app_selected--active":t(be),"app_selected--deactive":!t(be)}])},[u("div",{class:"app_selected--content i_page_content ov_hidden p_relative",onMouseenter:vt,onMousemove:Ft,onMouseleave:mt},[h(ps,{from:"UgcSeason"}),h(Ct,{name:"fade"},{default:ce(()=>[t(V)&&(!t(W)||t(be))?(r(),f("div",{key:0,class:ae(["app_selected--btns p_center_y flex_col",{r_md:t(be),btns_mini:t(W)}])},[h(y,{"active-shrink":"",class:"p_relative mb_sm",title:"\u5207\u6362\u89C6\u9891\uFF08\u9F20\u6807\u6EDA\u8F6E\u5411\u4E0A/\u952E\u76D8\u2191\uFF09",disabled:p.value===0,onClick:n[0]||(n[0]=k=>t(tt)("click",2)),onMouseenter:n[1]||(n[1]=k=>Ae.value=!0),onMouseleave:n[2]||(n[2]=k=>Ae.value=!1)},{default:ce(()=>[h(t(bs)),ci]),_:1},8,["disabled"]),h(y,{"active-shrink":"",class:"p_relative",title:"\u5207\u6362\u89C6\u9891\uFF08\u9F20\u6807\u6EDA\u8F6E\u5411\u4E0B/\u952E\u76D8\u2193\uFF09",disabled:c.value.length===0,onClick:n[3]||(n[3]=k=>t(Pe)("click",1)),onMouseenter:n[4]||(n[4]=k=>Ae.value=!0),onMouseleave:n[5]||(n[5]=k=>Ae.value=!1)},{default:ce(()=>[h(t(Ss)),u("span",{class:"gamepad-cursor","data-tp":"selectedBtn","data-offset":D.value*3/4},null,8,ri)]),_:1},8,["disabled"])],2)):Y("",!0)]),_:1}),u("div",{ref_key:"selderWrapperRef",ref:b,class:ae(["app_selected--wrapper ov_hidden bd_1 bc_line_light",{no_drag:!t(W)}])},[u("div",{class:ae(["app_selected--slider min_h_100",{is_transition:w.value}]),style:ga({marginTop:t(ie)+"px",transform:I.value?`translateY(${I.value}px)`:""})},[h(za,{loading:z.value&&!m.value.length||!T.value},null,8,["loading"]),!z.value&&!m.value.length?(r(),f("div",di,fi)):Y("",!0),u("div",{class:"app_selected--items-wrap",ref_key:"selectedItemWrapRef",ref:L},[(r(),f(Ye,null,ct([0,1,2],k=>h(ui,{key:k,index:k,info:m.value[t(se)[k]],playingList:m.value,isOnSliding:w.value,width:D.value,height:E.value,activeId:t(ye).cid,isWinVisiable:G.value,isSelectedPage:t(V),onPlayerEnded:n[6]||(n[6]=a=>t(Pe)("auto",1))},null,8,["index","info","playingList","isOnSliding","width","height","activeId","isWinVisiable","isSelectedPage"])),64))],512)],6)],2),h(gs,{ref_key:"dialogFollowedRef",ref:i,from:"UgcSeason"},null,512),h(_s,{ref_key:"dialogCoinOperatedRef",ref:F,from:"UgcSeason"},null,512),h(hs,{ref_key:"dialogCollectionRef",ref:U,from:"UgcSeason"},null,512),h(ys,{ref_key:"dialogShareRef",ref:P,from:"UgcSeason"},null,512),h(xs,{ref_key:"dialogDynShareRef",ref:C,from:"UgcSeason"},null,512),t(oe)&&t(V)&&!t(W)?(r(),f("div",{key:0,id:"gamepad-player-menu",onClick:n[8]||(n[8]=k=>oe.value=!1)},[u("div",{class:"gp-menu-wrapper",onClick:n[7]||(n[7]=pa(()=>{},["stop"]))},[u("ul",pi,[(r(),f(Ye,null,ct(je,k=>u("li",{class:"p_relative",key:k.id,onClick:a=>ea(k)},[k.id==="togglePlay"?(r(),f("span",_i,O(yt()?"\u64AD\u653E":"\u6682\u505C"),1)):k.id==="toggleDm"?(r(),f("span",hi,O(Vt()?"\u5173\u95ED\u5F39\u5E55":"\u6253\u5F00\u5F39\u5E55"),1)):k.id==="toggleMute"?(r(),f("span",yi,O(it()?"\u53D6\u6D88\u9759\u97F3":"\u9759\u97F3"),1)):k.id==="fullscreen"?(r(),f("span",bi,O(t(Ds)()?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F\u64AD\u653E"),1)):(r(),f("span",Si,O(k.text),1)),wi],8,gi)),64))])])])):Y("",!0)],32)],2)}}});export{Ni as default};

import{o as s,c as r,a as o,ax as le,M as ge,al as me,k as d,ao as we,x as oe,y as xe,fg as ke,aV as Ce,P as be,p as $e,Q as D,W as l,U as _,aj as g,V as M,a0 as c,X as U,Y as ae,$ as m,R as Me,T as He,Z as Pe,ae as Se,a2 as ce,S as H,as as re,t as I,cM as ne,g as Ae,a6 as De,a7 as Ie,ac as Ve,aD as Be,aa as ie,a9 as W,cb as Ee}from"./index.f074ecef.js";import{_ as Fe}from"./MoreFeedback.eac5fca1.js";import{I as Te,a as Ze}from"./more.9cbfb002.js";import{D as Le}from"./delete.517b0c72.js";import{d as Re,c as Ne,a as Ue,s as We}from"./mine.30873ffc.js";import{_ as Ye}from"./LoginPanel.33272c26.js";import{u as ze,_ as je,H as qe}from"./index.194c39d1.js";import{N as Ge}from"./Empty.c40df274.js";import{S as Ke}from"./SearchResultCount.6c930e27.js";import{_ as Qe}from"./plugin-vue_export-helper.21dcd24c.js";import"./style.2070e26d.js";import"./modulepreload-polyfill.b7f2da20.js";import"./ico_max_exit.f7f1ea61.js";import"./index.14a3ec94.js";import"./isUdf.1a76b9f4.js";import"./App.c1beb0e9.js";import"./btn_devtools.06ffa497.js";import"./index.733b73c2.js";import"./ico_pin.a6faa7a5.js";/* empty css               */import"./theme-map.a3b52bba.js";const Xe={class:"device-icon",fill:"#fff",width:"16",height:"16",viewBox:"0 0 16 16"},Je=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.497 3.5H5.503a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.994a1 1 0 0 0 1-1v-8a1 1 0 0 0-1-1Zm-4.994-1a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h4.994a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2H5.503Z"},null,-1),Oe=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7 12a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1A.5.5 0 0 1 7 12ZM6.404 3.5a1 1 0 0 0 1 1h1.192a1 1 0 0 0 1-1H6.404Z"},null,-1),et=[Je,Oe];function tt(f,w){return s(),r("svg",Xe,[...et])}var st={render:tt};const ot={class:"device-icon",fill:"#fff",width:"17",height:"16",viewBox:"0 0 17 16",xmlns:"http://www.w3.org/2000/svg"},at=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.5 13a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h5ZM14 2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h10Zm0 1H4a1 1 0 0 0-.993.883L3 4v6a1 1 0 0 0 .883.993L4 11h10a1 1 0 0 0 .993-.883L15 10V4a1 1 0 0 0-1-1Z"},null,-1),rt=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.95 11h2l1 3h-4l1-3Z"},null,-1),nt=[at,rt];function it(f,w){return s(),r("svg",ot,[...nt])}var lt={render:it};const ct={class:"device-icon",stroke:"#fff",fill:"none",width:"17",height:"16",viewBox:"0 0 17 16",xmlns:"http://www.w3.org/2000/svg"},ut=o("path",{d:"M3.3 12V4a1.5 1.5 0 0 1 1.5-1.5h6.796a1.5 1.5 0 0 1 1.5 1.5v8a1.5 1.5 0 0 1-1.5 1.5H4.8A1.5 1.5 0 0 1 3.3 12Z"},null,-1),dt=o("path",{d:"M8.7 11.5h-1","stroke-linecap":"round"},null,-1),ht=[ut,dt];function vt(f,w){return s(),r("svg",ct,[...ht])}var _t={render:vt};const ft={class:"device-icon",fill:"none",width:"17",height:"16",viewBox:"0 0 17 16",xmlns:"http://www.w3.org/2000/svg"},pt=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#fff",d:"M13.8 2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h10Zm0 1h-10a1 1 0 0 0-.993.883L2.8 4v6a1 1 0 0 0 .883.993L3.8 11h10a1 1 0 0 0 .993-.883L14.8 10V4a1 1 0 0 0-1-1Z"},null,-1),yt=o("path",{d:"M4.3 11.5 3.8 13M4.982 11.5 3.8 13M13.3 11.5l.5 1.5M12.664 11.5 13.8 13",stroke:"#fff","stroke-linecap":"round"},null,-1),gt=[pt,yt];function mt(f,w){return s(),r("svg",ft,[...gt])}var wt={render:mt};const xt={class:"device-icon",fill:"none",width:"16",height:"17",viewBox:"0 0 16 17",xmlns:"http://www.w3.org/2000/svg"},kt=le('<path d="M4.948 7.226a69.63 69.63 0 0 0 6.104 0c1.526-.067 2.835 1.136 2.835 2.627v2.02a.5.5 0 0 1-.5.5H2.613a.5.5 0 0 1-.5-.5v-2.02c0-1.491 1.31-2.694 2.835-2.627Z" stroke="#fff"></path><path d="M5.692 3.37h4.743A1.5 1.5 0 0 1 11.9 4.548L12.438 7c-.266.031-.62.07-1.032.11-.942.09-2.186.18-3.406.18-1.22 0-2.431-.09-3.34-.18a39.71 39.71 0 0 1-.972-.108l.539-2.454A1.5 1.5 0 0 1 5.692 3.37Z" stroke="#fff"></path><circle cx="4.722" cy="9.824" r=".766" fill="#fff"></circle><circle cx="11.278" cy="9.824" r=".766" fill="#fff"></circle><path d="M3.04 12.702h.818l-.26 1.073a.284.284 0 0 1-.559-.067v-1.006Z" fill="#fff" stroke="#fff"></path><path d="M12.918 12.702H12.1l.258 1.073a.284.284 0 0 0 .56-.067v-1.006Z" fill="#D8D8D8" stroke="#979797"></path>',6),Ct=[kt];function bt(f,w){return s(),r("svg",xt,[...Ct])}var $t={render:bt};const Mt={class:"device-icon",fill:"none",width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},Ht=le('<path d="M2.5 12V4A1.5 1.5 0 0 1 4 2.5h8A1.5 1.5 0 0 1 13.5 4v8a1.5 1.5 0 0 1-1.5 1.5H4A1.5 1.5 0 0 1 2.5 12Z" stroke="#fff"></path><path d="M4.5 8V5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5Z" stroke="#fff"></path><circle cx="4.397" cy="10.444" r=".45" fill="#fff"></circle><circle cx="6.198" cy="10.444" r=".45" fill="#fff"></circle><circle cx="5.204" cy="11.714" r=".45" fill="#fff"></circle><circle cx="8" cy="10.444" r=".45" fill="#fff"></circle><circle cx="7.006" cy="11.714" r=".45" fill="#fff"></circle><circle cx="9.802" cy="10.444" r=".45" fill="#fff"></circle><circle cx="11.603" cy="10.444" r=".45" fill="#fff"></circle><circle cx="8.807" cy="11.714" r=".45" fill="#fff"></circle><circle cx="10.609" cy="11.714" r=".45" fill="#fff"></circle>',11),Pt=[Ht];function St(f,w){return s(),r("svg",Mt,[...Pt])}var At={render:St};const Y=f=>(De("data-v-d0d1d4a4"),f=f(),Ie(),f),Dt={key:0,class:"flex_col_center w_100 h_100"},It={key:1,class:"container"},Vt={class:"i_wrapper p_relative"},Bt={class:"mine-right-btn-content"},Et=Y(()=>o("span",null,"\u6E05\u7A7A\u5386\u53F2\u8BB0\u5F55",-1)),Ft={key:0,class:"search-result-count"},Tt={key:3,class:"i_wrapper history-skeleton"},Zt={key:4,class:"h-content i_wrapper"},Lt=["textContent"],Rt=["onClick"],Nt=Y(()=>o("div",{class:"cover-img p_cover"},[o("img",{class:"p_center",src:Fe})],-1)),Ut={key:0,class:"badge offline",textContent:"\u5DF2\u770B\u5B8C"},Wt=["textContent"],Yt={class:"tapper"},zt=["textContent"],jt=["textContent"],qt=["textContent"],Gt={key:2,class:"progress"},Kt={class:"info"},Qt={class:"info-content"},Xt=["textContent","title","onClick"],Jt={key:0,class:"sub-title"},Ot={key:0,class:"sub-title-tag"},es=["onClick"],ts=["textContent"],ss={class:"info-option"},os={class:"drop-down-list"},as=["onClick"],rs=["data-card"],ns={class:"content-wrapper"},is=Y(()=>o("h4",{class:"b_text text1 text_center mt_md"},"\u786E\u8BA4\u5220\u9664\u6240\u6709\u5386\u53F2\u8BB0\u5F55\u5417\uFF1F",-1)),ls={class:"mt_xl text_center dialog_btns"},cs=ce("\u53D6\u6D88"),us=ce("\u5220\u9664"),ds=ge({__name:"MineHistory",setup(f,{expose:w}){ze({spm_id:H.mineHistory,isKeepAlive:!1,pageName:"MineHistory"});const x={1:"iPhone",2:"PC",3:"Android",33:"AndroidTV",4:"iPad",5:"WP8",6:"UWP",7:"H5",8:"AndroidCar",9:"AndroidThing",10:"AndroidPad",11:"IPTV"},z=Ve(),ue=me(),V=d({max:"",view_at:"0",business:"",ps:"20"}),k=d(!0),j=d(null),B=we(j),{userInfo:C}=oe(xe()),{isHistoryEmpty:y}=oe(ke()),h=d(!1),b=d(!1),E=d(!1),P=d(""),F=d(1),S=d(!0),T=d(!0),q=d(0),G=Ce(),K=()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),Math.round(e.getTime()/1e3)},de=e=>{const a=K();if(e>a)return"\u4ECA\u5929 "+re(e*1e3,3);if(e>a-86400)return"\u6628\u5929 "+re(e*1e3,3);{const n=new Date().getFullYear(),i=new Date(e*1e3),v=i.getFullYear(),N=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,u=i.getDate()<10?"0"+i.getDate():i.getDate();return`${v===n?"":v+"-"}${N}-${u}`}},Z=(()=>{const e=K();return[e,e-24*3600,e-7*24*3600]})(),p=d([{text:"\u4ECA\u5929",list:[],time:Z[0]},{text:"\u6628\u5929",list:[],time:Z[1]},{text:"\u8FD1\u4E00\u5468",list:[],time:Z[2]},{text:"\u4E00\u5468\u524D",list:[],time:-1/0}]);y.value=!0;const L=async()=>{if(!!C.value.isLogin&&!!k.value&&!h.value){h.value=!0,b.value=!1;try{const e=await Ue(V.value),{cursor:a,list:n}=e||{};V.value=a,n!=null&&n.length||(k.value=!1),X(n),G.flashPageCursors(200)}catch(e){console.error(e),h.value=!1,k.value=!1,b.value=!0}}},Q=async()=>{if(!!C.value.isLogin&&!!S.value&&!h.value){h.value=!0,b.value=!1;try{const e=await We({pn:F.value,keyword:P.value,business:"all"}),{has_more:a,list:n,page:i}=e||{};S.value=a,q.value=(i==null?void 0:i.total)||0,a&&(F.value=(i==null?void 0:i.pn)+1),X(n),G.flashPageCursors(200)}catch(e){console.error(e),h.value=!1,S.value=!1,b.value=!0}}},X=e=>{e==null||e.forEach(a=>{for(let n=0;n<p.value.length;n++)if(a.view_at>p.value[n].time){p.value[n].list.push(a);break}}),y.value=p.value.every(a=>!a.list.length),h.value=!1},J=()=>{L().then(()=>{B.value&&L()})};J(),be(B,()=>{if(B.value){if(!P.value){L();return}T.value||Q()}});const O=e=>{var n;const a={live:()=>{Be(e.history.oid)},pgc:()=>{ie({type:"ogv",epid:e.history.epid,fromSpmid:H.mineHistory+".pv"})},archive:()=>{ie({type:"ugc",bvid:e.history.bvid,p:e.history.page||1,fromSpmid:H.mineHistory+".pv"})},article:()=>{W(`https://www.bilibili.com/read/cv${e.history.oid}?spm_id_from=${H.mineHistory}.pv`,"mine.History")},"article-list":()=>{W(`https://www.bilibili.com/read/cv${e.history.cid}?spm_id_from=${H.mineHistory}.pv`,"mine.History")},cheese:()=>{if(e.uri){const i=Ee(e.uri);W(i,"mine.History")}}};(n=a[e.history.business])==null||n.call(a)},he=async(e,a)=>{var i;const n=(i=p.value.find(v=>v.text===e))==null?void 0:i.list.splice(a,1);n[0]&&Re({kid:n[0].history.business+"_"+n[0].kid}).then(()=>{I({content:"\u5220\u9664\u6210\u529F"}),p.value.every(v=>v.list.length===0)&&R()}).catch(v=>{console.error(v),I({content:v.message})})},$=d(!1),ve=()=>{Ne().then(()=>{I({content:"\u5220\u9664\u6210\u529F"})}).catch(e=>{console.error(e),I({content:e.message})}),$.value=!1,k.value=!1,y.value=!0,p.value.forEach(e=>e.list=[])},_e=e=>ne(e.progress>=0?e.progress:e.duration)+"/"+ne(e.duration),fe=e=>{ue.push({name:"Space",query:{mid:e}})},R=()=>{V.value={max:"",view_at:"0",business:"",ps:"20"},k.value=!0,y.value=!0,p.value.forEach(e=>e.list=[]),J()},pe=async e=>{if(E.value=!!e,!(!P.value&&!e)){if(P.value=e,Ae.emit("requestScrollToTop"),T.value=!0,!e){R();return}F.value=1,S.value=!0,y.value=!0,p.value.forEach(a=>a.list=[]),await Q(),T.value=!1}},ye=()=>{!C.value.isLogin||($.value=!0)};return $e(()=>{k.value=!0,h.value=!1}),w({doSearch:pe}),(e,a)=>{const n=D("v-button"),i=D("VImg"),v=D("v-dropdown"),N=D("v-dialog");return!l(C)||!l(C).isLogin?(s(),r("div",Dt,[_(Ye,{showAvatar:""})])):(s(),r("div",It,[o("div",Vt,[!l(y)&&!E.value&&l(C).isLogin?(s(),g(n,{key:0,class:"clear-history-option",onClick:ye},{default:M(()=>[o("div",Bt,[_(l(Le)),Et])]),_:1})):c("",!0)]),E.value?(s(),r("div",Ft,[_(Ke,{count:q.value,unit:"\u7ED3\u679C"},null,8,["count"])])):c("",!0),!b.value&&!h.value&&l(y)?(s(),g(Ge,{key:1})):b.value&&!h.value&&l(y)?(s(),g(qe,{key:2,class:"mt_lg",onRefresh:R})):h.value&&l(y)?(s(),r("div",Tt,[_(je,{itemNum:20})])):(s(),r("div",Zt,[(s(!0),r(U,null,ae(p.value,u=>(s(),r(U,null,[u.list.length?(s(),r("div",{class:"t-label",textContent:m(u.text),key:u.text},null,8,Lt)):c("",!0),u.list.length?(s(),r("div",{class:"p_relative row gutter_md",key:u.text+"list"},[(s(!0),r(U,null,ae(u.list,(t,ee)=>{var te,se;return s(),r("div",{class:"history-item col_3 col_sm_1_5",key:((te=t.history)==null?void 0:te.business)+t.kid},[o("div",{class:"cover",onClick:A=>O(t)},[Nt,Me(_(i,{class:"cover-img p_cover",src:t.cover||((se=t.covers)==null?void 0:se[0])||"",width:512*l(z),height:288*l(z),loading:"lazy",rule:"1c","bfs-style":"pc-common-cover-h",onError:A=>t.isError=!0},null,8,["src","width","height","onError"]),[[He,!t.isError]]),t.progress<0?(s(),r("div",Ut)):c("",!0),t.progress>=0&&t.badge?(s(),r("div",{key:1,class:Pe(["badge",{offline:t.history.business==="live"&&1>t.live_status}]),textContent:m(t.badge)},null,10,Wt)):c("",!0),o("div",Yt,[["iPhone","Android","WP8","H5"].includes(x[t.history.dt])?(s(),g(l(st),{key:0})):c("",!0),["PC","UWP"].includes(x[t.history.dt])?(s(),g(l(lt),{key:1})):c("",!0),["iPad","AndroidPad"].includes(x[t.history.dt])?(s(),g(l(_t),{key:2})):c("",!0),["AndroidTV","IPTV"].includes(x[t.history.dt])?(s(),g(l(wt),{key:3})):c("",!0),["AndroidCar"].includes(x[t.history.dt])?(s(),g(l($t),{key:4})):c("",!0),["AndroidThing"].includes(x[t.history.dt])?(s(),g(l(At),{key:5})):c("",!0),o("span",{class:"ct",textContent:m(de(t.view_at))},null,8,zt),["archive","pgc","cheese"].includes(t.history.business)&&t.duration>0&&t.progress>=0?(s(),r("span",{key:6,textContent:m(_e(t))},null,8,jt)):c("",!0),t.history.business==="live"?(s(),r("span",{key:7,textContent:m(t.tag_name)},null,8,qt)):c("",!0)]),["archive","pgc","cheese"].includes(t.history.business)&&t.duration>0?(s(),r("div",Gt,[o("div",{class:"progress-active",style:Se({width:`${Math.floor((t.progress>=0?t.progress:t.duration)/t.duration*100)}%`})},null,4)])):c("",!0)],8,Rt),o("div",Kt,[o("div",Qt,[o("div",{class:"info-title fw_500",textContent:m(t.title),title:t.title,onClick:A=>O(t)},null,8,Xt),["pgc","cheese"].includes(t.history.business)?(s(),r("div",Jt,[t.history.business==="cheese"?(s(),r("span",Ot,"\u8BFE\u5802")):c("",!0),o("span",null,m(t.show_title),1)])):c("",!0),["archive","live","article","article-list"].includes(t.history.business)?(s(),r("div",{key:1,class:"info-up",onClick:A=>fe(t.author_mid)},[_(l(Te)),o("span",{class:"up-name",textContent:m(t.author_name)},null,8,ts)],8,es)):c("",!0)]),_(v,{trigger:"click"},{content:M(()=>[o("div",os,[o("div",{class:"delete",onClick:A=>he(u.text,ee)},"\u5220\u9664\u8BB0\u5F55",8,as)])]),default:M(()=>[o("div",ss,[_(l(Ze))])]),_:2},1024)]),o("span",{class:"gamepad-cursor cursor-video-card","data-tp":"videoCard","data-scroll":"y","data-bf":"100","data-sh":"300","data-wp":".app_mine--content","data-card":ee===0},null,8,rs)])}),128))])):c("",!0)],64))),256))])),o("div",{ref_key:"bottomRef",ref:j,class:"bottom-load"},null,512),_(N,{visible:$.value,"onUpdate:visible":a[1]||(a[1]=u=>$.value=u),width:320,"class-name":"i_dialog py_lg",onCancel:a[2]||(a[2]=u=>$.value=!1),"is-show-default-footer":!1},{default:M(()=>[o("div",ns,[is,o("div",ls,[_(n,{class:"mr_sm",onClick:a[0]||(a[0]=u=>$.value=!1)},{default:M(()=>[cs]),_:1}),_(n,{type:"danger",onClick:ve},{default:M(()=>[us]),_:1})])])]),_:1},8,["visible"])]))}}});var Vs=Qe(ds,[["__scopeId","data-v-d0d1d4a4"]]);export{Vs as default};

import{u as ae,a as re}from"./index.es.256047cb.js";import{ab as D}from"./MoreFeedback.eac5fca1.js";import{_ as le}from"./OgvBangumiSkeleton.a1380a74.js";import{M as ne,al as ie,u as ue,F as ce,k as C,aV as de,A as m,P as _e,l as me,m as pe,Q as T,o as a,aj as R,V as $,a as n,W as r,c as l,X as p,Y as b,$ as P,U as x,Z as S,a0 as H,dM as B,dN as j,aa as fe,a6 as he,a7 as ve}from"./index.f074ecef.js";import{k as ge,u as be,N as xe}from"./App.c1beb0e9.js";import{u as ye,a as ke}from"./index.194c39d1.js";import{_ as we}from"./plugin-vue_export-helper.21dcd24c.js";import"./style.2070e26d.js";import"./btn_devtools.06ffa497.js";import"./index.733b73c2.js";import"./modulepreload-polyfill.b7f2da20.js";import"./ico_max_exit.f7f1ea61.js";import"./index.14a3ec94.js";import"./isUdf.1a76b9f4.js";import"./ico_pin.a6faa7a5.js";/* empty css               */import"./theme-map.a3b52bba.js";const Ce=f=>(he("data-v-5fb3891c"),f=f(),ve(),f),Te={class:"i_wrapper mb_44"},Re={class:"flex_between mb_9 fs_3 text1 fw_bold fw_400 h_34"},Pe={class:"text2 mr_xs"},Se=Ce(()=>n("span",{class:"gamepad-cursor","data-tp":"pgcCard"},null,-1)),Be={class:"row gutter_md"},Fe={key:0},Ie={class:"flex_between mb_9 fs_3 text1 fw_bold fw_400 h_34"},Me={class:"row gutter_md"},Ne={key:0,class:"flex_center text3 lh_md fs_5"},ze=ne({__name:"Tab",setup(f){const O=ie(),d=ue(),F=ce(),i=d.meta.isBangumi==null?!1:d.meta.isBangumi,U=d.meta.isPgc==null?!1:d.meta.isPgc,I=i?"main.home-page-fanju.0.0":"main.home-page-movie.0.0",_=C(!1),h=C(!1),y=C(null),k=de();ye({spm_id:I,pageName:"HomePgc"}),ge(i?".bangumi_tab":".pgc_tab"),ke(i?".bangumi_tab":".pgc_tab");const q=()=>k.flashPageCursors(),{data:u,run:G,loading:K}=ae(async()=>{h.value=!1;try{const e=await j({is_refresh:0},i);return{...e,modules:e.modules.filter(t=>t.items.length)}}catch{return h.value=!0,{modules:[],has_next:!1,next_cursor:"0"}}finally{k.flashPageCursors(100)}},{initialData:{modules:[],has_next:!0,next_cursor:"0"}}),M=m(()=>{var e;return(e=u.value.modules.find(t=>t.style===B.double_feed))!=null?e:{}}),Q=m(()=>M.value.title),X=m(()=>{var e;return u?{...u.value,modules:(e=u.value.modules)==null?void 0:e.filter(t=>t.style!==B.double_feed)}:[]}),Y=e=>{var t;return((t=e[0])==null?void 0:t.mode)==="horizontal"?e.slice(0,5):e.slice(0,7)},{data:Z,dataList:J,loadMore:ee,loadingMore:N,reload:Ae,reset:z}=re(async e=>{var v,g,s;const t=!(e!=null&&e.dataList.length),w=u.value.next_cursor;try{const o=await j({cursor:t?w:Number((v=e==null?void 0:e.data)==null?void 0:v.next_cursor),is_refresh:1},i);return{list:(s=((g=o.modules.find(te=>te.style===B.double_feed))!=null?g:{}).items)!=null?s:[],has_next:o.has_next,next_cursor:o.next_cursor}}catch{return{list:[],has_next:!1,next_cursor:"0"}}finally{k.flashPageCursors(100)}},{manual:!0,isNoMore:e=>e?_.value:!1});_e(Z,e=>{_.value=!e.has_next});const A=m(()=>{var e,t;return[...(e=M.value.items)!=null?e:[],...(t=J.value)!=null?t:[],...N.value?Array.from(new Array(10),()=>({skeleton:!0,mode:"horizontal"})):[]]}),L=m(()=>K.value||!u.value.modules.length&&!h.value),oe=e=>{O.push(e)},se=()=>{L.value||N.value||ee()},V=e=>{!e.seasonId||fe({type:"ogv",seasonId:e.seasonId,fromSpmid:`${I}.pv`})},W=i?"HomeBangumiTab":"HomePgcTab",E=()=>{G(),_.value=!1,z()};return be(W,()=>E()),me(()=>{var e;d.name===W&&!((e=u.value.modules)!=null&&e.length)&&E()}),pe(()=>{_.value=!1,z()}),(e,t)=>{const w=T("WidgetArrow"),v=T("v-button"),g=T("Scroller");return a(),R(g,{ref_key:"bangumiRef",ref:y,class:S(["home_pgc page_scroller pt_lg h_100 p_relative u_select_none",{bangumi_tab:r(i),pgc_tab:r(U)}]),onLoadMore:se,onScroll:q},{default:$(()=>[n("div",Te,[r(L)?(a(),R(le,{key:0,showLoadingAnimation:""})):h.value?(a(),R(xe,{key:1})):(a(),l(p,{key:2},[(a(!0),l(p,null,b(r(X).modules,s=>(a(),l("div",{class:"mb_sm",key:s.module_id},[n("div",Re,[n("span",null,P(s.title),1),(a(!0),l(p,null,b(s.headers,o=>(a(),l("div",{key:o.title+o.url,class:"flex_start"},[x(v,{class:"i_button_more p_relative","active-shrink":"",onClick:c=>oe(o.url)},{default:$(()=>[n("span",Pe,P(o.title),1),x(w,{class:"i_icon_more text2"}),Se]),_:2},1032,["onClick"])]))),128))]),n("div",Be,[(a(!0),l(p,null,b(Y(s.items),(o,c)=>(a(),l("div",{key:o.epid,class:S(["mb_xxl",{col_3:o.mode==="horizontal",col_sm_1_5:o.mode==="horizontal",col_2:o.mode==="vertical",col_sm_1_7:o.mode==="vertical",to_hide_sm:o.mode==="horizontal"?c>3:c>5,to_hide_xl:o.mode==="horizontal"?c>4:c>6}])},[x(r(D),{onClickBangumi:V,info:o,mode:o.mode,appTheme:r(F).appTheme,rootRef:y.value,"disable-inline-player":"","disable-hover":"","scroll-wrap":".home_pgc",cursorType:"pgcCard",isKeepCursor:!0,isFristCard:c===0},null,8,["info","mode","appTheme","rootRef","isFristCard"])],2))),128))])]))),128)),r(A).length?(a(),l("div",Fe,[n("div",Ie,[n("span",null,P(r(Q)),1)]),n("div",Me,[(a(!0),l(p,null,b(r(A),(s,o)=>(a(),l("div",{key:s.cover,class:S(["mb_xxl",{col_3:s.mode==="horizontal",col_sm_1_5:s.mode==="horizontal",col_2:s.mode==="vertical",col_sm_1_7:s.mode==="vertical"}])},[x(r(D),{onClickBangumi:V,info:s,mode:s.mode,skeleton:s.skeleton,appTheme:r(F).appTheme,rootRef:y.value,"disable-inline-player":"","disable-hover":"",cursorType:"pgcCard",showLoadingAnimation:"","scroll-wrap":".home_pgc",isFristCard:o===0},null,8,["info","mode","skeleton","appTheme","rootRef","isFristCard"])],2))),128))]),_.value?(a(),l("div",Ne,"\u5DF2\u7ECF\u5230\u5E95\u5566~")):H("",!0)])):H("",!0)],64))])]),_:1},8,["class"])}}});var Je=we(ze,[["__scopeId","data-v-5fb3891c"]]);export{Je as default};

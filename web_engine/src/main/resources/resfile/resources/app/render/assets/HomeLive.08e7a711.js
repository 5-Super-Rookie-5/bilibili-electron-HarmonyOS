import{u as De,a as We,_ as xe,U as Ee,I as $e,b as He}from"./index.194c39d1.js";import{k as Be,u as Pe,m as Me,N as Fe}from"./App.c1beb0e9.js";import{s as Q,cf as Ve,h as ue,r as J,dI as ze,dJ as Oe,M as je,u as Ke,k as l,x as Qe,aK as Je,A as be,aV as Xe,P as F,aY as Ye,aN as qe,l as Ge,m as Ze,Q as V,o as r,aj as R,V as z,a as o,W as N,c,$ as O,a0 as m,X as I,Y as j,U as w,Z as K,a2 as T,be as ea,aD as aa,dK as re,aQ as ne,bv as ie,bV as ce}from"./index.f074ecef.js";import{a5 as ke,o as sa,e as ta}from"./MoreFeedback.eac5fca1.js";import"./modulepreload-polyfill.b7f2da20.js";import"./ico_max_exit.f7f1ea61.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.14a3ec94.js";import"./style.2070e26d.js";import"./isUdf.1a76b9f4.js";import"./btn_devtools.06ffa497.js";import"./ico_pin.a6faa7a5.js";/* empty css               */import"./theme-map.a3b52bba.js";import"./index.733b73c2.js";const Se=f=>{const p=`${Q.liveApi}/xlive/app-interface/v2/index/feedV2?${f}`;return new ze().disable(Oe.TICKET_WBI).request({url:p}).then(J)},la=()=>{const f=`${Q.liveApi}/xlive/open-interface/v1/fetch_client_resource?business=web_live:`;return ue.get(f,{isWbi:!0}).then(J)},oa=f=>{const p=`${Q.liveApi}/xlive/app-interface/v2/index/getAreaList?${Ve(f)}`;return ue.get(p,{isWbi:!0}).then(J)},ra=f=>{const p=`${Q.liveApi}/xlive/app-interface/v2/second/getList?${f}`;return ue.get(p,{isWbi:!0}).then(J)};const na={class:"i_wrapper scroll-content"},ia={key:0,class:"home_live--users"},ca={class:"b_text text1 flex_start"},ua=T(" \u6211\u5173\u6CE8\u7684\u4E3B\u64AD "),va={key:0,class:"b_text text3 ml_sm"},_a={class:"brand_pink"},da=T("\u4EBA\u6B63\u5728\u76F4\u64AD "),ma={class:"home_live--users-area p_relative"},fa={class:"users-wrap flex_start flex_inline flex_nowrap items_stretch"},pa=["onClick"],ha={class:"users-name-wrap flex_start"},ga={class:"users-name b_text text2 fs_6 mt_xs text_center text_ellipsis_2l"},wa=o("span",{class:"gamepad-cursor","data-tp":"liveUps","data-scroll":"x","data-bf":"100","data-sh":"300","data-wp":".home_live--users-wrap"},null,-1),ya={class:"users-more more-left"},La=o("span",{class:"gamepad-cursor","data-tp":"liveUps"},null,-1),xa={class:"users-more more-right"},ba=o("span",{class:"gamepad-cursor","data-tp":"liveUps"},null,-1),ka={key:0,class:"home_live--rooms-tabs mb_xl"},Sa={class:"rooms-tabs-parent"},Ra=o("span",{class:"gamepad-cursor","data-tp":"liveParent","data-scroll":"y","data-bf":"200","data-sh":"300","data-wp":".home_live"},null,-1),Ia={class:"rooms-tabs-second flex_between items_start"},Ca=["onClick"],Aa=o("span",{class:"gamepad-cursor","data-tp":"liveSecond"},null,-1),Na={key:0},Ta=T(" \u5C55\u5F00\u66F4\u591A "),Ua=o("span",{class:"gamepad-cursor","data-tp":"liveSecond"},null,-1),Da={key:1,class:"home_live--rooms-cards mt_sm"},Wa={class:"row"},Ya=je({__name:"HomeLive",setup(f){const p=Ke(),v=l([]),X=l(0),i=l([]),y=l(1),ve=l(20),C=l(!0),Y=l(!1),_=l(!1),L=l(!1),q=l(!1),_e=l(Math.random()),U=l(),de=l(),G=l(!1),{isShowLiveNow:me}=Qe(Je()),x=l({}),g=l({}),b=l([]),Z=be(()=>x.value.area_list||[]),D=l(null),W=l(null),ee=l(null),A=l(!1),E=l(!1),ae=l(!1),fe=l(!1),se=l(0),Re=be(()=>_.value&&!v.value.length&&!b.value.length&&!i.value.length);let pe,te=null,le=null,he=Date.now();De({spm_id:"main.home-page-live.0.0",pageName:"HomeLive"}),Be(".home_live"),We(".home_live");const oe=Xe(),ge=()=>oe.flashPageCursors();F(E,()=>oe.flashPageCursors(350)),F([v,i,b,Z],()=>oe.flashPageCursors(50),{deep:!0});const $=()=>{y.value=1,C.value=!0,i.value=[]},H=async()=>{var e,a;if(!Y.value){Y.value=!0;try{const{list:t}=await oa({platform:"web"});b.value=t,t[0].id===0&&((e=t[0].area_list)==null||e.unshift({id:0,name:"\u5168\u90E8"})),t.every(u=>u.id!==x.value.id)&&(x.value=t[0],g.value=((a=t[0])==null?void 0:a.area_list[0])||{},k()),setTimeout(()=>P())}catch(t){console.error(t)}finally{Y.value=!1}}};H();const k=ea(()=>{_.value||(L.value=!1,_.value=!0,x.value.id||g.value.id?Ie():Ce())},500),Ie=async()=>{try{const e=await re({parent_area_id:g.value.parent_id||0,area_id:g.value.id||0,page:y.value,page_size:ve.value,platform:"web",device:ne?"mac":ie?"win":ce?"linux":""}),{list:a=[]}=await ra(e),t=a.map(u=>ke(u,!0));i.value=i.value.concat(t),C.value=a.length>=ve.value,a.length&&y.value++}catch(e){console.error(e),L.value=!0}finally{_.value=!1}},Ce=async()=>{try{const e=await re({parent_area_id:0,area_id:0,device:ne?"mac":ie?"win":ce?"linux":"",page:y.value,platform:"web",scale:"xxhdpi",source_name:"pc",mobi_app:"pc_electron"}),{card_list:a=[],has_more:t}=await Se(e),d=a.filter(s=>["small_card_v1","second_card_v1"].includes(s.card_type)).map(s=>{var h;const n=s.card_data.small_card_v1||s.card_data.second_card_v1||{};return n.roomid||(n.roomid=n.id||""),n.uname||(n.uname=((h=n.cover_left_style)==null?void 0:h.text)||""),ke(n,!0)}),S=d.filter(s=>i.value.every(n=>n.roomId!==s.roomId));C.value=!!t&&S.length>0,i.value=i.value.concat(S),d.length&&y.value++}catch(e){console.error(e),L.value=!0}finally{_.value=!1}},B=async(e=!1)=>{var a,t;if(!q.value){q.value=!0;try{const u=await re({parent_area_id:0,area_id:0,device:ne?"mac":ie?"win":ce?"linux":"",page:1,platform:"web",scale:"xxhdpi",source_name:"pc_my_idol_v1",mobi_app:"pc_electron"}),{card_list:d=[],is_need_refresh:S,trigger_time:s}=await Se(u);fe.value=!!S,se.value=s||0,Ae();const n=(d||[]).find(h=>h.card_type==="my_idol_v1");if(n){const h=((t=(a=n.card_data)==null?void 0:a.my_idol_v1)==null?void 0:t.list)||[];h.forEach(M=>{M.face_nft=M.is_nft,M.upic=M.face}),v.value=h,X.value=h.length}e&&(_e.value=Math.random())}catch(u){console.error(u)}finally{q.value=!1}}},Ae=()=>{if(clearInterval(te),fe.value&&se.value&&ae.value){const e=Math.max(se.value*1e3,2e4);te=setInterval(()=>B(),e)}},we=async()=>{var e,a;try{const{kv_list:t}=await la();me.value=!!+((a=JSON.parse(((e=t==null?void 0:t[0])==null?void 0:e.value)||"{}"))==null?void 0:a.is_show)}catch(t){console.error(t),me.value=!1}},Ne=()=>{!L.value&&C.value&&k()},Te=e=>{A.value=!1,x.value=e,g.value=e.area_list[0]||{},$(),k(),setTimeout(()=>P())},Ue=e=>{g.value=e,$(),k()},ye=e=>{const a=U.value,t=a.offsetWidth,u=a.scrollLeft;if(e==="L"){const d=u-t/2;a.scrollLeft=d>=0?d:0}else a.scrollLeft=u+t/2},Le=()=>{const e=U.value;e?G.value=e.scrollWidth>e.offsetWidth:G.value=!1},P=()=>{var e,a;E.value=((e=D.value)==null?void 0:e.offsetHeight)>((a=W.value)==null?void 0:a.offsetHeight)+5};return Ye(()=>{ee.value&&(ee.value.style.height=A.value?D.value.offsetHeight+"px":W.value.offsetHeight+"px")}),F([D,W,Z],()=>{setTimeout(()=>P(),200)}),F([U,v],()=>{setTimeout(()=>Le(),200)}),qe("events/followUsersChange",()=>{p.name==="HomeLive"&&B()}),Pe("HomeLive",()=>{H(),$(),k(),B(!0)}),Ge(()=>{p.name==="HomeLive"&&(ae.value=!0,(!i.value.length||Date.now()-he>12e4)&&(H(),$(),k()),b.value.length||H(),B(),we(),clearInterval(le),le=setInterval(()=>we(),2e4),pe=sa(()=>{P(),Le()},!0))}),Ze(()=>{y.value=1,C.value=!0,ae.value=!1,v.value=v.value.slice(0,20),i.value=i.value.slice(0,20),he=Date.now(),clearInterval(te),clearInterval(le),ta(pe)}),(e,a)=>{const t=V("v-button"),u=V("WidgetArrow"),d=V("bili-live-card"),S=V("Scroller");return r(),R(S,{ref_key:"scrollRef",ref:de,class:"home_live page_scroller pt_lg w_100 u_select_none",onLoadMore:Ne,onScroll:ge},{default:z(()=>[o("div",na,[N(Re)?(r(),R(xe,{key:0})):(r(),c(I,{key:1},[v.value.length?(r(),c("div",ia,[o("h3",ca,[ua,X.value?(r(),c("span",va,[o("span",_a,O(X.value),1),da])):m("",!0)]),o("div",ma,[(r(),c("div",{class:"home_live--users-wrap ov_scroll_x",ref_key:"liveUserScrollerRef",ref:U,key:_e.value,onScroll:ge},[o("div",fa,[(r(!0),c(I,null,j(v.value,s=>(r(),c("div",{class:"users-item flex_col flex_inline mr_sm cs_pointer p_relative",key:s.uid,onClick:n=>N(aa)(s.roomid)},[w(Ee,{class:"users-avatar online_border_pink",info:s,isSmall:"",isShowLive:"",isOnLine:""},null,8,["info"]),o("div",ha,[o("p",ga,O(s.uname),1)]),wa],8,pa))),128))])],32)),G.value?(r(),c(I,{key:0},[o("div",ya,[w(t,{class:"more-btn p_relative",type:"grey","active-shrink":"",onClick:a[0]||(a[0]=s=>ye("L"))},{default:z(()=>[w(N($e)),La]),_:1})]),o("div",xa,[w(t,{class:"more-btn p_relative",type:"grey","active-shrink":"",onClick:a[1]||(a[1]=s=>ye("R"))},{default:z(()=>[w(N(He)),ba]),_:1})])],64)):m("",!0)])])):m("",!0),o("div",{class:K(["home_live--rooms",{mt_lg:v.value.length}])},[b.value.length?(r(),c("div",ka,[o("div",Sa,[(r(!0),c(I,null,j(b.value,s=>(r(),R(t,{class:"mr_sm mb_sm p_relative",type:"tab","active-pink":"",key:s.id,active:s.id===x.value.id,onClick:n=>Te(s)},{default:z(()=>[T(O(s.name)+" ",1),Ra]),_:2},1032,["active","onClick"]))),128))]),o("div",Ia,[o("div",{class:"tabs-second-content ml_1 ov_hidden ts_all_fast",ref_key:"areasContentRef",ref:ee},[o("div",{class:"tabs-second-wrap flex_start flex_wrap",ref_key:"areasWrapRef",ref:D},[o("div",{class:"second-item py_xs mb_xs w_0",ref_key:"areasItemRef",ref:W},"\xA0",512),(r(!0),c(I,null,j(N(Z),s=>(r(),c("div",{class:K(["second-item py_xs mb_xs text2 fs_5 hover_pink ts_all_fast cs_pointer mr_xl p_relative",{brand_pink:s.id===g.value.id}]),key:s.id,onClick:n=>Ue(s)},[T(O(s.name)+" ",1),Aa],10,Ca))),128))],512)],512),o("div",{class:K(["tabs-second-more py_xs flex_shrink_0 text3 text_right cs_pointer p_relative",{invisible:!E.value}]),onClick:a[2]||(a[2]=s=>A.value=!A.value)},[E.value?(r(),c("span",Na,[Ta,w(u,{class:K(["i_icon_more ts_all_fast rotate_90",{rotate_n90:A.value}])},null,8,["class"]),Ua])):m("",!0)],2)])])):m("",!0),_.value||i.value.length?(r(),c("div",Da,[o("div",Wa,[(r(!0),c(I,null,j(i.value,(s,n)=>(r(),c("div",{key:s.roomId,class:"col_3 col_sm_1_5 mb_xxl"},[w(d,{info:s,"disable-scale":!0,concise:"","scroll-wrap":".home_live",rootRef:de.value,isFirstCard:n===0},null,8,["info","rootRef","isFirstCard"])]))),128)),_.value?(r(),R(xe,{key:0,"with-wrapper":!1,"item-num":20})):m("",!0)])])):m("",!0),!_.value&&!i.value.length&&!L.value?(r(),R(Me,{key:2})):m("",!0),!_.value&&!i.value.length&&L.value?(r(),R(Fe,{key:3})):m("",!0)],2)],64))])]),_:1},512)}}});export{Ya as default};

import{M as Qe,aB as Fe,ab as _e,k as c,aY as qe,A as le,z as Z,P as ce,c6 as We,W as ke}from"./index.f074ecef.js";const De={},he=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),Ie=()=>De;Qe({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:n}){const{config:t}=e;return Fe(he,t),()=>{var r;return(r=n.default)===null||r===void 0?void 0:r.call(n)}}});const Me=Object.prototype.toString,Re=e=>Me.call(e),xe=e=>Re(e)==="[object String]",Be=e=>Re(e)==="[object Object]",ye=e=>e!==null&&typeof e=="object",Ue=e=>ye(e)&&$(e.then)&&$(e.catch),$=e=>e instanceof Function,ie=e=>e==null,Ee=typeof window=="undefined",me=()=>{var e,n;return!Ee&&((e=window)===null||e===void 0||(n=e.document)===null||n===void 0?void 0:n.visibilityState)==="visible"},be=()=>{var e,n,t;return(e=!Ee&&((n=window)===null||n===void 0||(t=n.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Ge=e=>{const n={};return Object.keys(e).forEach(t=>{n[t]=ke(e[t])}),n},ee=Promise.resolve(null),Le=async(...e)=>{const n=await fetch(...e);if(n.ok)return n.json();throw new Error(n.statusText)},Ve=(e,n,t=void 0)=>{const r=n.replace(/\[(\d+)\]/g,".$1").split(".");let u=e;for(const y of r)if(u=Object(u)[y],u===void 0)return t;return u};function Se(e,n){const t=Object.assign({},e);for(const r of n)delete t[r];return t}const ge=(e,n=!1)=>{const t=`Warning: [vue-request] ${e}`;if(n)return new Error(t);console.error(t)},Ye=(e,n)=>{let t=!1;return(...r)=>{t||(t=!0,e(...r),setTimeout(()=>{t=!1},n))}};var de;const Ce=new Set,je=new Set,Pe=new Set,oe=(e,n)=>{let t;switch(e){case"FOCUS_LISTENER":t=Ce;break;case"RECONNECT_LISTENER":t=Pe;break;case"VISIBLE_LISTENER":t=je;break}if(!t.has(n))return t.add(n),()=>{t.delete(n)}},fe=e=>{e.forEach(n=>{n()})};!Ee&&(de=window)!==null&&de!==void 0&&de.addEventListener&&(window.addEventListener("visibilitychange",()=>{me()&&fe(je)},!1),window.addEventListener("focus",()=>fe(Ce),!1),window.addEventListener("online",()=>fe(Pe),!1));function Ae(e,n,t){let r,u,y,g,v,d,h=0,I=!1,R=!1,T=!0;const j=!n&&n!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");n=+n||0,ye(t)&&(I=!!t.leading,R="maxWait"in t,y=R?Math.max(+t.maxWait||0,n):y,T="trailing"in t?!!t.trailing:T);function b(s){const l=r,p=u;return r=u=void 0,h=s,g=e.apply(p,l),g}function O(s,l){return j?(window.cancelAnimationFrame(v),window.requestAnimationFrame(s)):setTimeout(s,l)}function L(s){if(j)return window.cancelAnimationFrame(s);clearTimeout(s)}function E(s){return h=s,v=O(P,n),I?b(s):g}function q(s){const l=s-d,p=s-h,a=n-l;return R?Math.min(a,y-p):a}function M(s){const l=s-d,p=s-h;return d===void 0||l>=n||l<0||R&&p>=y}function P(){const s=Date.now();if(M(s))return A(s);v=O(P,q(s))}function A(s){return v=void 0,T&&r?b(s):(r=u=void 0,g)}function K(){v!==void 0&&L(v),h=0,r=d=u=v=void 0}function W(){return v===void 0?g:A(Date.now())}function D(){return v!==void 0}function S(...s){const l=Date.now(),p=M(l);if(r=s,u=this,d=l,p){if(v===void 0)return E(d);if(R)return v=O(P,n),b(d)}return v===void 0&&(v=O(P,n)),g}return S.cancel=K,S.flush=W,S.pending=D,S}function He(e,n,t){let r=!0,u=!0;if(typeof e!="function")throw new TypeError("Expected a function");return ye(t)&&(r="leading"in t?!!t.leading:r,u="trailing"in t?!!t.trailing:u),Ae(e,n,{leading:r,trailing:u,maxWait:n})}const $e=(e,n)=>t=>{Object.keys(t).forEach(r=>{e[r].value=t[r]}),n.forEach(r=>r(e))},ae=(e,n,t)=>{var r,u,y;const{initialAutoRunFlag:g,initialData:v,loadingDelay:d,pollingInterval:h,debounceInterval:I,debounceOptions:R,throttleInterval:T,throttleOptions:j,pollingWhenHidden:b,pollingWhenOffline:O,errorRetryCount:L,errorRetryInterval:E,stopPollingWhenHiddenOrOffline:q,refreshOnWindowFocus:M,refocusTimespan:P,updateCache:A,formatResult:K,onSuccess:W,onError:D,onBefore:S,onAfter:s}=n,l=c(0),p=c((r=t==null?void 0:t.loading)!==null&&r!==void 0?r:!1),a=c((u=t==null?void 0:t.data)!==null&&u!==void 0?u:v),f=c(t==null?void 0:t.error),C=c((y=t==null?void 0:t.params)!==null&&y!==void 0?y:[]),N=$e({loading:p,data:a,error:f,params:C},[i=>A(i)]),G=()=>{l.value=0},x=c(0),V=c(),z=c(),Y=c(),ne=()=>{V.value&&V.value(),Y.value&&Y.value(),z.value&&z.value()},J=()=>{let i;return d&&(i=setTimeout(N,d,{loading:!0})),()=>i&&clearTimeout(i)},te=i=>{if(f.value&&L!==0)return;let w;if(!ie(h)&&h>=0)if((b||me())&&(O||be()))w=setTimeout(i,h);else{q.value=!0;return}return()=>w&&clearTimeout(w)},o=le(()=>{if(E)return E;const i=1e3,w=1,F=9,U=Math.floor(Math.random()*2**Math.min(l.value,F)+w);return i*U}),_=i=>{let w;const F=L===-1,U=l.value<L;return f.value&&(F||U)&&(F||(l.value+=1),w=setTimeout(i,o.value)),()=>w&&clearTimeout(w)},m=(...i)=>{N({loading:!d,params:i}),Y.value=J(),x.value+=1;const w=x.value;return S==null||S(i),e(...i).then(F=>{if(w===x.value){const U=K?K(F):F;return N({data:U,loading:!1,error:void 0}),W&&W(U,i),G(),U}return ee}).catch(F=>(w===x.value&&(N({data:void 0,loading:!1,error:F}),D&&D(F,i),console.error(F)),ee)).finally(()=>{w===x.value&&(Y.value(),z.value=_(()=>m(...i)),V.value=te(()=>m(...i)),s==null||s(i))})},k=!ie(I)&&Ae(m,I,R),Q=!ie(T)&&He(m,T,j),B=(...i)=>(ne(),!g.value&&k?(k(...i),ee):Q?(Q(...i),ee):(G(),m(...i))),X=()=>{x.value+=1,N({loading:!1}),k&&k.cancel(),Q&&Q.cancel(),ne()},ue=()=>B(...C.value),Ne=i=>{const w=$(i)?i(a.value):i;N({data:w})},Te=[],re=i=>{i&&Te.push(i)},Oe=()=>{q.value&&(b||me())&&(O||be())&&(ue(),q.value=!1)};b||re(oe("VISIBLE_LISTENER",Oe)),O||re(oe("RECONNECT_LISTENER",Oe));const we=Ye(ue,P);return M&&(re(oe("VISIBLE_LISTENER",we)),re(oe("FOCUS_LISTENER",we))),{loading:p,data:a,error:f,params:C,run:B,cancel:X,refresh:ue,mutate:Ne,unmount:()=>{Te.forEach(i=>i())}}},se=new Map,ve=e=>{if(ie(e))return;const n=se.get(e);if(!!n)return{data:n.data,cacheTime:n.cacheTime}},ze=(e,n,t)=>{const r=se.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const u=setTimeout(()=>se.delete(e),t);se.set(e,{data:n,timer:u,cacheTime:new Date().getTime()})},H="__QUERY_DEFAULT_KEY__";function Ke(e,n){const t=_e(he,{}),{cacheKey:r,defaultParams:u=[],manual:y=!1,ready:g=c(!0),refreshDeps:v=[],loadingDelay:d=0,pollingWhenHidden:h=!1,pollingWhenOffline:I=!1,refreshOnWindowFocus:R=!1,refocusTimespan:T=5e3,cacheTime:j=6e5,staleTime:b=0,errorRetryCount:O=0,errorRetryInterval:L=0,queryKey:E,...q}={...Ie(),...t,...n},M=c(!1),P=c(!1),K={initialAutoRunFlag:P,loadingDelay:d,pollingWhenHidden:h,pollingWhenOffline:I,stopPollingWhenHiddenOrOffline:M,cacheKey:r,errorRetryCount:O,errorRetryInterval:L,refreshOnWindowFocus:R,refocusTimespan:T,updateCache:o=>{var _,m;if(!r)return;const k=(_=ve(r))===null||_===void 0?void 0:_.data,Q=k==null?void 0:k.queries,B=Ge(o),X=(m=E==null?void 0:E(...o.params.value))!==null&&m!==void 0?m:H;ze(r,{queries:{...Q,[X]:{...Q==null?void 0:Q[X],...B}},latestQueriesKey:X},j)},...Se(q,["pagination","listKey"])},W=c(!1),D=c(),S=c(),s=c(),l=Z({[H]:Z(ae(e,K))}),p=c(H),a=le(()=>{var o;return(o=l[p.value])!==null&&o!==void 0?o:{}});if(ce(a,o=>{W.value=o.loading,D.value=o.data,S.value=o.error,s.value=o.params},{immediate:!0,deep:!0}),r){var f;const o=ve(r);o!=null&&(f=o.data)!==null&&f!==void 0&&f.queries&&(Object.keys(o.data.queries).forEach(_=>{const m=o.data.queries[_];l[_]=Z(ae(e,K,{loading:m.loading,params:m.params,data:m.data,error:m.error}))}),o.data.latestQueriesKey&&(p.value=o.data.latestQueriesKey))}const C=c(),N=c(!1),G=(...o)=>{var _;if(!g.value&&!N.value)return C.value=o,ee;const m=(_=E==null?void 0:E(...o))!==null&&_!==void 0?_:H;return l[m]||(l[m]=Z(ae(e,K))),p.value=m,a.value.run(...o)},x=()=>{V(),p.value=H,l[H]=Z(ae(e,K))},V=()=>{Object.keys(l).forEach(o=>{l[o].cancel(),l[o].unmount(),delete l[o]})},z=()=>a.value.cancel(),Y=()=>a.value.refresh(),ne=o=>a.value.mutate(o);if(!y){var J;P.value=!0;const o=ve(r),_=(J=o==null?void 0:o.data.queries)!==null&&J!==void 0?J:{},m=o&&(b===-1||o.cacheTime+b>new Date().getTime()),k=Object.keys(_).length>0;m||(k?Object.keys(l).forEach(Q=>{var B;(B=l[Q])===null||B===void 0||B.refresh()}):G(...u)),P.value=!1}const te=c();return te.value=ce(g,o=>{N.value=!0,o&&C.value&&(G(...C.value),te.value())},{flush:"sync"}),v.length&&ce(v,()=>{!y&&a.value.refresh()}),We(()=>{V()}),{loading:W,data:D,error:S,params:s,cancel:z,refresh:Y,mutate:ne,run:G,reset:x,queries:l}}const pe=e=>(...n)=>{if($(e))return pe(e(...n))();if(Ue(e))return e;if(Be(e)){const{url:t,...r}=e;return Le(t,r)}else{if(xe(e))return Le(e);throw ge("Unknown service type",!0)}};function Ze(e,n){var t;$(e)||ge("useLoadMore only support function service");const r=pe(e),u=_e(he,{}),{queryKey:y,isNoMore:g,listKey:v="list",...d}=Object.assign({listKey:(t=u.listKey)!==null&&t!==void 0?t:Ie().listKey},n!=null?n:{});y&&ge("useLoadMore does not support concurrent request");const h=c(!1),I=c(!1),R=c(!1),T=0,j=c(T),{data:b,params:O,queries:L,run:E,reset:q,cancel:M,...P}=Ke(r,{...d,onSuccess:(...a)=>{var f;I.value=!1,j.value++,d==null||(f=d.onSuccess)===null||f===void 0||f.call(d,...a)},onError:(...a)=>{var f;I.value=!1,d==null||(f=d.onError)===null||f===void 0||f.call(d,...a)},queryKey:()=>String(j.value)}),A=c(b.value);qe(()=>{b.value!==void 0&&(A.value=b.value)});const K=le(()=>g&&$(g)?g(A.value):!1),W=le(()=>{let a=[];return Object.values(L).forEach(f=>{const C=Ve(f.data,v);C&&Array.isArray(C)&&(a=a.concat(C))}),a}),D=()=>{if(K.value)return;I.value=!0;const[,...a]=O.value,f=[{dataList:W.value,data:A.value},...a];E(...f)},S=()=>{Object.keys(L).forEach(a=>{a!==T.toString()&&(L[a].cancel(),L[a].unmount(),delete L[a])})};return{data:A,dataList:W,params:O,noMore:K,loadingMore:I,refreshing:h,reloading:R,run:E,reload:async()=>{R.value=!0,q(),j.value=T,A.value=void 0;const[,...a]=O.value,f=[void 0,...a];await E(...f),R.value=!1},loadMore:D,reset:q,refresh:async()=>{h.value=!0;const a=j.value-1,f=a<T?T:a;A.value=L[f].data,j.value=T;const[,...C]=O.value,N=[void 0,...C];await E(...N),S(),h.value=!1},cancel:()=>{M(),I.value=!1,h.value=!1},...Se(P,["refresh","mutate"])}}function en(e,n){const t=pe(e),{reset:r,run:u,...y}=Ke(t,n!=null?n:{}),g=c(!1);return{reload:async()=>{const{defaultParams:d=[],manual:h}=n;r(),h||(g.value=!0,await u(...d),g.value=!1)},run:u,reloading:g,...y}}export{Ze as a,en as u};

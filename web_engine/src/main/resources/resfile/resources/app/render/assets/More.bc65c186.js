import{u as pe,a as me}from"./index.es.256047cb.js";import{_ as V}from"./OgvBangumiSkeleton.a1380a74.js";import{ab as ve}from"./MoreFeedback.eac5fca1.js";import{k as fe,u as ge}from"./App.c1beb0e9.js";import{M as he,u as ye,al as ke,F as be,k as C,A as c,dO as Ce,aV as we,P as xe,m as Me,Q as R,o as t,aj as p,V as g,a as r,W as s,c as l,X as _,Y as m,$ as S,a0 as w,U as z,Z as F,dP as Se,aa as Pe,a6 as Ae,a7 as Be,dQ as Re}from"./index.f074ecef.js";import{u as Fe}from"./index.194c39d1.js";import{u as Ee}from"./useToggleMoreConditions.4241f327.js";import{_ as Ie}from"./plugin-vue_export-helper.21dcd24c.js";import"./style.2070e26d.js";import"./btn_devtools.06ffa497.js";import"./index.733b73c2.js";import"./modulepreload-polyfill.b7f2da20.js";import"./ico_max_exit.f7f1ea61.js";import"./index.14a3ec94.js";import"./isUdf.1a76b9f4.js";import"./ico_pin.a6faa7a5.js";/* empty css               */import"./theme-map.a3b52bba.js";var Le="./assets/empty.4ce332fe.png";const x=M=>(Ae("data-v-331e5cdf"),M=M(),Be(),M),Oe={class:"i_wrapper mb_44"},Te={class:"mt_lg mb_xl mb_sm"},$e={key:0,class:"mb_sm"},Ne=x(()=>r("span",{class:"gamepad-cursor","data-tp":"filterPgc","data-scroll":"y","data-bf":"100","data-sh":"300","data-wp":".bgm_pgc_scroll"},null,-1)),We={class:"flex_between mb_sm"},De=x(()=>r("span",{class:"gamepad-cursor","data-tp":"filterOrder","data-scroll":"y","data-bf":"100","data-sh":"300","data-wp":".bgm_pgc_scroll"},null,-1)),qe=x(()=>r("span",{class:"text2 mr_xs"},"\u66F4\u591A\u7B5B\u9009",-1)),He=x(()=>r("span",{class:"gamepad-cursor","data-tp":"filterOrder","data-scroll":"y","data-bf":"100","data-sh":"300","data-wp":".bgm_pgc_scroll"},null,-1)),Ve=["data-tp"],ze=["data-tp"],Qe={key:0,class:"row gutter_md"},Ue={key:1,class:"flex_center text3 lh_md fs_5"},je={key:2,class:"search-nodata-container p_relative"},Ge=x(()=>r("img",{class:"nodata-img p_center",src:Le,alt:""},null,-1)),Ke=[Ge],Xe={name:"HomeBangumiMore"},Ye=he({...Xe,setup(M){const E="main.index.0.0",u=ye(),Q=ke(),U=be(),v=u.meta.isBangumi==null?!1:u.meta.isBangumi,I=u.meta.isPgc==null?!1:u.meta.isPgc,L=C(null),P=C([]),i=C({filter:[],order:{field:"",name:"",values:[],choose:""}}),O=C(null),A=c(()=>v?[{name:"\u8FFD\u756A",value:"1"},{name:"\u56FD\u521B",value:"4"}]:[{name:"\u5168\u90E8",value:"102"},{name:"\u7535\u5F71",value:"2"},{name:"\u7535\u89C6\u5267",value:"5"},{name:"\u7EAA\u5F55\u7247",value:"3"},{name:"\u7EFC\u827A",value:"7"}]),h=C(u.query.index_type||A.value[0].value),j=c(()=>{var e,a,n;return(n=(a=(e=i.value)==null?void 0:e.filter)==null?void 0:a.slice(0,4))!=null?n:[]}),T=c(()=>{var e,a,n;return(n=(a=(e=i.value)==null?void 0:e.filter)==null?void 0:a.slice(4))!=null?n:[]}),G=c(()=>i.value.filter.reduce((e,a)=>(e[a.field]=a.choose,e),{})),$=c(()=>{var a;return{...{...G.value,type:Se,order:i.value.order.choose,index_type:h.value},...(a=u.query)!=null?a:{}}}),{data:K,loading:X}=pe(()=>Promise.all(A.value.map(e=>Re({index_type:e.value}))),{initialData:[],onSuccess(e){P.value=e,i.value=e.find(a=>a.index_type===h.value),i.value.order.choose=u.query.order||i.value.order.values[0].field,i.value.filter.forEach(a=>{a.choose=u.query[a.field]||a.values[0].keyword})}}),{dataList:y,loadMore:Y,noMore:N,loading:B,reload:k,data:Z,loadingMore:J}=me(async()=>{try{return Ce(new URLSearchParams($.value))}catch{return{list:[],has_next:0,num:0,size:25,total:0}}},{ready:c(()=>{var e;return(e=K.value)==null?void 0:e.length}),isNoMore(e){return e?!e.has_next&&!e.list.length:!0}}),{isShowMoreConditions:W,toggleSlideMoreConditions:ee}=Ee(O),D=we(),ae=()=>D.flashPageCursors();xe([W,y],()=>D.flashPageCursors(200),{deep:!0});const oe=c(()=>[...y.value,...J.value?Array.from(new Array(10),()=>({skeleton:!0,mode:"vertical"})):[]]),q=c(()=>{var e;return!B.value&&!((e=Z.value)!=null&&e.list.length)&&!y.value.length}),te=c(()=>q.value?!1:N.value),se=c(()=>B.value&&!y.value.length),f=(e,a=!1)=>Q.replace({name:u.name,query:a?e:{...u.query,...e}}),le=e=>{e.forEach(a=>{a.order.choose=a.order.values[0].field,a.filter.forEach(n=>{n.choose=n.values[0].keyword})})},re=async e=>{le(P.value),h.value=e.value,i.value=P.value.find(a=>a.index_type===h.value),await f({index_type:e.value,page:"1"},!0),k()},ne=async e=>{i.value.order.choose=e.field,await f({order:e.field,page:"1"}),k()},H=async(e,a)=>{e.choose=a.keyword,await f({[e.field]:a.keyword,page:"1"}),k()},ie=async()=>{if(N.value||B.value)return;const e=Number($.value.page)||1;await f({page:String(e+1)}),Y()},ue=e=>{!e.seasonId||Pe({type:"ogv",seasonId:e.seasonId,fromSpmid:`${E}.pv`})};return fe(v?".bangumi_more":".pgc_more"),ge(v?"HomeBangumiMore":"HomePgcMore",async()=>{await f({page:"1"}),k()}),Fe({spm_id:E,isKeepAlive:!1,pageName:v?"BangumiMore":"PgcMore"}),Me(async()=>{await f({page:"1"}),k()}),(e,a)=>{const n=R("v-button"),ce=R("WidgetArrow"),de=R("Scroller");return t(),p(de,{ref_key:"bangumiRef",ref:L,class:F(["bgm_pgc_scroll page_scroller u_select_none",{bangumi_more:s(v),pgc_more:s(I)}]),onLoadMore:ie,onScroll:ae},{default:g(()=>[r("div",Oe,[s(X)?(t(),p(V,{key:0,showLoadingAnimation:""})):(t(),l(_,{key:1},[r("div",Te,[s(I)?(t(),l("div",$e,[(t(!0),l(_,null,m(s(A),o=>(t(),p(n,{key:o.value,"active-pink":"",type:"tab",class:"mr_sm p_relative",active:o.value===h.value,onClick:b=>re(o)},{default:g(()=>[r("span",null,S(o.name),1),Ne]),_:2},1032,["active","onClick"]))),128))])):w("",!0),r("div",We,[r("div",null,[(t(!0),l(_,null,m(i.value.order.values,o=>(t(),p(n,{key:o.field,"active-pink":"",type:"tab",class:"mr_sm p_relative",active:o.field===i.value.order.choose,onClick:b=>ne(o)},{default:g(()=>[r("span",null,S(o.name),1),De]),_:2},1032,["active","onClick"]))),128))]),s(v)&&s(T).length?(t(),p(n,{key:0,class:"i_button_more p_relative","active-shrink":"",onClick:s(ee)},{default:g(()=>[qe,z(ce,{class:F(["i_icon_more ts_all_fast rotate_90 text2",{rotate_n90:s(W)}])},null,8,["class"]),He]),_:1},8,["onClick"])):w("",!0)]),(t(!0),l(_,null,m(s(j),(o,b)=>(t(),l("div",{key:o.field,class:"mb_sm"},[(t(!0),l(_,null,m(o.values,d=>(t(),p(n,{key:d.keyword,"active-pink":"",type:"tab",class:"mr_sm p_relative",active:d.keyword===o.choose,onClick:_e=>H(o,d)},{default:g(()=>[r("span",null,S(d.name),1),r("span",{class:"gamepad-cursor","data-tp":`filterRow${b}`,"data-scroll":"y","data-bf":"100","data-sh":"300","data-wp":".bgm_pgc_scroll"},null,8,Ve)]),_:2},1032,["active","onClick"]))),128))]))),128)),r("div",{ref_key:"moreConditions",ref:O,class:"hide ov_hidden"},[(t(!0),l(_,null,m(s(T),(o,b)=>(t(),l("div",{key:o.field},[(t(!0),l(_,null,m(o.values,d=>(t(),p(n,{key:d.keyword,"active-pink":"",type:"tab",class:"mb_sm mr_sm p_relative",active:d.keyword===o.choose,onClick:_e=>H(o,d)},{default:g(()=>[r("span",null,S(d.name),1),r("span",{class:"gamepad-cursor","data-tp":`filterMore${b}`,"data-scroll":"y","data-bf":"100","data-sh":"300","data-wp":".bgm_pgc_scroll"},null,8,ze)]),_:2},1032,["active","onClick"]))),128))]))),128))],512)]),s(se)?(t(),p(V,{key:0,showLoadingAnimation:""})):(t(),l(_,{key:1},[s(y).length?(t(),l("div",Qe,[(t(!0),l(_,null,m(s(oe),o=>(t(),l("div",{key:o.cover,class:F(["mb_xxl",{col_3:o.mode==="horizontal",col_xs_1_5:o.mode==="horizontal",col_2:o.mode==="vertical",col_sm_1_7:o.mode==="vertical"}])},[z(s(ve),{onClickBangumi:ue,mode:o.mode,skeleton:o.skeleton,info:o,appTheme:s(U).appTheme,rootRef:L.value,"disable-inline-player":"","disable-hover":"",showLoadingAnimation:"",scrollWrap:".bgm_pgc_scroll"},null,8,["mode","skeleton","info","appTheme","rootRef"])],2))),128))])):w("",!0),s(te)?(t(),l("div",Ue,"\u5DF2\u7ECF\u5230\u5E95\u5566~")):w("",!0),s(q)?(t(),l("div",je,Ke)):w("",!0)],64))],64))])]),_:1},8,["class"])}}});var ga=Ie(Ye,[["__scopeId","data-v-331e5cdf"]]);export{ga as default};

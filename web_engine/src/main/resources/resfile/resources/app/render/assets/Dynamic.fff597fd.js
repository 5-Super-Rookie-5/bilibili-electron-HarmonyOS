import{x as Ve,y as Ke,z as Oe,a as je,u as ze}from"./index.194c39d1.js";import{x as Q,y as ye,k,P as I,u as Be,be as We,g as $e,p as Le,M as O,o as h,c as D,X as Y,Y as se,a as i,Z as H,a0 as ie,U as w,$ as J,A as K,O as He,ae as Se,W as b,V as F,R as le,T as oe,a1 as Te,z,dS as Ye,t as he,aj as G,at as W,_ as _e,dT as qe,aw as Ze,a5 as Pe,Q as ae,a2 as me,bD as Ge,aM as ge,aB as fe,S as ce,l as Fe,m as Ee,w as Ie,C as Xe,dU as Je,aF as Qe,aV as be,i as et,aE as X,n as tt,b as at,dV as st,aJ as it}from"./index.f074ecef.js";import{_ as ke,u as lt}from"./AllFeedFragment.46cd0ff1.js";import{I as Re}from"./ico_max_exit.f7f1ea61.js";import{aa as ot,ab as nt,ac as ct,ad as ut,ae as rt,af as dt,g as ft,c as _t,ag as mt,ah as pt,V as vt,n as ht,ai as yt,aj as gt,ak as bt}from"./index.14a3ec94.js";import{D as wt}from"./vuedraggable.umd.b672350b.js";import{H as xt,B as De,ad as Ct,s as $t}from"./MoreFeedback.eac5fca1.js";import{_ as St,k as Me,u as kt,s as Dt}from"./App.c1beb0e9.js";import{_ as At}from"./btn_devtools.06ffa497.js";import{u as Bt}from"./useRouteScrollKeeper.7c392bad.js";import"./modulepreload-polyfill.b7f2da20.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./isUdf.1a76b9f4.js";import"./ico_pin.a6faa7a5.js";import"./style.2070e26d.js";/* empty css               */import"./theme-map.a3b52bba.js";import"./index.733b73c2.js";import"./LoginPanel.33272c26.js";const Ue=(t,u=200)=>{const{userInfo:n}=Q(ye()),a=k(!1);let f=null;return I(()=>n.value.isLogin,r=>{if(u)r?(clearTimeout(f),a.value=!0,t(a.value)):f=setTimeout(()=>{a.value=!1,t(a.value)},u);else return a.value=r,t(a.value)},{immediate:!!u}),{isLogin:a}},Lt=(t,u)=>{const n=Be(),a=We(()=>{n.name===t&&u()},800);$e.on("write",a),Le(()=>{$e.off("write",a)})};const Tt={key:0,class:"up_list w_100 loading"},Pt=i("div",{class:"up_list--item_skeleton--icon bd_radius_50"},null,-1),Ft=i("div",{class:"up_list--item_skeleton--title"},null,-1),Et=[Pt,Ft],It={key:1,class:"up_list w_100"},Rt=i("div",{class:"up_list--item--icon is-all bd_radius_50"},null,-1),Mt=i("div",{class:"up_list--item--title"},"\u5168\u90E8\u52A8\u6001",-1),Ut=i("span",{class:"gamepad-cursor","data-tp":"dynUpList","data-scroll":"y","data-bf":"20","data-sh":"300","data-wp":".app_dynamic--content-aside"},null,-1),Nt=[Rt,Mt,Ut],Vt=["onClick"],Kt={key:0,class:"up_list--item--dot p_absolute bd_radius_50"},Ot={class:"up_list--item--icon bd_radius_50"},jt={class:"up_list--item--title"},zt=i("span",{class:"gamepad-cursor","data-tp":"dynUpList","data-scroll":"y","data-bf":"20","data-sh":"300","data-wp":".app_dynamic--content-aside"},null,-1),Wt=O({__name:"UpList",props:{items:{type:Array,default:()=>[]},activeIndex:{type:Number,default:-1},loading:{type:Boolean,default:!0}},emits:["change"],setup(t,{emit:u}){const n=t,a=f=>{f!==n.activeIndex&&u("change",f)};return(f,r)=>t.loading?(h(),D("div",Tt,[(h(),D(Y,null,se(20,_=>i("div",{class:"up_list--item_skeleton",key:_},Et)),64))])):(h(),D("div",It,[i("div",{class:H(["up_list--item flex_row p_relative bd_radius_md cs_pointer",{"is-active":t.activeIndex===-1}]),onClick:r[0]||(r[0]=_=>a(-1))},Nt,2),(h(!0),D(Y,null,se(t.items,(_,l)=>(h(),D("div",{class:H(["up_list--item flex_row p_relative bd_radius_md cs_pointer",{"is-active":t.activeIndex===l}]),key:l,onClick:p=>a(l)},[_.has_update?(h(),D("div",Kt)):ie("",!0),i("div",Ot,[w(Ve,{face:_.face,width:32,height:32},null,8,["face"])]),i("div",jt,J(_.uname),1),zt],10,Vt))),128))]))}});const Ht={class:"dynamic_uploading_img"},Yt={class:"dynamic_uploading_img--progress"},qt=O({__name:"UploadingImg",props:{src:{type:String,default:""},data:{type:Object,default:()=>({})},progress:{type:Number,default:0}},setup(t){const u=t,n=k(!1);I(()=>u.progress,r=>{r===0&&(n.value=!0)},{immediate:!0});const a=K(()=>{var _;return{backgroundImage:`url(${u.src||He((_=u.data)==null?void 0:_.src,{w:160,h:160})})`}});function f(){u.progress===100&&(n.value=!1)}return(r,_)=>(h(),D("div",Ht,[i("div",{class:"dynamic_uploading_img--pic",style:Se(b(a))},null,4),w(Te,{name:"fade"},{default:F(()=>[le(i("div",Yt,[i("div",{class:"dynamic_uploading_img--progress--stage",style:Se({width:`${t.progress}%`}),onTransitionend:f},null,36)],512),[[oe,n.value]])]),_:1})]))}}),Zt={width:"17",height:"17",viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Gt=i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.728 4.243a1 1 0 0 0-1.414 0L8.485 7.07 5.657 4.243a1 1 0 0 0-1.414 1.414L7.07 8.486l-2.828 2.828a1 1 0 1 0 1.414 1.414L8.485 9.9l2.829 2.828a1 1 0 1 0 1.414-1.414L9.9 8.485l2.828-2.828a1 1 0 0 0 0-1.414Z",fill:"#fff"},null,-1),Xt=[Gt];function Jt(t,u){return h(),D("svg",Zt,[...Xt])}var Qt={render:Jt};const ea={class:"dynamic_pics_uploader"},ta={class:"dynamic_pics_uploader--header"},aa={class:"dynamic_pics_uploader--title"},sa={class:"dynamic_pics_uploader--desc"},ia=["onClick"],la=["onClick"],oa=["onClick"],na={key:0,class:"dynamic_pics_uploader--item--error"},ca=i("div",{class:"dynamic_pics_uploader--item--error__icon"},null,-1),ua={class:"dynamic_pics_uploader--item--error__msg"},ra={key:2,class:"dynamic_pics_uploader--item--skeleton"},da=i("span",{class:"dynamic_pics_uploader--item--skeleton--loading"},null,-1),fa=[da],_a=O({__name:"PicsUploaderPopover",props:{visible:{type:Boolean,default:!1},relative:{type:Boolean,default:!1},placement:{type:String,default:"bottom-start"},offset:{type:Object,default:()=>({x:0,y:0})},autohide:{type:Boolean,default:!1},maxAmount:{type:Number,default:9},maxSize:{type:Number,default:20},accept:{type:Array,default:()=>["png","jpeg","jpg","gif"]},minWidth:{type:Number,default:10},minHeight:{type:Number,default:10}},emits:["update:visible","change"],setup(t,{expose:u,emit:n}){const a=t,f={ITEM_STATUS_TYPE_LOADING:"LOADING",ITEM_STATUS_TYPE_SUCCESS:"SUCCESS",ITEM_STATUS_TYPE_ERROR:"ERROR"},r=8;function _(){return[{status:"",data:null,progress:0}]}const l=z({visibleState:!1,maxGifMByte:r,title:"\u56FE\u7247\u4E0A\u4F20",list:_(),dragging:!1,uploader:null}),p=K(()=>`${l.list.length<a.maxAmount+1?l.list.length-1:a.maxAmount} / ${a.maxAmount}`),e=K(()=>l.list.filter(s=>s.status===f.ITEM_STATUS_TYPE_SUCCESS).map(s=>({...s.data})));I(e,s=>{n("change",s)}),I(()=>l.visibleState,s=>{s&&(e.value.length||L()),n("update:visible",s)}),I(()=>a.visible,s=>{s!==l.visibleState&&(l.visibleState=s)});const x=new Ye({accept:a.accept,multiple:!0,maxSize:a.maxSize,minWidth:a.minWidth,minHeight:a.minHeight,onBeforeUpload:T});function m(s){return s===l.list.length-1?l.list.length!==a.maxAmount+1:!1}function $(){l.visibleState=!1,l.list=_()}function B(s){l.list=s.map(d=>{const c=x.getProcessedItem(d);return c.src=d.img_src,c})}async function S(){if(l.list.length<2){$();return}await Pe({content:"\u5173\u95ED\u5C06\u6E05\u9664\u6240\u6709\u5DF2\u6DFB\u52A0\u56FE\u7247\uFF0C\u8BF7\u786E\u8BA4",confirmText:"\u6E05\u9664\u56FE\u7247",cancelText:"\u70B9\u9519\u4E86~"})&&$()}function T(s){const d=s.length+l.list.length-1-a.maxAmount;d>0&&(s.splice(s.length-d),he({content:`\u4E0A\u4F20\u56FE\u7247\u4E0D\u5F97\u8D85\u8FC7${a.maxAmount}\u5F20`}))}async function L(){try{const s=[...l.list.slice(0,l.list.length-1),...await x.trigger()];s.length<a.maxAmount+1&&s.push(..._()),l.list=s}catch(s){console.log(s)}}function P(s){const d=[...l.list];d.splice(s,1),l.list=d}return u({refresh:B,close:$}),(s,d)=>(h(),G(ot,{visible:l.visibleState,"onUpdate:visible":d[2]||(d[2]=c=>l.visibleState=c),width:"290",relative:t.relative,placement:t.placement,offset:t.offset,autohide:t.autohide},{reference:F(()=>[W(s.$slots,"reference")]),default:F(()=>[i("div",ea,[i("div",ta,[i("span",aa,J(l.title),1),i("span",sa,J(b(p)),1),i("div",{class:"dynamic_pics_uploader--close",onClick:_e(S,["stop"])},[w(b(Re))],8,ia)]),w(b(wt),{list:l.list,class:H({"dynamic_pics_uploader--content":!0,dragging:l.dragging}),draggable:".dynamic_pics_uploader--item",animation:"500","item-key":"id",onStart:d[0]||(d[0]=c=>l.dragging=!0),onEnd:d[1]||(d[1]=c=>l.dragging=!1)},{item:F(({element:c,index:C})=>[C<a.maxAmount?(h(),D("div",{key:0,class:H({"dynamic_pics_uploader--add":m(C),"dynamic_pics_uploader--item":!m(C),[c.status.toLowerCase()]:!m(C)}),onClick:_e(()=>{!m(C)||L()},["stop"])},[m(C)?ie("",!0):(h(),D(Y,{key:0},[i("div",{class:"dynamic_pics_uploader--item--remove",onClick:_e(j=>P(C),["stop"])},[w(b(Qt))],8,oa),c.status==="ERROR"?(h(),D("div",na,[ca,i("div",ua,J(c.msg),1)])):c.src||c.data&&c.data.img_src?(h(),G(qt,qe(Ze({key:1},c)),null,16)):(h(),D("div",ra,fa))],64))],10,la)):ie("",!0)]),_:1},8,["list","class"])])]),_:3},8,["visible","relative","placement","offset","autohide"]))}}),ma={width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},pa=i("path",{d:"M11.1 13.434c.939 0 1.7-.755 1.7-1.688 0-.932-.761-1.688-1.7-1.688s-1.7.756-1.7 1.688c0 .933.761 1.688 1.7 1.688Zm11.906-7.597a3.63 3.63 0 0 1 3.644 3.625v12.91c0 2.001-1.633 3.625-3.644 3.625H8.994a3.63 3.63 0 0 1-3.644-3.625V9.462c0-2 1.633-3.625 3.644-3.625h14.012ZM20.393 18.03c-1.957.234-3.577 1.51-4.879 3.894a.602.602 0 0 1-.932.156c-1.319-1.196-2.765-1.683-4.381-1.485-1.398.171-2.51 1.05-3.36 2.703a2.34 2.34 0 0 0 2.153 1.41h14.012a2.34 2.34 0 0 0 2.344-2.335v-1.77l-.015-.021c-1.454-1.947-3.085-2.774-4.942-2.552Zm2.613-10.9H8.994A2.34 2.34 0 0 0 6.65 9.461v11.921c.914-1.14 2.052-1.806 3.404-1.971 1.739-.214 3.338.23 4.77 1.315 1.423-2.308 3.237-3.62 5.426-3.88 1.902-.228 3.611.425 5.1 1.92V9.461a2.335 2.335 0 0 0-2.344-2.334Z",fill:"#9499A0"},null,-1),va=[pa];function ha(t,u){return h(),D("svg",ma,[...va])}var ya={render:ha};const ga={class:"dynamic_publish"},ba={class:"dynamic_publish--input"},wa={class:"dynamic_publish--control"},xa={class:"dynamic_publish--tools"},Ca=me(" > "),$a={class:"dynamic_publish--headquarters"},Sa=["title"],ka=O({__name:"index",props:{version:{type:String,default:"lite",validator(t){return["lite","pro"].includes(t)}},defaultContent:{type:String,default:""},defaultContentNodes:{type:Array,default:()=>[]}},emits:["done","popover-visible-change"],setup(t,{expose:u,emit:n}){const a=t,{userInfo:f}=Q(ye()),r=z({init:!1,publish:!1}),_=k(""),l=z({id:0,name:"",requestId:"",fromSource:""}),p=z({value:"",nodes:[]}),e=z({tools:{emoji:{visible:!0,active:!1},pic:{visible:!0,active:!1,config:{maxSize:20},data:z([])},at:{visible:!0,active:!1,config:{maxCount:20}},topic:{visible:!1,active:!1},poll:{visible:!1,active:!1,data:{id:0,title:""}},lottery:{visible:!1,active:!1,data:{id:0,title:""}},popularize:{visible:!1,active:!1,data:{id:0,type:0}},videoReserve:{visible:!1,active:!1,data:{id:0,source:0,lottery:0}},liveReserve:{visible:!1,active:!1,data:{id:0,source:0,lottery:0}}},commentOption:{active:!1,value:1,list:[]},maxContentLength:1e3,maxArticleContentLength:2e4});z({visible:!1,resolve:null,reject:null});const x=K(()=>!!(p.value||e.tools.pic.data.length)),m=K(()=>nt(p.value)),$=K(()=>{const o=m.value,y=o>0,A=o>e.maxContentLength;let g=o;return A&&(g=e.maxContentLength-o),{visible:y,text:g,heedful:A,title:"\u5168\u89D2\u5B57\u7B26\u8BA1\u6570\u4E3A1\u534A\u89D2\u5B57\u7B26\u8BA1\u6570\u4E3A0.5\uFF0C\u4E0D\u8DB31\u65F6\u8BB0\u4E3A1"}}),B=K(()=>{const o=r.init||r.publish,y=!p.value.replace(/\s/g,"").length,A=e.tools.pic.data.length===0;return{text:"\u53D1\u5E03",disabled:o||y&&A||$.value.heedful}}),S=z({textarea:null,emojiPopover:null,picsUploaderPopover:null});function T(o,y){S[o]=y}function L(o,{nodes:y}){let A=0,g={at:!1};const E=e.tools.at.config.maxCount;y.forEach(M=>{if(M.type==="highlight")switch(M.data.type){case"at":A++;break}}),o.forEach((M,V)=>{if(M.type==="highlight")switch(M.data.type){case"at":A===E?(g.at=!0,o[V]=ft(M.text)):A++;break}}),g.at&&he({content:`\u6700\u591A\u652F\u6301@ ${E}\u4F4D\u7528\u6237`})}function P(o){const{value:y,nodes:A}=o;p.value=y;const g={poll:null,lottery:null};p.nodes=A.map(E=>{if(E.type==="highlight")switch(E.data.type){case"vote":g.poll={id:E.data.rid,title:E.data.text};break;case"lottery":g.lottery={id:E.data.rid,title:E.data.text};break}return E}),g.poll?!e.tools.poll.data.id&&e.tools.poll.visible&&(e.tools.poll.data=g.poll):e.tools.poll.data.id&&this._resetTool("poll"),g.lottery?!e.tools.lottery.data.id&&e.tools.lottery.visible&&(e.tools.lottery.data=g.lottery):e.tools.lottery.data.id&&this._resetTool("lottery"),l.id}function s(o){o.type===4?C({type:"text",data:{text:o.text}}):C({type:"emoji",data:o})}function d(o){_t(e.tools.pic.data,...o)}async function c(o){var y,A;switch((A=(y=e.tools[o])==null?void 0:y.config)!=null&&A.focus&&await te(),o){case"at":C({type:"text",data:{text:"@"}});break}}function C(...o){S.textarea.insert(...o)}function j(o){var y;if(o!=null&&o.length){S.picsUploaderPopover.refresh(o),e.tools.pic.active=!0;return}(y=S.picsUploaderPopover)==null||y.close()}function q(o){switch(o){case"pic":j([]);break}}function N(){var o;S.textarea.refresh({nodes:[]}),(o=e.tools.pic.data)!=null&&o.length&&q("pic")}async function pe(){if(!B.value.disabled){r.publish=!0;try{const o=await mt({nodes:p.nodes,pics:e.tools.pic.data,topic:l,scene:0,uploadId:_.value,comment:e.commentOption.value});he({content:"\u53D1\u5E03\u6210\u529F"}),r.publish=!1,n("done",{...o},{topic:Ge(l)}),N()}catch(o){r.publish=!1,console.log(o.message)}}}function ve(){_.value=`${f.value.mid||0}_${Math.floor(Date.now()/1e3)}_${Math.floor(Math.random()*1e4)}`}async function ue(){var o,y,A,g,E,M;try{r.init=!0;const{settings:V,permissions:U}=await pt();if(e.maxContentLength=V.max_content_length||1e3,e.maxArticleContentLength=V.max_article_content_length||2e4,e.tools.at.config.maxCount=V.max_at_count||20,e.tools.pic.config.maxSize=V.max_upload_size,a.version==="pro"){e.tools.poll.visible=!0,e.tools.lottery.visible=!!((o=U.lottery)!=null&&o.allowable),e.tools.popularize.visible=!!((y=U.popularize)!=null&&y.allowable),e.tools.videoReserve.visible=!!((A=U.video_reserve)!=null&&A.allowable),e.tools.liveReserve.visible=!!((g=U.live_reserve)!=null&&g.allowable);const Z=[];(E=U.control_comment)!=null&&E.allowable&&Z.push({...U.control_comment,value:0}),(M=U.choose_comment)!=null&&M.allowable&&Z.push({...U.choose_comment,value:2}),Z.length&&Z.unshift({value:1,title:"\u5141\u8BB8\u8BC4\u8BBA",desc:""}),e.commentOption.list=Z}_.value||ve()}catch(V){console.log(V.message)}r.init=!1}async function ee(){if(r.init||r.publish)return Promise.reject(new Error("loading..."));x.value&&await Pe({content:"\u662F\u5426\u4FDD\u5B58\u672C\u6B21\u7F16\u8F91",cancelText:"\u4E0D\u4FDD\u5B58",confirmText:"\u4FDD\u5B58"})?console.log("save"):N()}async function te(){await xt(0),S.textarea.focus()}return I(e,o=>{const y=o.tools.emoji.active||o.tools.pic.active;n("popover-visible-change",y)},{deep:!0}),u({init:ue,exit:ee,focus:te}),(o,y)=>{const A=ae("VButton");return h(),D("div",ga,[i("div",ba,[w(b(ct),{ref:g=>T("textarea",g),placeholder:"\u6709\u4EC0\u4E48\u60F3\u548C\u5927\u5BB6\u5206\u4EAB\u7684\uFF1F","default-value":t.defaultContent,"default-nodes":t.defaultContentNodes,"before-insert":L,onChange:P},null,8,["default-value","default-nodes"])]),i("div",wa,[i("div",xa,[w(rt,{visible:e.tools.emoji.active,"onUpdate:visible":y[0]||(y[0]=g=>e.tools.emoji.active=g),relative:"",ref:g=>T("emojiPopover",g),"mutex-id":"tool",offset:{x:-11,y:32},onSelect:s},{reference:F(()=>[i("div",{class:H({"dynamic_publish--tools--item":!0,active:e.tools.emoji.active})},[w(b(ut))],2),Ca]),_:1},8,["visible"]),w(_a,{visible:e.tools.pic.active,"onUpdate:visible":y[1]||(y[1]=g=>e.tools.pic.active=g),relative:"",ref:g=>T("picsUploaderPopover",g),offset:{x:-11,y:32},"max-size":e.tools.pic.config.maxSize,onChange:d},{reference:F(()=>[i("div",{class:H({"dynamic_publish--tools--item":!0,active:e.tools.pic.active})},[w(b(ya))],2)]),_:1},8,["visible","max-size"]),i("div",{class:"dynamic_publish--tools--item",onClick:y[2]||(y[2]=g=>c("at"))},[w(b(dt))])]),i("div",$a,[le(i("div",{class:H({"dynamic_publish--hint":!0,heedful:b($).heedful}),title:b($).title},J(b($).text),11,Sa),[[oe,b($).visible]]),w(A,{class:"dynamic_publish--action bd_radius_sm",disabled:b(B).disabled,type:"pink",onClick:pe},{default:F(()=>[me(J(b(B).text),1)]),_:1},8,["disabled"])])])])}}});const Da={class:"dynamic_publish_popup--header flex_between"},Aa=["textContent"],Ba=["onClick"],La={class:"dynamic_publish_popup--content"},Ta=O({__name:"PublishPopup",emits:["done"],setup(t,{expose:u,emit:n}){const a=k(null),f=k(null),r=k("\u53D1\u5E03\u52A8\u6001"),_=()=>{a.value.show(),f.value.init(),f.value.focus()},l=async()=>{try{await f.value.exit(),a.value.hide()}catch(x){console.log(x)}},p=(...x)=>{a.value.hide(),n("done",...x)},e=x=>{x?a.value.el.style.top="calc(50% - 100px)":a.value.el.style.top=""};return u({show:_,hide:l}),(x,m)=>(h(),G(vt,{"custom-class":"dynamic_publish_popup",ref_key:"popupRef",ref:a,onWrapClick:l},{default:F(()=>[i("div",Da,[i("div",{class:"dynamic_publish_popup--title",textContent:J(r.value)},null,8,Aa),i("div",{class:"dynamic_publish_popup--close",onClick:_e(l,["stop"])},[w(b(Re))],8,Ba)]),i("div",La,[w(ka,{ref_key:"publishRef",ref:f,onDone:p,onPopoverVisibleChange:e},null,512)])]),_:1},512))}}),Pa={class:"dynamic_all"},Fa=O({__name:"DynamicAll",props:{active:{type:Boolean,default:!1},hostMid:{type:Number,default:0}},emits:["focus"],setup(t,{expose:u,emit:n}){const a=t,f=k(null),r=k(null),_=k(null),l=k(null),p=k(0),e=k({}),x=async(c=!1)=>{var C,j,q,N;f.value||await Ie(),L(),c?((C=f.value)==null||C.refresh(),(j=r.value)==null||j.refresh()):a.hostMid?(N=r.value)==null||N.refresh():(q=f.value)==null||q.refresh(),S(),s()},{isLogin:m}=Ue(x),{fromOuterSpmId:$}=Q(ge());fe("pageSpmId",ce.dynamicAll),fe("fromOuterSpmId",$.value),fe("dynamicScene","dynamic"),fe("galleryContainer",".dynamic_all"),Lt("Dynamic",()=>{if(!m.value){Xe("dynamicAll.write");return}n("focus"),_.value.show()});const B=k(!1),S=async(c=!1)=>{if(!(!m||B.value))try{c||(B.value=!0);const C=await Je();e.value=C,B.value=!1}catch{e.value={},B.value=!1}},T=async c=>{try{const{item:C}=await ht(c.dyn_id_str,!0);f.value.unshift(C)}catch(C){console.log(C)}},L=()=>{var c;(c=l.value)==null||c.close()};u({handleRefresh:x,closeDetails:L}),I(()=>a.hostMid,c=>{L(),c&&(p.value=c)});let P=null;const s=()=>{clearInterval(P),P=setInterval(()=>S(!0),2e4)},d=()=>{clearInterval(P)};return Fe(()=>{"total"in e.value&&S(!0),s()}),Ee(()=>d()),(c,C)=>le((h(),D("div",Pa,[w(ke,{ref_key:"feedFragmentAll",ref:f,active:t.active&&!t.hostMid,liveList:e.value,liveLoading:B.value,"page-key":"dynamic-all","class-key":"all"},null,8,["active","liveList","liveLoading"]),w(ke,{ref_key:"feedFragmentUp",ref:r,active:t.active&&!!t.hostMid,liveList:e.value,liveLoading:B.value,"page-key":"dynamic-all","class-key":"up","host-mid":p.value},null,8,["active","liveList","liveLoading","host-mid"]),w(Ta,{ref_key:"publishPopupRef",ref:_,onDone:T},null,512),w(Ke,{ref_key:"allSupplements",ref:l,active:t.active},null,8,["active"])],512)),[[oe,t.active]])}});const Ea=i("div",{class:"feed_fragment--loading"},null,-1),Ia=i("div",{class:"feed_fragment--empty"},[i("img",{src:St}),i("p",null,"\u6CA1\u6709\u4F60\u60F3\u8981\u7684\u5185\u5BB9~")],-1),Ra={class:"feed_fragment--error"},Ma=i("img",{src:At},null,-1),Ua=i("p",null,"\u5185\u5BB9\u4E0D\u89C1\u4E86\uFF0C\u8BF7\u60A8\u518D\u5237\u65B0\u8BD5\u8BD5",-1),Na=me("\u518D\u8BD5\u4E00\u6B21"),Va=O({__name:"FeedFragmentVideo",props:{active:{type:Boolean,default:!0},status:{type:String,default:"initial"},list:{type:Array,default:()=>[]},feedKey:{type:String,default:"id"},itemKey:{type:String,default:"id"},useItemWrapper:{type:Boolean,default:!1},disableScroll:{type:Boolean,default:!1}},emits:["load-more","refresh"],setup(t,{expose:u,emit:n}){const a=t;function f(m,$){return m[a.itemKey]||$}const{routePositions:r}=Q(Qe()),_=k(),l=be(),p=m=>{a.feedKey&&(r.value[a.feedKey]=m.target.scrollTop),l.flashPageCursors()};I(()=>a.active,m=>{m&&_.value&&(setTimeout(()=>{const $=r.value[a.feedKey];et($)&&(_.value.$el.scrollTop=$)}),a.feedKey&&X.emit("resetRoutePosition",a.feedKey))},{immediate:!0});function e(){!a.list.length&&!a.useItemWrapper||n("load-more")}function x(){n("refresh")}return u({rootRef:_}),(m,$)=>{const B=ae("VButton"),S=ae("Scroller");return h(),G(S,{class:"dyn_video_scroll feed_fragment page_scroller",ref_key:"pageScrollRef",ref:_,disabled:t.disableScroll,active:t.active,onLoadMore:e,onScrollPassive:p},{default:F(()=>[W(m.$slots,"top"),t.list.length?ie("",!0):(h(),D(Y,{key:0},[t.status==="loading"?W(m.$slots,"loading",{key:0},()=>[Ea]):t.status==="empty"?W(m.$slots,"empty",{key:1},()=>[Ia]):t.status==="error"?W(m.$slots,"error",{key:2},()=>[i("div",Ra,[Ma,Ua,w(B,{type:"pink",size:"large",onClick:x},{default:F(()=>[Na]),_:1})])]):ie("",!0)],64)),t.useItemWrapper?W(m.$slots,"itemWrapper",{key:1}):(h(!0),D(Y,{key:2},se(t.list,(T,L)=>W(m.$slots,"item",{key:f(T,L),data:T,index:L})),128)),W(m.$slots,"bottom")]),_:3},8,["disabled","active"])}}});const Ka={class:"pt_lg i_wrapper dynamic_video_feed_fragment--skeleton row gutter_md"},Oa={class:"row gutter_md pt_lg i_wrapper"},Ae=O({__name:"VideoFeedFragment",props:{pageKey:{type:String,default:""},classKey:{type:String,default:""},active:{type:Boolean,default:!1},hostMid:{type:Number,default:0}},setup(t,{expose:u}){const n=t,a="dynamic_video_feed_fragment",f=be(),r=K(()=>({dynamic_video_feed_fragment:!0,[n.classKey]:n.classKey})),_=K(()=>n.pageKey&&n.classKey?`${n.pageKey}-${n.classKey}`:""),l=yt(a,n.classKey);Me(l,{watchParam:()=>n.active});const p=new Map,{status:e,list:x,reset:m}=Oe([]),$=z({offset:"",page:0}),B=()=>{m(),p.clear(),$.offset="",$.page=0},S=async()=>{if(e.value!=="noMore"&&e.value!=="loading"){e.value="loading";try{const{items:s,has_more:d,offset:c,page:C}=await gt({offset:$.offset,page:++$.page,hostMid:n.hostMid});s!=null&&s.length&&s.forEach((j,q)=>{const N=j.aid;p.get(N)||(p.set(N,!0),x.value.push(Ct(j,q)))}),$.offset=c,$.page=C,x.value.length?d?e.value="loaded":e.value="noMore":e.value="empty",f.flashPageCursors(200)}catch{e.value="error"}}};async function T(s=!0){return new Promise(d=>{$t({element:document.querySelector(l),speed:3,animation:s,onDone:d})})}let L=n.hostMid;async function P(s=!0){L=n.hostMid,await T(s),B(),S()}return I(()=>n.active,s=>{!s||e.value!=="initial"&&L===n.hostMid||P()}),I(()=>n.hostMid,()=>{!n.active||P(!1)}),u({refresh:P}),(s,d)=>le((h(),G(Va,{class:H(b(r)),"use-item-wrapper":"",status:b(e),active:t.active,"feed-key":b(_),onLoadMore:S,onHandleRefresh:P},{loading:F(()=>[i("div",Ka,[(h(),D(Y,null,se(20,c=>i("div",{class:"col_4 col_sm_3 col_lg_1_5 mb_xxl",key:c},[w(b(De),{showAvatar:!0,"disable-frame":"","disable-scale":"",showLoadingAnimation:!0,skeleton:!0})])),64))])]),itemWrapper:F(()=>[i("div",Oa,[(h(!0),D(Y,null,se(b(x),(c,C)=>(h(),D("div",{class:"home_hots_all--video col_4 col_sm_3 col_lg_1_5 mb_xxl",key:c.aid},[w(b(De),{info:c,"is-rcmd":"","img-lazy":"eager","disable-frame":"","disable-scale":"",iid:"pc_app_dynamic_video","is-first-card":C===0,"scroll-wrap":`.dyn_video_scroll.${t.classKey}`},null,8,["info","is-first-card","scroll-wrap"])]))),128))])]),_:1},8,["class","status","active","feed-key"])),[[oe,t.active]])}}),ja={class:"dynamic_video"},za=O({__name:"DynamicVideo",props:{active:{type:Boolean,default:!1},hostMid:{type:Number,default:0}},setup(t,{expose:u}){const n=t,a=k(null),f=k(null),r=k(0),_=async(l=!1)=>{var p,e,x,m;a.value||await Ie(),l?((p=a.value)==null||p.refresh(),(e=f.value)==null||e.refresh()):n.hostMid?(m=f.value)==null||m.refresh():(x=a.value)==null||x.refresh()};return Ue(_),u({handleRefresh:_}),I(()=>n.hostMid,l=>{l&&(r.value=l)}),tt(()=>{Me(".dynamic_video .feed_fragment",{watchParam:()=>n.active})}),(l,p)=>le((h(),D("div",ja,[w(Ae,{ref_key:"feedFragmentAll",ref:a,active:t.active&&!t.hostMid,"page-key":"dynamic-video","class-key":"all"},null,8,["active"]),w(Ae,{ref_key:"feedFragmentUp",ref:f,active:t.active&&!!t.hostMid,"page-key":"dynamic-video","class-key":"up","host-mid":r.value},null,8,["active","host-mid"])],512)),[[oe,t.active]])}});const Wa=O({__name:"Notification",props:{visible:{type:Boolean,default:!1}},emits:["check"],setup(t,{emit:u}){const{isLiveListSmall:n}=Q(ge()),a=()=>u("check");return(f,r)=>(h(),G(Te,{name:"v_notification--transition"},{default:F(()=>[le(i("div",{class:H(["v_notification u_select_none",{"dyn-live-sm":b(n)}]),onClick:a},[W(f.$slots,"default")],2),[[oe,t.visible]])]),_:3}))}}),Ha={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ya=i("path",{d:"M14.375 2.195c-.008-.353-.278-.576-.663-.568-.387.008-.586.244-.65.597-.032.184-.022.376-.024.564-.003.32 0 .642 0 .963l-.151.068c-.169-.162-.334-.327-.506-.485-1.55-1.428-3.387-1.96-5.445-1.644-2.906.446-5.059 2.866-5.311 5.885-.237 2.833 1.59 5.57 4.334 6.491 2.775.932 5.863-.152 7.424-2.609.1-.158.204-.32.266-.495.119-.34.059-.656-.277-.838-.323-.174-.63-.104-.859.192-.114.149-.202.318-.309.473-.968 1.397-2.297 2.159-3.998 2.242a5.03 5.03 0 0 1-5.029-3.544 5.065 5.065 0 0 1 2.29-5.855c1.972-1.149 4.503-.819 6.099.801.117.119.195.275.385.548-.623 0-1.103-.026-1.578.007-.44.03-.672.292-.668.659.003.357.252.652.675.663a93.97 93.97 0 0 0 3.31.005c.364-.004.665-.212.676-.571.036-1.182.039-2.367.01-3.549Z",fill:"#E58900"},null,-1),qa=[Ya];function Za(t,u){return h(),D("svg",Ha,[...qa])}var Ga={render:Za};const Xa={class:"flex_start flex_inline"},Ja=i("span",{class:"gamepad-cursor cursor-vui-tabs","data-tp":"header"},null,-1),Qa={class:"app_dynamic i_page_wrapper"},es={class:"app_dynamic--content i_page_content flex_row"},ts={class:"app_dynamic--content--main h_100 p_relative"},as=me("\u6709\u65B0\u52A8\u6001\uFF0C\u70B9\u51FB\u5237\u65B0 "),ss=i("span",{class:"gamepad-cursor","data-tp":"dynNotice"},null,-1),Cs=O({__name:"Dynamic",setup(t){je(".app_dynamic");const u=be(),n=v=>{a(v),u.flashPageCursors()},{handlePageScroll:a,resetScrollPosition:f,restoreScrollPosition:r,routePositions:_,pageScrollRef:l}=Bt("DynamicUpList",!1),{userInfo:p}=Q(ye()),e=k(null),x=k(null);let m=Date.now();const $=K(()=>p.value.isLogin?[{key:"1",name:"\u7EFC\u5408"},{key:"2",name:"\u89C6\u9891"}]:[{key:"1",name:"\u7EFC\u5408"}]),B=lt(),S=k(0),T=k([]),L=k(!1);let P="1";const s=Be();p.value.isLogin&&(s.query.tab?P=s.query.tab==="video"?"2":"1":P=at("store/getData","DYNAMIC_DEF_TAB_KEY")||"1");const d=k(P),c=k(-1),{spmId:C,reportPv:j,initEnterTime:q,pageName:N,logOpenAppPage:pe}=ze({spm_id:P==="1"?ce.dynamicAll:ce.dynamicVideo,pageName:P==="1"?"DynamicAll":"DynamicVideo"}),ve=(v=!1)=>{var R,re,de;d.value==="1"?(R=e.value)==null||R.handleRefresh(v):((re=e.value)==null||re.handleRefresh(),(de=x.value)==null||de.handleRefresh(v))},ue=()=>{X.emit("closeCommentDetails")};I(s,()=>{s.name==="Dynamic"&&(ue(),s.query.tab==="all"?d.value="1":s.query.tab==="video"&&p.value.isLogin&&(d.value="2"))},{immediate:!0}),I(d,v=>{var R;d.value==="2"&&((R=x.value)==null||R.handleRefresh(!!S.value)),it("store/setData","DYNAMIC_DEF_TAB_KEY",v),j(),C.value=v==="1"?ce.dynamicAll:ce.dynamicVideo,q(),N.value=v==="1"?"DynamicAll":"DynamicVideo",pe(),u.flashPageCursors(200),setTimeout(()=>X.emit("initDynCardOffset"),300)});const ee=k(Date.now());let te=ee.value,o=3e5,y=null;const A=k(!1),g=K(()=>{const v=B.value&&A.value&&(!S.value||ee.value-te>o);return v&&!S.value&&(te=0),v});I(g,()=>u.flashPageCursors(100));const{updateBaseLine:E}=Q(ge()),M=async()=>{try{if(!E.value)return;const{update_num:v}=await bt(E.value,d.value==="2");v>0&&(A.value=!0)}catch(v){console.log(v)}},V=()=>{clearInterval(y),y=setInterval(()=>{ee.value=Date.now(),A.value||M()},30*1e3)},U=()=>{A.value=!1;const v=!!S.value;v&&(te=ee.value),Z(-1),xe(),setTimeout(()=>{ve(v),V()})},Z=v=>{c.value=v,v!==-1?(T.value[v].has_update=!1,S.value=T.value[c.value].mid):S.value=0,u.flashPageCursors(200),setTimeout(()=>X.emit("initDynCardOffset"),300)},we=v=>{["dynamic-all-all","dynamic-all-up","dynamic-video-all","dynamic-video-up"].filter(R=>R!==v).forEach(R=>{_.value[R]=0})};X.on("resetRoutePosition",v=>we(v));const xe=async()=>{if(!p.value.isLogin){T.value=[];return}if(!L.value){L.value=!0;try{const v=await st();T.value=(v==null?void 0:v.items)||[],u.flashPageCursors(100)}catch{}L.value=!1,f(),we()}};I(()=>p.value.isLogin,()=>{xe()},{immediate:!0}),kt("Dynamic",()=>{U()});let Ce=null;return Fe(()=>{Date.now()-m>12e4?U():(r(),V()),clearTimeout(Ce),Ce=setTimeout(()=>M(),1e3),u.flashPageCursors(200),setTimeout(()=>X.emit("initDynCardOffset"),300)}),Ee(()=>{m=Date.now(),clearInterval(y)}),Le(()=>X.off("resetRoutePosition")),(v,R)=>{const re=ae("v-tab-item"),de=ae("v-tabs"),Ne=ae("HeaderSlot");return h(),D(Y,null,[w(Ne,null,{default:F(()=>[i("div",Xa,[w(de,{class:"mt_xs","auto-adjustment":"",activeKey:d.value,"onUpdate:activeKey":R[0]||(R[0]=ne=>d.value=ne),"slide-to-hover":!1,"active-pink":!0,"no-padding-left":!1,"tabs-gutter":30,"slider-width":18,onTabChange:ue},{default:F(()=>[(h(!0),D(Y,null,se(b($),ne=>(h(),G(re,{key:ne.key,tab:ne.name},{extra:F(()=>[Ja]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])])]),_:1}),i("div",Qa,[i("div",es,[w(Dt,{ref_key:"pageScrollRef",ref:l,class:"app_dynamic--content-aside auto_hide_scrollbar",onScrollPassive:n},{default:F(()=>[w(Wt,{items:T.value,loading:L.value,"active-index":c.value,onChange:Z},null,8,["items","loading","active-index"])]),_:1},512),i("div",ts,[w(Fa,{ref_key:"dynamicAll",ref:e,active:b(B)&&d.value==="1","host-mid":S.value,onFocus:R[1]||(R[1]=ne=>d.value="1")},null,8,["active","host-mid"]),b(p)&&b(p).isLogin?(h(),G(za,{key:0,ref_key:"dynamicVideo",ref:x,active:b(B)&&d.value==="2","host-mid":S.value},null,8,["active","host-mid"])):ie("",!0),w(Wa,{class:"app_dynamic--notification",visible:b(g),onCheck:U},{default:F(()=>[w(b(Ga),{class:"app_dynamic--notification-ico"}),as,ss]),_:1},8,["visible"])])])])],64)}}});export{Cs as default};

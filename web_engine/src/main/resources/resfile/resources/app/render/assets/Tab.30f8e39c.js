import{u as ae,a as re}from"./index.es.256047cb.js";import{ab as D}from"./MoreFeedback.eac5fca1.js";import{_ as ne}from"./OgvBangumiSkeleton.a1380a74.js";import{M as le,al as ue,u as ie,F as ce,k as T,aV as _e,A as h,P as de,l as me,m as pe,Q as R,o as a,aj as B,V as H,a as u,W as r,c as n,X as v,Y as x,$ as S,U as y,Z as P,a0 as j,dM as F,dN as q,aa as fe,a6 as he,a7 as ve}from"./index.f074ecef.js";import{k as ge,u as be,N as xe}from"./App.c1beb0e9.js";import{u as ye,a as ke}from"./index.194c39d1.js";import{_ as we}from"./plugin-vue_export-helper.21dcd24c.js";import"./style.2070e26d.js";import"./btn_devtools.06ffa497.js";import"./index.733b73c2.js";import"./modulepreload-polyfill.b7f2da20.js";import"./ico_max_exit.f7f1ea61.js";import"./index.14a3ec94.js";import"./isUdf.1a76b9f4.js";import"./ico_pin.a6faa7a5.js";/* empty css               */import"./theme-map.a3b52bba.js";const Ce=g=>(he("data-v-bce9c5f4"),g=g(),ve(),g),Te={class:"i_wrapper mb_44"},Re={class:"flex_between mb_9 fs_3 text1 fw_bold fw_400 h_34"},Be={class:"text2 mr_xs"},Se=Ce(()=>u("span",{class:"gamepad-cursor","data-tp":"pgcCard"},null,-1)),Pe={class:"row gutter_md"},Fe={key:0},Ie={class:"flex_between mb_9 fs_3 text1 fw_bold fw_400 h_34"},Me={class:"row gutter_md"},Ne={key:0,class:"flex_center text3 lh_md fs_5"},ze=le({__name:"Tab",setup(g){const G=ue(),p=ie(),I=ce(),i=p.meta.isBangumi==null?!1:p.meta.isBangumi,O=p.meta.isPgc==null?!1:p.meta.isPgc,M=i?"main.home-page-fanju.0.0":"main.home-page-movie.0.0",f=T(!1),b=T(!1),k=T(null),w=_e();ye({spm_id:M,pageName:"HomeBangumi"}),ge(i?".bangumi_tab":".pgc_tab"),ke(i?".bangumi_tab":".pgc_tab");const U=()=>w.flashPageCursors(),{data:c,run:K,loading:Q}=ae(async()=>{b.value=!1;try{const e=await q({is_refresh:0},i);return w.flashPageCursors(200),{...e,modules:e.modules.filter(s=>s.items.length)}}catch{return b.value=!0,{modules:[],has_next:!1,next_cursor:"0"}}},{initialData:{modules:[],has_next:!0,next_cursor:"0"}}),N=h(()=>{var e;return(e=c.value.modules.find(s=>s.style===F.double_feed))!=null?e:{}}),X=h(()=>N.value.title),Y=h(()=>{var e;return c?{...c.value,modules:(e=c.value.modules)==null?void 0:e.filter(s=>s.style!==F.double_feed)}:[]}),Z=e=>{var s;return((s=e[0])==null?void 0:s.mode)==="horizontal"?e.slice(0,5):e.slice(0,7)},{data:J,dataList:ee,loadMore:oe,loadingMore:z,reload:Ae,reset:A}=re(async e=>{var _,d,t;const s=!(e!=null&&e.dataList.length),m=c.value.next_cursor;try{const o=await q({cursor:s?m:Number((_=e==null?void 0:e.data)==null?void 0:_.next_cursor),is_refresh:1},i),l=(d=o.modules.find(C=>C.style===F.double_feed))!=null?d:{};return w.flashPageCursors(200),{list:(t=l.items)!=null?t:[],has_next:o.has_next,next_cursor:o.next_cursor}}catch{return{list:[],has_next:!1,next_cursor:"0"}}},{manual:!0,isNoMore:e=>e?f.value:!1});de(J,e=>{f.value=!e.has_next});const L=h(()=>{var e,s;return[...(e=N.value.items)!=null?e:[],...(s=ee.value)!=null?s:[],...z.value?Array.from(new Array(10),()=>({skeleton:!0,mode:"horizontal"})):[]]}),V=h(()=>Q.value||!c.value.modules.length&&!b.value),te=e=>{var _,d;const s=e.replace(/\?.*$/,""),m=((d=(_=e.match(/\?(.*)/))==null?void 0:_[1])!=null?d:"").split("&").reduce((t,o)=>{const[l,C]=o.split("=");return t[l]=C,t},{});m.allowGoBack="1",G.push({path:s,query:m})},se=()=>{V.value||z.value||oe()},W=e=>{!e.seasonId||fe({type:"ogv",seasonId:e.seasonId,fromSpmid:`${M}.pv`})},E=i?"HomeBangumiTab":"HomePgcTab",$=()=>{K(),f.value=!1,A()};return be(E,()=>$()),me(()=>{var e;p.name===E&&!((e=c.value.modules)!=null&&e.length)&&$()}),pe(()=>{f.value=!1,A()}),(e,s)=>{const m=R("WidgetArrow"),_=R("v-button"),d=R("Scroller");return a(),B(d,{ref_key:"bangumiRef",ref:k,class:P(["home_bangumi page_scroller pt_lg h_100 p_relative u_select_none",{bangumi_tab:r(i),pgc_tab:r(O)}]),onLoadMore:se,onScroll:U},{default:H(()=>[u("div",Te,[r(V)?(a(),B(ne,{key:0,showLoadingAnimation:""})):b.value?(a(),B(xe,{key:1})):(a(),n(v,{key:2},[(a(!0),n(v,null,x(r(Y).modules,t=>(a(),n("div",{class:"mb_sm",key:t.module_id},[u("div",Re,[u("span",null,S(t.title),1),(a(!0),n(v,null,x(t.headers,o=>(a(),n("div",{key:o.title+o.url,class:"flex_start"},[y(_,{class:"i_button_more p_relative","active-shrink":"",onClick:l=>te(o.url)},{default:H(()=>[u("span",Be,S(o.title),1),y(m,{class:"i_icon_more text2"}),Se]),_:2},1032,["onClick"])]))),128))]),u("div",Pe,[(a(!0),n(v,null,x(Z(t.items),(o,l)=>(a(),n("div",{key:o.epid,class:P(["mb_xxl",{col_3:o.mode==="horizontal",col_sm_1_5:o.mode==="horizontal",col_2:o.mode==="vertical",col_sm_1_7:o.mode==="vertical",to_hide_sm:o.mode==="horizontal"?l>3:l>5,to_hide_xl:o.mode==="horizontal"?l>4:l>6}])},[y(r(D),{onClickBangumi:W,info:o,mode:o.mode,appTheme:r(I).appTheme,rootRef:k.value,"disable-inline-player":"","disable-hover":"","scroll-wrap":".home_bangumi",cursorType:"pgcCard",isKeepCursor:!0,isFristCard:l===0},null,8,["info","mode","appTheme","rootRef","isFristCard"])],2))),128))])]))),128)),r(L).length?(a(),n("div",Fe,[u("div",Ie,[u("span",null,S(r(X)),1)]),u("div",Me,[(a(!0),n(v,null,x(r(L),(t,o)=>(a(),n("div",{key:t.cover,class:P(["mb_xxl",{col_3:t.mode==="horizontal",col_sm_1_5:t.mode==="horizontal",col_2:t.mode==="vertical",col_sm_1_7:t.mode==="vertical"}])},[y(r(D),{onClickBangumi:W,info:t,mode:t.mode,skeleton:t.skeleton,appTheme:r(I).appTheme,rootRef:k.value,"disable-inline-player":"","disable-hover":"",showLoadingAnimation:"",cursorType:"pgcCard","scroll-wrap":".home_bangumi",isFristCard:o===0},null,8,["info","mode","skeleton","appTheme","rootRef","isFristCard"])],2))),128))]),f.value?(a(),n("div",Ne,"\u5DF2\u7ECF\u5230\u5E95\u5566~")):j("",!0)])):j("",!0)],64))])]),_:1},8,["class"])}}});var Je=we(ze,[["__scopeId","data-v-bce9c5f4"]]);export{Je as default};

import{k as K,l as se,m as ae,M as O,A as k,Q as z,o as l,c as n,X as $,a as t,a0 as f,U as b,W as r,$ as E,aj as M,V as y,a2 as P,Z as I,aD as le,u as ie,al as oe,aV as q,Y as Q,x as D,y as Y,aM as Z,aF as ne,n as J,P as W,i as ce,aE as re,at as B,dW as de,aB as X,z as ue,g as _e,bH as me,R as ve,T as fe}from"./index.f074ecef.js";import{_ as ye,k as he}from"./App.c1beb0e9.js";import{_ as pe}from"./btn_devtools.06ffa497.js";import{ae as ge,s as Se}from"./MoreFeedback.eac5fca1.js";import{U as xe,b as Le,z as ke,C as be,B as $e,D as Be,E as we}from"./index.194c39d1.js";import{_ as Fe}from"./LoginPanel.33272c26.js";import{al as Ce,ai as Re,am as Ae}from"./index.14a3ec94.js";const Mt=()=>{const e=K(!0);return se(()=>{e.value=!0}),ae(()=>{e.value=!1}),e};const Ee={class:"flex_col_center"},Ie=t("div",{class:"dynamic_live_item--avatar flex_center bd_none"},[t("div",{class:"live-item-avatar skeleton round"})],-1),De={key:0,class:"live-item-name b_text text3 fs_6 flex_center mt_xs mb_0"},Ke=t("div",{class:"skeleton w_75"},"\xA0",-1),Me=[Ke],Pe={key:0,class:"ml_sm ov_hidden w_100"},Te=t("h4",{class:"b_text text1 font_regular text_ellipsis my_0"},[t("div",{class:"skeleton w_50 thick"},"\xA0")],-1),Ne=t("div",{class:"live-item-room-tt b_text text3 fs_6 text_ellipsis mb_0 w_100"},[t("div",{class:"skeleton item-sub"},"\xA0")],-1),We=[Te,Ne],ze={class:"flex_col_center p_relative"},Oe={class:"dynamic_live_item--avatar flex_center"},Ve={class:"live-item-avatar"},je={key:0,class:"live-item-name b_text text3 fs_6 text_center text_ellipsis mt_xs mb_0"},Ge={key:0,class:"ml_sm ov_hidden"},Ue=["title"],He=["title"],qe=t("span",{class:"gamepad-cursor","data-tp":"dynLiveUp","data-scroll":"y","data-bf":"60","data-sh":"300","data-wp":".dynamic_live--ups"},null,-1),Qe=t("div",{class:"p_cover"},null,-1),Xe={class:"live-item-tooltip text1 fs_5 p_relative pe_none"},Ye=t("div",{class:"tooltip-arrow p_center_y"},null,-1),Ze=O({__name:"LiveListItem",props:{isSmall:{type:Boolean,default:!1},liveItem:{type:Object,default:()=>({})},liveLoading:{type:Boolean,default:!1}},setup(e){const v=e,s=k(()=>{var i;return((i=v.liveItem.user)==null?void 0:i.name)||"--"}),d=k(()=>{var i;return(i=v.liveItem.user)==null?void 0:i.face}),x=k(()=>{var i,g;return((g=(i=v.liveItem.room)==null?void 0:i.show)==null?void 0:g.title)||"--"}),h=k(()=>{var i;return(i=v.liveItem.room)==null?void 0:i.room_id}),p=()=>{h.value&&le(h.value)};return(i,g)=>{const c=z("v-dropdown");return l(),n("div",{class:I(["dynamic_live_item flex_start p_relative",{justify_center:e.isSmall}]),onClick:p},[e.liveLoading?(l(),n($,{key:0},[t("div",Ee,[Ie,e.isSmall?(l(),n("div",De,Me)):f("",!0)]),e.isSmall?f("",!0):(l(),n("div",Pe,We))],64)):(l(),n($,{key:1},[t("div",ze,[t("div",Oe,[t("div",Ve,[b(xe,{class:"online_border_pink",info:{face:r(d)},isMini:"",isShowLive:"",isOnLine:""},null,8,["info"])])]),e.isSmall?(l(),n("p",je,E(r(s)),1)):f("",!0)]),e.isSmall?f("",!0):(l(),n("div",Ge,[t("h4",{class:"b_text text1 font_regular text_ellipsis my_xs",title:r(s)},E(r(s)),9,Ue),t("p",{class:"live-item-room-tt b_text text3 fs_6 text_ellipsis mb_0",title:r(x)},E(r(x)),9,He)])),qe,e.isSmall?(l(),M(c,{key:1,trigger:"hover",classname:"dynamic_live_item--tooltip",placement:"left",offset:20,skidding:-10,wrapperStyle:{zIndex:9}},{content:y(()=>[t("div",Xe,[P(E(r(s))+" ",1),Ye])]),default:y(()=>[Qe]),_:1})):f("",!0)],64))],2)}}});const Je={class:"dynamic_live--inner bd_radius"},et={class:"px_sm pt_sm"},tt={key:0,class:"dynamic_live--item mt_0 b_text text1 text_center"},st=t("div",{class:"skeleton thick"},"\xA0",-1),at=[st],lt={key:1,class:"dynamic_live--item mt_0 b_text text1 p_relative"},it=t("div",{class:"skeleton thick live-long-tt"},"\xA0",-1),ot=[it],nt=P(" \u5173\u6CE8\u76F4\u64AD "),ct=t("div",{class:"p_cover"},null,-1),rt=t("div",{class:"live-item-tooltip text1 fs_5 p_relative pe_none"},[P(" \u67E5\u770B\u5168\u90E8\u5173\u6CE8\u76F4\u64AD\u95F4 "),t("div",{class:"tooltip-arrow p_center_y"})],-1),dt=t("span",{class:"gamepad-cursor"},null,-1),ut=P(" \u5173\u6CE8\u76F4\u64AD "),_t={class:"fs_4 text3 fw_400"},mt={class:"text3 fs_5 fw_400 p_center_y r_xs flex_end"},vt=t("span",null,"\u66F4\u591A",-1),ft=t("span",{class:"gamepad-cursor"},null,-1),yt=O({__name:"LiveList",props:{isSmall:{type:Boolean,default:!1},liveList:{type:Object,default:()=>({})},liveLoading:{type:Boolean,default:!1}},setup(e){const v=ie(),s=oe(),d=k(()=>v.name==="Dynamic"),x=q(),h=()=>x.flashPageCursors(),p=()=>{s.push({name:"HomeLive",query:{allowGoBack:1}})};return(i,g)=>{const c=z("v-dropdown");return l(),n("div",{class:I(["dynamic_live pl_sm p_sticky t_sm u_select_none",{"dynamic_live--small":e.isSmall,"dynamic_live--loading":e.liveLoading}])},[t("div",Je,[t("div",et,[e.liveLoading?(l(),n($,{key:0},[e.isSmall?(l(),n("h4",tt,at)):(l(),n("h3",lt,ot))],64)):(l(),n($,{key:1},[e.isSmall?(l(),n("h4",{key:0,class:"dynamic_live--item mt_0 b_text text1 text_center px_0 p_relative",onClick:p},[nt,e.isSmall&&r(d)?(l(),M(c,{key:0,trigger:"hover",classname:"dynamic_live_item--tooltip",placement:"left",wrapperStyle:{zIndex:9}},{content:y(()=>[rt]),default:y(()=>[ct]),_:1})):f("",!0),dt])):(l(),n("h3",{key:1,class:"dynamic_live--item mt_0 b_text text1 p_relative",title:"\u67E5\u770B\u5168\u90E8\u5173\u6CE8\u76F4\u64AD\u95F4",onClick:p},[ut,t("span",_t,"\xB7"+E(e.liveList.total),1),t("span",mt,[vt,b(r(Le),{class:"ico-right"})]),ft]))],64))]),t("div",{class:I(["dynamic_live--ups px_sm pb_sm ov_overlay_y auto_hide_scrollbar scrollbar_sm",{"flex_col items_start":e.isSmall}]),onScroll:h},[(l(!0),n($,null,Q(e.liveList.list||[],u=>(l(),n("div",{class:I(["dynamic_live--item",{"live-item-sm":e.isSmall}]),key:u.uid},[b(Ze,{liveItem:u,liveLoading:e.liveLoading,isSmall:e.isSmall},null,8,["liveItem","liveLoading","isSmall"])],2))),128))],34)])],2)}}});const ht=t("div",{class:"feed_fragment--anchor"},null,-1),pt={class:"feed_fragment--inner p_relative"},gt=t("div",{class:"feed_fragment--loading"},null,-1),St=t("div",{class:"feed_fragment--empty"},[t("img",{src:ye}),t("p",null,"\u6CA1\u6709\u4F60\u60F3\u8981\u7684\u5185\u5BB9~")],-1),xt={class:"feed_fragment--error"},Lt=t("img",{src:pe},null,-1),kt=t("p",null,"\u5185\u5BB9\u4E0D\u89C1\u4E86\uFF0C\u8BF7\u60A8\u518D\u5237\u65B0\u8BD5\u8BD5",-1),bt=P("\u518D\u8BD5\u4E00\u6B21"),$t=t("div",{class:"feed_fragment--anchor"},null,-1),Bt=O({__name:"FeedFragmentAll",props:{active:{type:Boolean,default:!0},status:{type:String,default:"initial"},list:{type:Array,default:()=>[]},feedKey:{type:String,default:"id"},itemKey:{type:String,default:"id"},useItemWrapper:{type:Boolean,default:!1},disableScroll:{type:Boolean,default:!1},liveList:{type:Object,default:()=>({})},liveLoading:{type:Boolean,default:!1},isSpace:{type:Boolean,default:!1}},emits:["load-more","refresh"],setup(e,{expose:v,emit:s}){const d=e,{userInfo:x}=D(Y()),{isLiveListSmall:h}=D(Z()),p=k(()=>{var o;return((o=d.liveList)==null?void 0:o.total)&&x.value.isLogin}),i=q(),g=(o,S)=>o[d.itemKey]||S,{routePositions:c}=D(ne()),u=K(),V=o=>{d.feedKey&&(c.value[d.feedKey]=o.target.scrollTop),i.flashPageCursors()},C=K(null);J(()=>{d.isSpace||ge(C.value,o=>{const S=o[0],{width:w}=S.contentRect;h.value=!!w&&w<840})}),W(()=>d.active,o=>{o&&u.value&&(setTimeout(()=>{const S=c.value[d.feedKey];ce(S)&&(u.value.$el.scrollTop=S)}),d.feedKey&&re.emit("resetRoutePosition",d.feedKey))},{immediate:!0});function j(){!d.list.length&&!d.useItemWrapper||s("load-more")}function G(){s("refresh")}return v({rootRef:u}),(o,S)=>{const w=z("VButton"),_=z("Scroller");return l(),M(_,{class:"dyn_all_scroll feed_fragment page_scroller",ref_key:"pageScrollRef",ref:u,disabled:e.disableScroll,active:e.active,onLoadMore:j,onScrollPassive:V},{default:y(()=>[t("div",{class:"feed_fragment--wrapper flex_center w_100",ref_key:"dynamicWrapper",ref:C},[ht,t("div",pt,[B(o.$slots,"top"),e.list.length?f("",!0):(l(),n($,{key:0},[e.status==="loading"?B(o.$slots,"loading",{key:0},()=>[gt]):e.status==="empty"?B(o.$slots,"empty",{key:1},()=>[St]):e.status==="error"?B(o.$slots,"error",{key:2},()=>[t("div",xt,[Lt,kt,b(w,{type:"pink",size:"large",onClick:G},{default:y(()=>[bt]),_:1})])]):f("",!0)],64)),e.useItemWrapper?B(o.$slots,"itemWrapper",{key:1}):(l(!0),n($,{key:2},Q(e.list,(T,F)=>B(o.$slots,"item",{key:g(T,F),data:T,index:F})),128)),B(o.$slots,"bottom")]),r(p)?(l(),M(yt,{key:0,liveList:e.liveList,liveLoading:e.liveLoading,isSmall:r(h)},null,8,["liveList","liveLoading","isSmall"])):f("",!0),$t],512)]),_:3},8,["disabled","active"])}}});const wt={class:"feed_fragment--loading"},Ft={key:0,class:"dynamic_feed_fragment--login flex_col_center bd_radius"},Pt=O({__name:"AllFeedFragment",props:{pageKey:{type:String,default:""},classKey:{type:String,default:""},active:{type:Boolean,default:!1},hostMid:{type:[Number,String],default:0},scene:{type:String,default:"GENERAL"},disableScroll:{type:Boolean,default:!1},liveList:{type:Object,default:()=>({})},liveLoading:{type:Boolean,default:!1}},setup(e,{expose:v}){const s=e,d="dynamic_feed_fragment",x=k(()=>({[d]:!0,[s.classKey]:s.classKey,"invisible p_absolute t_0 z_index_n1":!s.active})),h=k(()=>s.pageKey&&s.classKey?`${s.pageKey}-${s.classKey}`:""),p=K(null),i=K(null),g="id_str",{status:c,list:u,reset:V}=ke([]),{userInfo:C}=D(Y()),{updateBaseLine:j}=D(Z()),G=q(),{changeScroller:o,resetScroller:S}=he("",{watchParam:()=>s.active}),{initialCheck:w}=de(i,()=>s.active,1e3);X("scrollContainerRef",i),X("galleryFixed",s.disableScroll);const _=ue({current:"",offset:"",page:0}),T=()=>{V(),_.page=0,_.current="",_.offset=""};W(()=>_.current,a=>{s.scene==="GENERAL"&&!s.hostMid&&(j.value=a)});const F=async()=>{var a;if(c.value!=="empty"&&c.value!=="noMore"&&c.value!=="loading"){c.value="loading";try{const{items:m,has_more:L,offset:A,update_baseline:N}=await Ae({current:_.current,offset:_.offset,page:++_.page,hostMid:s.hostMid,scene:s.scene,isLogin:((a=C.value)==null?void 0:a.isLogin)||!1});m!=null&&m.length&&u.value.push(...m),_.page===1&&N&&(_.current=String(N)),_.offset=String(A),u.value.length?L?c.value="loaded":c.value="noMore":c.value="empty",G.flashPageCursors(200)}catch{c.value="error"}}},ee=a=>{_.current&&(_.current=a[g]),u.value.unshift(a)},te=async(a=!0)=>new Promise(m=>{Se({element:i.value,speed:3,animation:a,onDone:m})});let U=s.hostMid;const R=async(a=!0)=>{U=s.hostMid,await te(a),T(),await F(),w()};W(()=>s.active,a=>{!a||c.value!=="initial"&&U===s.hostMid||R()}),W(()=>s.hostMid,()=>{!s.active||U===s.hostMid||R(!1)});const H=(a,m)=>{if(a){u.value=u.value.filter(a);return}u.value.splice(m,1)};return _e.on("removeDynamic",({id:a,uid:m})=>{if(a){const L=u.value.findIndex(A=>A.id_str===a);if(L>-1){H(null,L);return}}m&&H(we(m),-1)}),J(()=>{let a=p.value.rootRef.elRef;s.disableScroll&&(a=Ce(a)),i.value=a,o(Re(...Array.from(a.classList))),s.active&&S()}),v({refresh:R,unshift:ee}),(a,m)=>(l(),M(Bt,{ref_key:"feedFragmentRef",ref:p,class:I(r(x)),list:r(u),status:r(c),"item-key":g,"disable-scroll":e.disableScroll,active:e.active,"feed-key":r(h),liveList:e.liveList,liveLoading:e.liveLoading,isSpace:e.scene==="SPACE",onLoadMore:F,onRefresh:R},me({loading:y(()=>[t("div",wt,[(l(),n($,null,Q(5,L=>b(Be,{key:L})),64))])]),top:y(()=>[e.scene==="GENERAL"&&!e.hostMid&&!r(C).isLogin?(l(),n("div",Ft,[b(Fe,{desc:"\u767B\u5F55\u8D26\u53F7\uFF0C\u67E5\u770B\u4F60\u5173\u6CE8\u7684UP\u4E3B\u5185\u5BB9"})])):f("",!0)]),_:2},[e.active?{name:"item",fn:y(({data:L,index:A})=>[b(r(be),{data:L,onRemove:N=>H(N,A),onRefresh:R},null,8,["data","onRemove"])])}:void 0,e.disableScroll?{name:"bottom",fn:y(()=>[ve(b($e,{class:"p_relative",onTrigger:F},null,512),[[fe,r(c)==="loaded"]])])}:void 0]),1032,["class","list","status","disable-scroll","active","feed-key","liveList","liveLoading","isSpace"]))}});export{Pt as _,Mt as u};

import{I as de,B as ue,ag as ce,ah as ve}from"./MoreFeedback.eac5fca1.js";import{_ as _e}from"./index.14a3ec94.js";import{M as ee,A as ie,o as r,c as m,U as p,V as x,W as o,x as Z,y as fe,fg as ne,k as d,be as pe,P as W,w as me,Q as $,a as c,$ as G,X as H,Y as re,_ as Y,ae as Fe,aj as P,a2 as N,cz as L,t as J,aV as he,a0 as U,dE as ge,Z as ye,S as le,g as oe}from"./index.f074ecef.js";import{z as Ce,H as Se,_ as De,B as be}from"./index.194c39d1.js";import{u as ke,m as xe}from"./App.c1beb0e9.js";import{h as Ee,p as we,i as Be,j as Ve,k as $e,l as Ae}from"./mine.30873ffc.js";import{S as Te}from"./SearchResultCount.6c930e27.js";const Me={class:"favorite_video_card"},Ie=ee({__name:"FavoriteVideoCard",props:{info:{type:Object,default:()=>({})},isDft:Boolean,scrollWrap:{type:String,default:".app_mine--content"}},emits:["remove","selectDir"],setup(h,{emit:A}){const R=h,u=ie(()=>R.isDft?"pc_app_mine_fav_default":"pc_app_mine_fav_folder"),z=[{type:"SELECT_DIR",label:"\u9009\u62E9\u6536\u85CF\u5939"},{type:"REMOVE",label:"\u53D6\u6D88\u6536\u85CF"}];function s(a){switch(a.type){case"REMOVE":A("remove");break;case"SELECT_DIR":A("selectDir");break}}return(a,T)=>(r(),m("div",Me,[p(o(ue),{info:h.info,"img-lazy":"eager","is-rcmd":"","disable-frame":"","disable-scale":"",iid:o(u),scrollWrap:h.scrollWrap},{more:x(()=>[p(_e,{class:"favorite_video_card--more",items:z,onSelect:s},{default:x(()=>[p(o(de),{class:"favorite_video_card--more--btn"})]),_:1})]),_:1},8,["info","iid","scrollWrap"])]))}}),Le={class:"select_favdir"},Pe={class:"b_text text2 mt_sm text_center text_ellipsis_2l"},We=N(" \u89C6\u9891\uFF1A"),Ne=["title"],Re={class:"modal_select_dir text_left mt_md"},ze={class:"b_text text3 ml_lg"},Ue={class:"mt_xl text_center"},je={class:"select_dir_add--btns p_center_y r_sm"},qe=["onClick"],Oe=N(" + \u521B\u5EFA\u6536\u85CF\u5939 "),Ge=N(" \u4FDD\u5B58 "),He=ee({__name:"SelectFavoriteFolder",emits:["favSuccess"],setup(h,{expose:A,emit:R}){const{userInfo:u}=Z(fe()),{isFavFolderChanged:z}=Z(ne()),s=d(),a=d([]),T=d(!1),C=d(!1),k=d([]),M=d([]),v=d(""),S=d(!1),D=d(!1),E=d(null),g=d(null);let w=[],B=[];A({showFavDialog:e=>{s.value=e,a.value=[],C.value=!1,T.value=!0,S.value=!0,Ee(e.id,u.value.mid,e.type).then(l=>{a.value=l.list||[],a.value.forEach(_=>{_.isPrivate=j(_.attr,0),_.isSelected=!!_.fav_state}),w=a.value.filter(_=>_.isSelected).map(_=>_.id),T.value=!1}).catch(()=>{L({el:g.value,msg:"\u83B7\u53D6\u6536\u85CF\u5939\u5931\u8D25",cd:1e3,type:"error"}),C.value=!0,T.value=!1})}});const F=pe(()=>{B=a.value.filter(e=>e.isSelected).map(e=>e.id),k.value=B.filter(e=>!w.includes(e)),M.value=w.filter(e=>!B.includes(e))},200,!1),K=()=>{v.value="",D.value=!0,setTimeout(()=>{var e;(e=E.value.querySelector(".select_dir_add--ipt"))==null||e.focus()})},b=()=>{!v.value||(D.value=!1,we({title:v.value}).then(e=>{if(e.code!==0){L({el:g.value,msg:e.message||"\u521B\u5EFA\u6536\u85CF\u5939\u5931\u8D25",cd:1e3,type:"error"});return}const l=e.data;l.isPrivate=j(l.attr,0),l.isSelected=!0,a.value.push(l),F(),L({el:g.value,msg:"\u6536\u85CF\u5939\u521B\u5EFA\u6210\u529F\uFF01",cd:1e3,type:"info"})}).catch(e=>{console.error(e),L({el:g.value,msg:"\u521B\u5EFA\u6536\u85CF\u5939\u5931\u8D25",cd:1e3,type:"error"})}))},Q=()=>{S.value=!1;const e={rid:s.value.id,add_media_ids:k.value.join(","),del_media_ids:M.value.join(","),type:s.value.type||2};Be(e).then(l=>{if(l.code!==0){L({el:g.value,msg:l.message||"\u8BBE\u7F6E\u6536\u85CF\u5939\u5931\u8D25\uFF01",cd:1e3,type:"error"});return}R("favSuccess"),z.value=!0,J({content:"\u8BBE\u7F6E\u6536\u85CF\u5939\u6210\u529F\uFF01"})}).catch(()=>{L({el:g.value,msg:"\u8BBE\u7F6E\u6536\u85CF\u5939\u5931\u8D25\uFF01",cd:1e3,type:"error"})})};function j(e,l){const _=+e.toString(2);return parseInt(("000000"+_).substr(-7).split("").reverse().join("").charAt(l))}return W(v,e=>{e.length>20&&me(()=>v.value=e.substr(0,20))}),W(S,e=>{e||(D.value=!1)}),(e,l)=>{const _=$("v-checkbox"),X=$("v-input"),q=$("v-button"),O=$("v-dialog");return r(),m("div",Le,[p(O,{visible:S.value,"onUpdate:visible":l[2]||(l[2]=t=>S.value=t),width:380,"class-name":"i_dialog py_lg",title:"\u9009\u62E9\u6536\u85CF\u5939",center:!0,"is-show-default-footer":!1,onCancel:l[3]||(l[3]=t=>S.value=!1)},{default:x(()=>{var t,i;return[c("div",{class:"content-wrapper",ref_key:"contentWrap",ref:g},[c("p",Pe,[We,c("strong",{title:(t=s.value.info)==null?void 0:t.title},G((i=s.value.info)==null?void 0:i.title),9,Ne)]),c("div",Re,[(r(!0),m(H,null,re(a.value,f=>(r(),m("div",{class:"modal_select_dir--item",key:f.id},[p(_,{theme:"pink",modelValue:f.isSelected,"onUpdate:modelValue":V=>f.isSelected=V,label:f.title,onChange:o(F)},null,8,["modelValue","onUpdate:modelValue","label","onChange"]),c("p",ze,G(f.isPrivate?"\u79C1\u5BC6":"\u516C\u5F00")+"."+G(f.media_count)+"\u4E2A\u5185\u5BB9",1)]))),128))]),c("div",Ue,[D.value?(r(),m("div",{key:0,ref_key:"newFolderInput",ref:E,class:"select_dir_add p_relative"},[p(X,{class:"select_dir_add--ipt",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=f=>v.value=f),placeholder:"\u6700\u591A\u53EF\u8F93\u516520\u4E2A\u5B57"},null,8,["modelValue"]),c("div",je,[c("span",{class:"mr_xs",onClick:Y(b,["stop"]),style:Fe(v.value?"":"opacity:.6;cursor:not-allowed;")}," + ",12,qe),c("span",{onClick:l[1]||(l[1]=Y(f=>D.value=!1,["stop"]))},"x")])],512)):(r(),P(q,{key:1,class:"text_left",block:"",onClick:Y(K,["stop"])},{default:x(()=>[Oe]),_:1},8,["onClick"])),p(q,{class:"mt_sm",type:"pink",block:"",disabled:!k.value.length&&!M.value.length,onClick:Q},{default:x(()=>[Ge]),_:1},8,["disabled"])])],512)]}),_:1},8,["visible"])])}}});const Ke={key:1,class:"search-result-count"},Qe={key:0,class:"favorite_videos--loading mt_sm"},Xe={class:"row gutter_md"},Ye={key:0,class:"flex_center mt_x50 mb_x50"},Ze={class:"content-wrapper"},Je=c("h4",{class:"b_text text1 text_center mt_md"},"\u786E\u5B9A\u53D6\u6D88\u6536\u85CF\u9009\u4E2D\u7684\u89C6\u9891\u5417\uFF1F",-1),et={class:"b_text text2 mt_sm text_center text_ellipsis_2l"},tt=N(" \u89C6\u9891\uFF1A"),at=["title"],st={class:"mt_xl text_center dialog_btns"},lt=N("\u624B\u6ED1\u4E86"),ot=N("\u53D6\u6D88\u6536\u85CF"),ft=ee({__name:"FavoriteVideos",props:{isActive:{type:Boolean,default:!1},scrollWrap:{type:String,default:".app_mine--content"},owner:{type:Boolean,default:!1},type:{type:String,default:"folder"},id:{type:Number,default:0},isDefault:{type:Boolean,default:!1},isSearchPage:{type:Boolean,default:!1},searchMode:{type:String,default:"currentFolder"}},emits:["update-info"],setup(h,{expose:A,emit:R}){const u=h,z=he(),{status:s,list:a,reset:T}=Ce([]),C=d(!1),k=d(),M=d(null),v=d(0),S=d(20),D=ie(()=>u.owner&&u.type==="folder"),{isOnLoadingFolders:E,isFoldersLoadError:g,dftFavVideosPageNum:w}=Z(ne()),B=d(""),te={currentFolder:0,allFolder:1},F=d(1);u.isDefault&&(F.value=w.value),W(a,()=>z.flashPageCursors(200),{deep:!0}),ke("Favorite",()=>b());const K=()=>{v.value=0,F.value=u.isDefault?w.value:1,T(),b()},b=async()=>{var i,f,V;if(s.value==="loading"||!D.value&&s.value==="noMore"||!u.id)return;s.value="loading";let t;try{if(u.type==="folder"){const y={media_id:u.id,pn:F.value};B.value&&(y.keyword=B.value,y.type=te[u.searchMode]),t=await Ve(y),v.value=((i=t.info)==null?void 0:i.media_count)||0,(f=t.medias)!=null&&f.length?a.value=[...t.medias.map((n,I)=>({id:n.id,info:ce(n,I,`${le.mineFavorite}.pv`),type:n.type}))]:a.value=[]}else t=await $e(u.id,F.value),(V=t.medias)!=null&&V.length?a.value=[...a.value,...t.medias.map((y,n)=>({id:y.id,type:y.type,info:ve(y,n,`${le.mineFavorite}.pv`)}))]:a.value=[];t.info&&R("update-info",t.info),a.value.length?t.has_more?s.value="loaded":s.value="noMore":s.value="empty"}catch{s.value="error",a.value=[]}},Q=()=>{a.value.length!==0&&s.value!=="noMore"&&(++F.value,b())},j=()=>{setTimeout(()=>{oe.emit("requestScrollToTop"),b()},100)},e=t=>{var i;(i=M.value)==null||i.showFavDialog(t)},l=()=>{setTimeout(()=>b(),500)},_=t=>{k.value=t,C.value=!0},X=async()=>{C.value=!1;try{const{id:t,type:i}=k.value;await Ae(u.id,`${t}:${i}`),setTimeout(()=>b(),500),J({content:"\u53D6\u6D88\u6536\u85CF\u6210\u529F\uFF01"})}catch{J({content:"\u53D6\u6D88\u6536\u85CF\u5931\u8D25"})}},q=async t=>{B.value=t,oe.emit("requestScrollToTop"),F.value=1,b()};W(F,t=>{u.isDefault&&!u.isSearchPage&&(w.value=t)});let O;return W([u,E],t=>{clearTimeout(O),!u.id&&!t&&(O=setTimeout(()=>s.value="error",1e3))}),W(()=>u.id,t=>{u.isSearchPage||K()},{immediate:!0}),A({doSearch:q}),(t,i)=>{const f=$("v-pagenation"),V=$("v-button"),y=$("v-dialog");return r(),m("div",{class:ye(["favorite_videos i_wrapper p_relative pt_sm",{h_100:!o(a).length}])},[!o(a).length&&(o(s)==="error"&&!o(E)||o(g))?(r(),P(Se,{key:0,class:"mt_sm",showRefresh:!1,text:"\u54CE\u5440\uFF01\u597D\u50CF\u52A0\u8F7D\u5931\u8D25\u4E86>.<"})):U("",!0),h.isSearchPage?(r(),m("div",Ke,[p(Te,{count:v.value,unit:"\u89C6\u9891"},null,8,["count"])])):U("",!0),!o(a).length&&(o(s)!=="error"||o(E))&&!o(g)?(r(),m(H,{key:2},[o(s)==="loading"||o(s)==="initial"||o(E)?(r(),m("div",Qe,[p(De,{itemNum:20,showAvatar:!1,showLoadingAnimation:""})])):o(s)==="empty"?(r(),P(xe,{key:1,"is-small":""})):U("",!0)],64)):h.isActive?(r(),m(H,{key:3},[c("div",Xe,[(r(!0),m(H,null,re(o(a),n=>(r(),m("div",{class:"favorite_videos--card col_3 col_sm_1_5 mb_xxl",key:n.id},[o(D)?(r(),P(Ie,{key:0,info:n.info,"is-dft":h.isDefault,scrollWrap:h.scrollWrap,onRemove:I=>_(n),onSelectDir:I=>e(n)},null,8,["info","is-dft","scrollWrap","onRemove","onSelectDir"])):(r(),P(o(ue),{key:1,info:n.info,"is-rcmd":"","img-lazy":"eager","disable-frame":"","disable-scale":"",iid:"pc_app_mine_fav_seasons",scrollWrap:h.scrollWrap},null,8,["info","scrollWrap"]))]))),128))]),v.value>S.value?(r(),m("div",Ye,[p(f,{theme:"pink",pageNum:F.value,"onUpdate:pageNum":i[0]||(i[0]=n=>F.value=n),"page-size":S.value,total:v.value,"show-extend-btn":!1,"show-jump-info":!1,"btn-extra-render":o(ge),onPageChange:j},null,8,["pageNum","page-size","total","btn-extra-render"])])):o(D)?U("",!0):(r(),P(be,{key:1,onTrigger:Q}))],64)):U("",!0),p(He,{ref_key:"selectFavFolder",ref:M,onFavSuccess:l},null,512),p(y,{visible:C.value,"onUpdate:visible":i[2]||(i[2]=n=>C.value=n),width:320,"class-name":"i_dialog py_lg",onCancel:i[3]||(i[3]=n=>C.value=!1),"is-show-default-footer":!1},{default:x(()=>{var n,I,ae,se;return[c("div",Ze,[Je,c("p",et,[tt,c("strong",{title:(I=(n=k.value)==null?void 0:n.info)==null?void 0:I.title},G((se=(ae=k.value)==null?void 0:ae.info)==null?void 0:se.title),9,at)]),c("div",st,[p(V,{class:"mr_sm",onClick:i[1]||(i[1]=ut=>C.value=!1)},{default:x(()=>[lt]),_:1}),p(V,{type:"danger",onClick:X},{default:x(()=>[ot]),_:1})])])]}),_:1},8,["visible"])],2)}}});export{ft as _};

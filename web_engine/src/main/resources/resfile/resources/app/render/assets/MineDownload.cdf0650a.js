import{M as Be,y as Le,x as ie,fh as Te,u as Pe,al as Ge,aV as $e,A as ue,k as u,aN as F,aJ as m,P as Me,Q as U,o as i,c,a as s,X as A,Y as j,Z as b,W as w,$ as y,a0 as _,U as a,V as n,aj as I,a2 as p,S as Ne,aa as Ve,C as de,bd as qe,a6 as Oe,a7 as Re,cS as Ue,c_ as je}from"./index.f074ecef.js";import{a9 as ze}from"./index.14a3ec94.js";import{P as He}from"./playAll.e1238004.js";import{N as X}from"./Empty.c40df274.js";import{D as Z,g as We,a as Ye}from"./DownloadItem.42a87825.js";import{_ as Je}from"./FolderMediaCard.1999fd20.js";import{S as Ke}from"./SearchResultCount.6c930e27.js";import{D as re}from"./vuedraggable.umd.b672350b.js";import{u as Qe}from"./index.194c39d1.js";import{_ as Xe}from"./plugin-vue_export-helper.21dcd24c.js";import"./MoreFeedback.eac5fca1.js";import"./style.2070e26d.js";import"./ico_max_exit.f7f1ea61.js";import"./App.c1beb0e9.js";import"./btn_devtools.06ffa497.js";import"./index.733b73c2.js";import"./modulepreload-polyfill.b7f2da20.js";import"./isUdf.1a76b9f4.js";import"./ico_pin.a6faa7a5.js";/* empty css               */import"./theme-map.a3b52bba.js";const h=$=>(Oe("data-v-17bf96ba"),$=$(),Re(),$),Ze={class:"mine-download"},et={key:0,class:"md-header i_wrapper"},tt={class:"dl-tabs"},ot=["onClick"],st=["textContent"],lt=["textContent"],at=h(()=>s("span",{class:"gamepad-cursor","data-tp":"subTab"},null,-1)),nt={class:"options"},it=p("\u89C6\u9891\u6392\u5E8F"),ut=p(" \u66F4\u591A\u64CD\u4F5C "),dt={class:"dropdown_select--content group-more-options"},rt=p(" \u5168\u90E8\u5220\u9664 "),ct=h(()=>s("span",null,"\u64AD\u653E\u5168\u90E8",-1)),_t=h(()=>s("span",{class:"gamepad-cursor"},null,-1)),pt=p(" \u4EFB\u52A1\u6392\u5E8F "),vt=p(" \u540C\u65F6\u4E0B\u8F7D\u4E2A\u6570"),mt={class:"brand_pink"},ft={class:"dropdown_select--content task-num-options"},gt=h(()=>s("div",{class:"dropdown_select--option-title"},"1\u4E2A",-1)),wt=[gt],ht=h(()=>s("div",{class:"dropdown_select--option-title"},[p("2\u4E2A"),s("span",{class:"brand_pink"},"\uFF08\u5927\u4F1A\u5458\u4E13\u4EAB\uFF09")],-1)),bt=[ht],kt=h(()=>s("div",{class:"dropdown_select--option-title"},[p("3\u4E2A"),s("span",{class:"brand_pink"},"\uFF08\u5927\u4F1A\u5458\u4E13\u4EAB\uFF09")],-1)),Ct=[kt],yt=p(" \u66F4\u591A\u64CD\u4F5C "),Dt={class:"dropdown_select--content task-more-options"},xt=h(()=>s("div",{class:"dropdown_select--option-title"},"\u5168\u90E8\u5F00\u59CB",-1)),Et=[xt],St=h(()=>s("div",{class:"dropdown_select--option-title"},"\u5168\u90E8\u6682\u505C",-1)),Ft=[St],At=h(()=>s("div",{class:"dropdown_select--option-title stress_red"},"\u5168\u90E8\u5220\u9664",-1)),It=[At],Bt={key:1,class:"row gutter_md"},Lt={key:2,class:"tab-content downloading i_wrapper"},Tt={key:1,class:"row gutter_md"},Pt={key:3,class:"tab-content downloaded i_wrapper"},Gt={key:1,class:"row gutter_md"},$t={ref:"bottomRef",class:"bottom-load"},Mt={class:"content-wrapper"},Nt={class:"b_text text_center text1 mt_md"},Vt={key:0,class:"b_text text_center text2 mt_md"},qt={class:"mt_xl text_center dialog_btns"},Ot=p("\u53D6 \u6D88"),Rt=h(()=>s("p",{class:"b_text text2 mt_nsm mb_md text_center text_ellipsis"},"\u62D6\u52A8\u8FDB\u884C\u6392\u5E8F",-1)),Ut={class:"content-wrapper"},jt={class:"download_group--item p_relative"},zt={class:"task-img p_relative"},Ht=["src"],Wt={class:"download_group--item-tt p_center_x b_n2 fs_6 text_ellipsis"},Yt={class:"mt_xl text_center dialog_btns"},Jt=p("\u53D6\u6D88"),Kt=p("\u786E\u5B9A"),Qt=h(()=>s("p",{class:"b_text text2 mt_nsm mb_md text_center text_ellipsis"},"\u62D6\u52A8\u8FDB\u884C\u6392\u5E8F",-1)),Xt={class:"content-wrapper"},Zt={class:"download_group--item p_relative"},eo={class:"download_group--item-tt p_center_x b_n2 fs_6 text_ellipsis"},to={class:"mt_xl text_center dialog_btns"},oo=p("\u53D6\u6D88"),so=p("\u786E\u5B9A"),lo=Be({__name:"MineDownload",setup($,{expose:ce}){Qe({spm_id:Ne.mineDownload,isKeepAlive:!1,pageName:"MineDownload"});const _e=Le(),{userInfo:M}=ie(_e),N=Te(),{activeTab:V}=ie(N),B=Pe(),pe=Ge(),ee=$e(),te=[{key:"downloaded",name:"\u5DF2\u7F13\u5B58\u89C6\u9891"},{key:"downloading",name:"\u6B63\u5728\u7F13\u5B58"}],oe=ue(()=>te.find(t=>t.key===V.value)),ve=t=>{N.setActiveTab(t),pe.replace({name:"MineDownload",query:{tab:t==="downloading"?2:1}})};if(B.query.tab){const t={1:"downloaded",2:"downloading"};N.setActiveTab(t[Number(B.query.tab)]||1)}const z=u(!1),H=u(!1),W=u(!1),v=u([]),r=u([]),se=ue(()=>r.value.length);let f=!1;const x=u(!1),L=u([]);ce({doSearch:async(t="")=>{const e=t.trim();e?(x.value=!0,m("download/getAllVideoList",{search:e}).then(({data:l})=>{L.value=l})):x.value=!1}});const me=()=>{const t=We(v.value[0]),e=t==null?void 0:t.itemId;!e||Ve({type:"ugc",fromSpmid:"main.mine-cache.0.0.pv",mediaList:{bizType:-1,bizId:e,bizTitle:"\u79BB\u7EBF\u7F13\u5B58"}})},q=u(1),le=()=>{m("config/getDlParallelNum").then(({data:t})=>q.value=t)};le(),F("auth/userInfoChange",()=>le()),F("config/dlParallelNumChange",({data:t})=>q.value=t);const Y=t=>{if(t!==q.value){if(!M.value.isLogin)return de("mine.downloadNum");if(t>1&&!M.value.vipStatus)return qe("downloadVIP");m("config/setDownloadConfig",{type:"parallel",value:t})}},C=u(!1),D=u({text:"",content:"",confirm:"",handler:()=>{}}),fe=()=>{var t,e;(e=(t=D.value).handler)==null||e.call(t)},ge=()=>{C.value=!0,D.value={text:"\u786E\u8BA4\u5220\u9664\u6240\u6709\u7F13\u5B58\u5417\uFF1F",content:"\u5DF2\u7F13\u5B58\u89C6\u9891\u88AB\u5220\u9664\u4EE5\u540E\u5C06\u4E0D\u80FD\u6062\u590D\uFF01",confirm:"\u6E05\u7A7A",handler:async()=>{if(C.value=!1,!f){f=!0;try{await m("download/deleteAllGroups")}finally{f=!1}}}}},we=async()=>{if(!M.value.isLogin){de("mineDownload.startAll");return}if(!f){f=!0;try{await m("download/startAllTasks")}finally{f=!1}}},he=async()=>{if(!f){f=!0;try{await m("download/pauseAllTasks")}finally{f=!1}}},be=()=>{C.value=!0,D.value={text:"\u786E\u8BA4\u5220\u9664\u6240\u6709\u4E0B\u8F7D\u4EFB\u52A1\u5417\uFF1F",content:"",confirm:"\u6E05\u7A7A",handler:async()=>{if(C.value=!1,!f){f=!0;try{await m("download/deleteAllTasks")}finally{f=!1}}}}},E=u(!1),O=u(!1),T=u([]),J=u(!0),ke=t=>{t.item.classList.add("invisible")},Ce=t=>{t.item.classList.remove("invisible");const e=r.value.map(d=>d.itemId).join(","),l=T.value.map(d=>d.itemId).join(",");J.value=l===e,O.value=!1},ye=()=>{T.value=[...r.value],J.value=!0,E.value=!0},De=()=>{E.value=!1,m("download/sortTasks",T.value.map((t,e)=>({itemId:t.itemId,taskOrder:T.value.length-e})))},S=u(!1),R=u(!1),P=u([]),K=u(!0),xe=t=>{t.item.classList.add("invisible")},Ee=t=>{t.item.classList.remove("invisible");const e=v.value.map(d=>d.groupId).join(","),l=P.value.map(d=>d.groupId).join(",");K.value=l===e,R.value=!1},Se=()=>{P.value=[...v.value],K.value=!0,S.value=!0},Fe=()=>{S.value=!1,m("download/sortGroupList",P.value.map((t,e)=>({groupId:t.groupId,groupOrder:P.value.length-e})))},Ae=t=>{if(!M.value.isLogin)return;const e=localStorage.getItem("lastExecuted");if(!e)t(),localStorage.setItem("lastExecuted",new Date().toDateString());else{const l=new Date().toDateString();l!==e&&(t(),localStorage.setItem("lastExecuted",l))}},Ie=async()=>{const t=[];let e=[];(v.value||[]).forEach(l=>{l.type==="ogv"&&(e=e.concat(l.itemList||[]))}),e.forEach((l,d)=>{let g=Math.floor(d/30);t[g]||(t[g]=[]),t[g].push({ep_id:l.epid,qn:l.qn})});try{const l=await Promise.all(t.map(g=>Ue.validateCachePlay(g)));let d=[];(l||[]).forEach(g=>{const{ep_qn_check_list:G=[]}=g.data||{};d=d.concat(G)}),m("store/setData",je,d)}finally{}},Q=()=>{m("download/getCompletedGroups").then(t=>{v.value=t.data,Ae(Ie),ee.flashPageCursors(200)})},ae=()=>{m("download/getTaskList").then(t=>{r.value=t.data||[],ee.flashPageCursors(200)})},ne=()=>{Q(),ae()};return m("download/reloadVideoList").then(()=>ne()),Me(()=>B.query.openedGroupId,()=>{if(B.query.openedGroupId){let t;v.value.forEach(e=>{t||(t=Ye(e,B.query.openedGroupId))}),t&&(console.log("curGroup",t),N.setOpenedGroup(t))}}),F("download/itemListEvent",t=>{Q()}),F("download/taskListEvent",t=>{ae()}),F("download/statusChange",({data:t})=>{if(t.status==="damaged"){Q();return}if(t.status==="error"){const e=r.value.findIndex(l=>l.itemId===t.itemId);if(e<0)return;r.value[e].status="error",t.errorMsg&&(r.value[e].errorMsg=t.errorMsg)}}),F("download/progressChange",({data:t})=>{const e=r.value.findIndex(l=>l.itemId===t.itemId);e<0||(r.value[e]=t,t.status==="completed"&&ne())}),(t,e)=>{const l=U("v-button"),d=U("WidgetArrow"),g=U("VDropdown"),G=U("v-dialog");return i(),c("div",Ze,[x.value?_("",!0):(i(),c("div",et,[s("div",tt,[(i(),c(A,null,j(te,o=>s("div",{key:o.key,class:b(["tab p_relative",{active:w(V)===o.key}]),onClick:k=>ve(o.key)},[s("span",{textContent:y(o.name)},null,8,st),o.key=="downloading"&&w(se)>0?(i(),c("span",{key:0,class:"count",textContent:y(w(se))},null,8,lt)):_("",!0),at],10,ot)),64))]),s("div",nt,[w(oe).key==="downloaded"?(i(),c(A,{key:0},[a(l,{class:"option mr_sm",disabled:!v.value.length,onClick:Se},{default:n(()=>[it]),_:1},8,["disabled"]),a(g,{trigger:"hover",placement:"bottom-end","click-hide":"",onShow:e[0]||(e[0]=o=>z.value=!0),onHide:e[1]||(e[1]=o=>z.value=!1)},{content:n(()=>[s("div",dt,[s("div",{class:"dropdown_select--option cs_pointer stress_red",onClick:ge},[a(w(ze),{class:"stress_red mt_n3",width:"16"}),rt])])]),default:n(()=>[a(l,{class:"dropdown_select--button p_relative fs_4 text_ellipsis text_left group-more-button mr_sm",disabled:!v.value.length},{default:n(()=>[ut,a(d,{class:b(["dropdown_select--button--icon rotate_90 p_absolute",{rotate_deg:z.value}])},null,8,["class"])]),_:1},8,["disabled"])]),_:1}),a(l,{class:"play-all p_relative",type:"pink",disabled:!v.value.length,onClick:me},{default:n(()=>[a(w(He)),ct,_t]),_:1},8,["disabled"])],64)):_("",!0),w(oe).key==="downloading"?(i(),c(A,{key:1},[a(l,{class:"option mr_sm",disabled:!r.value.length,onClick:ye},{default:n(()=>[pt]),_:1},8,["disabled"]),a(g,{trigger:"hover",placement:"bottom-end","click-hide":"",onShow:e[5]||(e[5]=o=>H.value=!0),onHide:e[6]||(e[6]=o=>H.value=!1)},{content:n(()=>[s("div",ft,[s("div",{class:"dropdown_select--option cs_pointer",onClick:e[2]||(e[2]=o=>Y(1))},wt),s("div",{class:"dropdown_select--option cs_pointer",onClick:e[3]||(e[3]=o=>Y(2))},bt),s("div",{class:"dropdown_select--option cs_pointer",onClick:e[4]||(e[4]=o=>Y(3))},Ct)])]),default:n(()=>[a(l,{class:"dropdown_select--button p_relative fs_4 text_ellipsis text_left mr_sm task-num-button"},{default:n(()=>[vt,s("span",mt,y(q.value),1),a(d,{class:b(["dropdown_select--button--icon rotate_90 p_absolute",{rotate_deg:H.value}])},null,8,["class"])]),_:1})]),_:1}),a(g,{trigger:"hover",placement:"bottom-end","click-hide":"",onShow:e[7]||(e[7]=o=>W.value=!0),onHide:e[8]||(e[8]=o=>W.value=!1)},{content:n(()=>[s("div",Dt,[s("div",{class:b(["dropdown_select--option cs_pointer",{disabled:!r.value.length}]),onClick:we},Et,2),s("div",{class:b(["dropdown_select--option cs_pointer",{disabled:!r.value.length}]),onClick:he},Ft,2),s("div",{class:b(["dropdown_select--option cs_pointer",{disabled:!r.value.length}]),onClick:be},It,2)])]),default:n(()=>[a(l,{class:"dropdown_select--button p_relative fs_4 text_ellipsis text_left task-more-button"},{default:n(()=>[yt,a(d,{class:b(["dropdown_select--button--icon rotate_90 p_absolute",{rotate_deg:W.value}])},null,8,["class"])]),_:1})]),_:1})],64)):_("",!0)])])),!x.value&&w(V)==="downloaded"?(i(),c("div",{key:1,class:b(["tab-content downloaded i_wrapper",{"first-line-collection":v.value.slice(0,5).some(o=>{var k;return((k=o.itemList)==null?void 0:k.length)>1})}])},[v.value.length===0?(i(),I(X,{key:0,text:"\u6682\u65E0\u7F13\u5B58\u7684\u89C6\u9891"})):_("",!0),v.value.length?(i(),c("div",Bt,[(i(!0),c(A,null,j(v.value,(o,k)=>(i(),I(Z,{class:"col_3 col_sm_1_5 mb_lg al-flex-end",item:o,key:o.groupId,isFirstCard:k===0},null,8,["item","isFirstCard"]))),128))])):_("",!0)],2)):_("",!0),!x.value&&w(V)==="downloading"?(i(),c("div",Lt,[r.value.length===0?(i(),I(X,{key:0,text:"\u6682\u65E0\u7F13\u5B58\u4E2D\u7684\u89C6\u9891"})):_("",!0),r.value.length?(i(),c("div",Tt,[(i(!0),c(A,null,j(r.value,(o,k)=>(i(),I(Z,{class:"col_3 col_sm_1_5 mb_lg al-flex-end",item:o,key:o.itemId,isDownloaded:!1,isFirstCard:k===0},null,8,["item","isFirstCard"]))),128))])):_("",!0)])):_("",!0),x.value?(i(),c("div",Pt,[a(Ke,{count:L.value.length,unit:"\u7ED3\u679C"},null,8,["count"]),L.value.length===0?(i(),I(X,{key:0,text:"\u6682\u65E0\u7F13\u5B58\u7684\u89C6\u9891"})):_("",!0),L.value.length?(i(),c("div",Gt,[(i(!0),c(A,null,j(L.value,(o,k)=>(i(),I(Z,{class:"col_3 col_sm_1_5 mb_lg al-flex-end",item:o,key:o.itemId,isDownloadSearch:!0,isFirstCard:k===0},null,8,["item","isFirstCard"]))),128))])):_("",!0)])):_("",!0),s("div",$t,null,512),a(G,{visible:C.value,"onUpdate:visible":e[10]||(e[10]=o=>C.value=o),width:320,"class-name":"i_dialog py_lg",onCancel:e[11]||(e[11]=o=>C.value=!1),"is-show-default-footer":!1},{default:n(()=>[s("div",Mt,[s("h4",Nt,y(D.value.text),1),D.value.content?(i(),c("p",Vt,y(D.value.content),1)):_("",!0),s("div",qt,[a(l,{class:"mr_sm",onClick:e[9]||(e[9]=o=>C.value=!1)},{default:n(()=>[Ot]),_:1}),a(l,{type:"danger",onClick:fe},{default:n(()=>[p(y(D.value.confirm),1)]),_:1})])])]),_:1},8,["visible"]),a(G,{visible:E.value,"onUpdate:visible":e[15]||(e[15]=o=>E.value=o),width:580,"class-name":"i_dialog py_lg",title:"\u4E0B\u8F7D\u6392\u5E8F",center:!0,"is-show-default-footer":!1,onCancel:e[16]||(e[16]=o=>E.value=!1)},{default:n(()=>[Rt,s("div",Ut,[s("div",{class:b(["sort_download_group",{sorting:O.value}])},[a(w(re),{list:T.value,class:"download_group page_scroller",draggable:".download_group--item",animation:"500","item-key":"id",onMousedown:e[12]||(e[12]=o=>O.value=!0),onMouseup:e[13]||(e[13]=o=>O.value=!1),onStart:ke,onEnd:Ce},{item:n(({element:o})=>[s("div",jt,[s("div",zt,[s("img",{class:"p_center",src:o.coverUrl},null,8,Ht)]),s("h6",Wt,y(o.title),1)])]),_:1},8,["list"])],2),s("div",Yt,[a(l,{class:"mr_sm",onClick:e[14]||(e[14]=o=>E.value=!1)},{default:n(()=>[Jt]),_:1}),a(l,{type:"pink",onClick:De,disabled:J.value},{default:n(()=>[Kt]),_:1},8,["disabled"])])])]),_:1},8,["visible"]),a(G,{visible:S.value,"onUpdate:visible":e[20]||(e[20]=o=>S.value=o),width:580,"class-name":"i_dialog py_lg",title:"\u89C6\u9891\u6392\u5E8F",center:!0,"is-show-default-footer":!1,onCancel:e[21]||(e[21]=o=>S.value=!1)},{default:n(()=>[Qt,s("div",Xt,[s("div",{class:b(["sort_download_group",{sorting:R.value}])},[a(w(re),{list:P.value,class:"download_group page_scroller",draggable:".download_group--item",animation:"500","item-key":"id",onMousedown:e[17]||(e[17]=o=>R.value=!0),onMouseup:e[18]||(e[18]=o=>R.value=!1),onStart:xe,onEnd:Ee},{item:n(({element:o})=>[s("div",Zt,[a(Je,{src:o.coverImg,"keep-src":!0,width:227},null,8,["src"]),s("h6",eo,y(o.title),1)])]),_:1},8,["list"])],2),s("div",to,[a(l,{class:"mr_sm",onClick:e[19]||(e[19]=o=>S.value=!1)},{default:n(()=>[oo]),_:1}),a(l,{type:"pink",onClick:Fe,disabled:K.value},{default:n(()=>[so]),_:1},8,["disabled"])])])]),_:1},8,["visible"])])}}});var Fo=Xe(lo,[["__scopeId","data-v-17bf96ba"]]);export{Fo as default};

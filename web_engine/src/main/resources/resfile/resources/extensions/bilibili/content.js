(function(){"use strict";const n={Trace:0,Debug:1,Info:2,Warning:3,Error:4},l=["color: black;","color: gray;","color: green;","color: orange;","color: red;"],u=["log","debug","info","warn","error"],d={log:console.log,warn:console.warn,error:console.error,info:console.info,debug:console.debug,trace:console.trace},g=(()=>{const t=globalThis?.window?.localStorage?.getItem("LogLevel")??"Info";return t==null?n.Info:t==="Trace"?n.Trace:t==="Debug"?n.Debug:t==="Info"?n.Info:t==="Warning"?n.Warning:t==="Error"?n.Error:n.Info})();class i{beforeFuncs=[];afterFuncs=[];static moduleName="";isEnabled=!0;config={namespace:"Bilibili"};constructor(e="unknown"){this.config.namespace=`[${e}]`}create(e="unknown"){return new i(e)}_log(e,o){this.isEnabled&&(e<g||(this.beforeFuncs.forEach(r=>r(this.config)),d[u[e]](`%c[${i.moduleName}]${this.config.namespace}`,l[e],...o),this.afterFuncs.forEach(r=>r(this.config))))}addInterceptor(e,o=!0){return typeof e!="function"?this.error("拦截器函数不符合规范"):o?(this.beforeFuncs.push(e),this):(this.afterFuncs.push(e),this)}addBeforeInterceptor(e){return this.beforeFuncs.push(e),this}addAfterInterceptor(e){return this.afterFuncs.push(e),this}trace(...e){return this._log(n.Trace,e),this}debug(...e){return this._log(n.Debug,e),this}info(...e){return this._log(n.Info,e),this}warn(...e){return this._log(n.Warning,e),this}error(...e){return this._log(n.Error,e),this}setNamespace(e=""){return this.config.namespace=`[${e}]`,this}}const c=t=>new i(t),a={Home:"home",Login:"login",Search:"search",Player:"player",Unknown:"Unknown"},h=()=>{const t=new URL(location.href),e=t.pathname.substring(t.pathname.lastIndexOf("/")+1,t.pathname.lastIndexOf("."));return e==="login"?a.Login:e==="index"?a.Home:e==="search"?a.Search:e==="player"?a.Player:a.Unknown},f=t=>{const e=document.createElement("script");e.src=t,(document.head||document.documentElement).appendChild(e)},m=t=>{const e=document.createElement("link");e.rel="stylesheet",e.href=t,(document.head||document.documentElement).appendChild(e)},s=c("Communication"),p=()=>{const t=chrome.storage.local;document.addEventListener("bili_request",async function(e){if(!e.detail){s.warn("bili_request without detail");return}s.info("bili_request:",e.detail);const o=e.detail;let r=null;switch(e.detail.action){case"getStorage":r=await t.get(e.detail.data.key),r=r[e.detail.data.key]||null;break;case"setStorage":r=await t.set({[e.detail.data.key]:e.detail.data.value});break}s.info("bili_response:",r),document.dispatchEvent(new CustomEvent("bili_response",{detail:{id:o.id,data:r}}))})};(()=>{i.moduleName="Content";const t=c("Entry"),e=h();t.info("page:",e),p();{const o=window.chrome.runtime.getURL("page.js");f(o)}{const o=window.chrome.runtime.getURL("bilibili.css");m(o)}})()})();
